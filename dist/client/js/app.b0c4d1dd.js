(function(){var t={3153:function(t){"use strict";t.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAS8AAABhCAYAAACH+ydwAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAABOFSURBVHhe7Z2JtxTFFcbzbyTn5MQkJiZqTExiFhOjcTcal4CCoiwiiPhEEAQUBCKIElAERFAUWWQRCCD7DiIqiCKIwNv3fd/39yp8/aoz/frd7unu6e7pbu7vnO+cNzNV1T0zPd/rulV163uCYRgmhLB5MQwTSti8GIYJJWxeDMOEEjYvhmFCCZsXwzChhM2LYZhQwubFMEwoYfNiGCaUsHkxDBNK2LwYhgklbF4Mw4QSNi+GYUIJmxfDMKGEzYthmFDC5sUwTChh82IYJpSweTEME0rYvBiGCSVsXgzDhJJAm1dXa6vI+N2fxYXvX+abKv7zhjx6jKWr1omm5mb5iGGYIBBo8yp/dS5pMF4JRgnD1JKRkytuuP8RsWj5avkMwzBBILDm1ZabJy788HLSZLxSw9798ugxRj7/kmJeN/5rkCgoLpXPMgyTbAJrXnkPPkIajFfKHzRUHjnG3iOfKsalatz02fIVhmGSTSDNq37XHtJgvFLqj34u2guL5NF7aLnYfbx/2Ohe5gV9fvKULMEwTDIJpHkVpYwTeQ8M8E3Vy5bLI8dAkF5vXNDAUeNER0enLMUki46iYtH81SlRv32n8v1VLnhL1Kz8UNRv2yGaj5+QpaJFe26eaNi9T9SsWS8qF74tqt55T9Rt3a58DpcigQ7YJ4vS8gpxU7/HSPOC1m7ZIUuGC/zIKfNWVfT0s7JkjOaTX5Nl3VTxuOfl0cxpOX1GFD/znEj9yS/JO2it0n52tSgeM96RkbWc+oY8T8gOFfMXkm3kPzxYdFZWylLmdLe0iprVa0TuPQ+Q71Or3Pv6i4Zde2XN6MPmRTD5lXmkaam6feDjoqa2TpYOBx0Xu8Wpl11BXvSq0n7+K1k6RsO+A2RZN5V9853yaDQ494LHR5J1rQjxzPa8fNlafBoPHSHbgaxSt2kLWR+q27RZljKn4cAhkfH768k2zJT99ztE69lzspXowual4+Tps6Rh6fXqondkjXBQOGI0eaHr1d3cImv0kGzzakvPEBm/vo6sZ1f1H2+XrZqTqHnhDpGqC5W/MkeWMqdkwmSyvh1VLV4qW4smbF4aOru6xIBRY0mzopSenStrBpumz4+TFzclxFW0JNO82jIyRfqVvyHrOBU1HUZPIubVUVomMn7zB7JuweDhspQ55bPnkPWdqGb1Wtlq9AiMedXv2CUq5s73TbVrP5JHjrF+607SpIyEOWBhAOZAXdiUmr/8StbqwRfzuuUuebQYHcUlIuPaP5LlVWX99WbljrJ0ynRRNvNVpWtpZBxaIY5nRiLmlXPnvWS9rBtvE91NTbKUMbXrN5L1VWXf9g/l+sVdZNNnXygBe8TRqLKq4r3fsBII88I0BUxXoD54r4TpGFoQw0IsizIpM+375JhsIZhUf7CKfP9Gwj8RLW2ZWX2MX6+yaS+TbUEwTqqOVhgl1GM2zw/BeKqOCgw4/+EhZF0o64ZbZEkap+ZVlDKWrJN2xTWivaBQljIGQXyUpdpAvNKs29t07HOR+mM6pokYWBQJhHkhoEp96F4JPww9iGFR5hRPmAuGOWFBpLO6xvDHUDB0BPl89fKVsrZ1MG2BagvC6KBdajf+l2wLSr/mOsvB99IXXiLbgCoXLZGl+uLEvKqWLiPLQ/q7WSPM4lwI3sej8fAnZF2I6mmEnaSbV8OefeSH7Zl+eLmy9EiLun7RqZat2SBbChZGP14M4eOOh3oN60ntYmpeY8bLUtbJuf1usq20X/5atGVly1LWMOrGpf7kF6LLYMTYrnk1HjlKloXQDbRCe3YOWR8qfnaCLBWfUoO7YHQto0ZSzSsZWSOoH6e6ftGpbu4/WJkbFiRaz18g3z8+b8wdqn5/Bfm61TlXWty880L3KvWnV5JtYVKmXVrOfEu2BVW/94Es1Rs75gXTwRQTqmzZ9JmyVHwQs6PagDoK43c5VTpKSsk2IDvthIGkmhfSz1AfsleiskbsOdx7/aJTTZ0zX7YYDIyCuGqsDzPRqdepNZ7xcLvbCFq+/kbp2uUPfEy5S0q/6rd9pnFYpfDxJ8lzM4p9WTWvrsZGpQ2qHGJudki/+ndkO4VPpsgS1ikY8gTZVu1Hm2SJaJBU88KyBoyY+CX9NADEqu4Z/CRpRk50+rsLsuXkgiUz1MWb1/9hWcJ4+gRGs+zihXnpac8vkH/Zp+kL46kirefOy1IxrJqXUawWhtZVXy9Lxce027nxv7KUdeq2bCPbKpk4RZaIBoEI2CeLJSvp9YtO9WjK88pcsWSCLqFRV7w1NU2WEqItLZ0sg4C4Xfwwr0QxGomrWbVGlohhxbww2ZR6Pe0X14j2HHvz/ypef5NsC8K8Mbt01dQqd6uYnZ9z9wOi4NFhonjsBGWZUZS4ZM2rsKTUdP2iU23YvlseITlUzKN/CKVTZ8gSPWBYnioH2cXMvLDIPgjk3v8geX7UgEI886rb/DH5GoQ7WrtgrSPVFoyQMeaSNa+Js+aS5pOoMFesvqFRHsVfjEwk/aprRVdDgywVgyoLdZSVyxLWCMOdFwYiqPPD5FE9ZuaFWBz1PFS15F3Zgj0Qz6Pay723nyzBUPhuXm0ZWWQ8yithnZkeq+sXnWre0r4pdvygcOTT5I/AqLtg9KNp+fY7WcIaft95YZ6XfqJrPBndeWH6hR4z8zJbZ5n30CDZgj2otqDC4aNkCYbCV/PqrK0T6VdeS35RXqnq3ffl0XtALi476xedCCmjc/L9HZZuOvEl+f6zb7lTdHd3y1K9yfrbrWQdKxMitZib11hZyj2ajh4jj+VIP/ix6NbFKRsPHqbLWpDduBIC+1Q7kBefXZTw1bxKJk0hvySvhLVv3Z29Eweu27qDNBy3lfLiy/KI3gNzMhqybz71jSzVF6PpFEh2Z4dQm9dFdVZVyZZ7SMS8kGus3c68rMIish0IM+4ZY3wzr5Zz58kvyEs1nTgpj96D0/WLTvXpCWvLQhIF6/yo9180eowsQWPUzax8c5EsYQ2/Y15Yx0cdy6k6q6plyz2YdRutCEkBrYKRSaoNqGT8JFmKofDNvIyWaXgl6j/+7IVLSZPxSv2eeMbzlNFY4oJRKf37x9SAeMPsRsuHSl+cJktYI+zmpceKeaUarAJQhbWOVkD2DKo+FO+fz6WOL+aFbgj15XiltMuvEh26rkCi6xedau1mawnwnIIpENRnULlgsSxhTMUbC8i6dgPFfpuXE4pGPUOeH64VPVbMC11LmDz1mipk5IgH/vlQdSEsnmeM8cW8kKmAGgHySg37D8ojx0h0/aJTeZkyuvVCKnnRY3KiFWpWrCbr2x2iD4N5GaXIyfj9X2SJGPHMS81QiuVKmdffRJaBcu74p1IuHphQSta/6z5ZgqHwNWCfLHYd+oQ0Fr/02lvO5v/EI6/fQPKixwx7BOPjySjIn/nHG+QRrBEG80JOK+r8qLsbM/PSb1LS8s1pspwqzJ6PB+aaUXXRNWWMibx5ub1+0anyCovlGblD/c7d5AXvhpD4zg5BNy9kMKXODaLyvJuZFxZj6zFa1aCq5cy3siSNUZcWspLEkAL5u2o+XKeknMIaYjsbkISFyJvX2yvWkGbipxC4b2tvl2eUOGbrF92SnYXFXpoXjAe57BPBzIyoRIFm5Y0wG5DK+svfZSkazEWk6kH6eYpWoSYgZ173V/lqNPDFvM5eSBOnzp7zXce+/Jo0E7/l9pQJJBPUX5huy0qwWcXUvGwmI6zdsEmUz3pNydiAeBTawMgpdcdjFczy158XlPHbP8kSvXFiXvi8zLaWK3t5tizZF2S2oOpATrJ8wOyptgqfeEqWiAa+mNei5avJH/WloLHTjC9aJ8AojDIkuCk7C4zdvPOCoVDtVL/rbMmVktzQwFSM5rM5MS+AgSmqjqrm41/Kkn0xij9C+v0W4lEyeSrZTtXb4dquLx6+mFdTc7O4a9AI8scdZSFrBbJXuIlRfAS5uqi1nfGEETGqPeSEsoqbd164Q6HaweJyq7tMa8HABNUeZNSeU/MCWN9I1YPQbeu++FuggLFQdSDUM0pZrQc7hFNtQJhTFiV8i3lt3XOA/IFHWYs/cDd/EuIz1EUJYcG7E4qeos3QTqzFTfPCnRLVDoTcVHayqZrNwzJL0ZyIecEgjNJCQ1giR9FVV2868bXgscdlSWOMsuNC+QMelaWig2/mhfV3SNZH/cijKIxw4o7TTRD/oC7MshmzZAn7lL70b7pNkxiNHjfNCxjdfUH5jwyJO5iAkTWjOBeElMtUiiCVRMwLYC9Fqq4q7PJDUf7aPLK8KtyBoW092JTEbKckiMquEnZ8My+ANMnUDz2K2n3oqHzX7oCdj6mLEplPEwlmYyY+1a6dVDZumxdGGM1iQJiEiw1EtGm9sbkETAFBaaqOVvEWnidqXgC556n6EDbGpbqBuKu0MoqMzwb5ybBTECYUU2W0Knn+BXmEaOGreYEF760UKVNeTqq8nvfl9k7auNCNtr13kuNcC+YCUe3ayU3lZsBeBXcT2FyWajMRFT83UR7BGDfMS/nOLv5jodqA9JNdVcxiVk6EFQBWduoOI76bVxCYPnchaTpuCeso3cRo/WLuPQ/IEs4x2jeTyjBqhBfmBVrPnjNMmOhEVtPzuGFewGxjDahh115ZsjeYLkKVtyvE0LT7FkSNS9K8ps1dQJqOG5rj8lIgXHzUhQnZzXhKYZTWGHd6VvHKvADiV0ZZUK0KawftpPlxy7yA2aABPuNOg/0+8b0nkokFS7ywyUqUYfNyUZgO4vYibEyBoC5Ot7axwpZiVPuQVdyOeVEgQ6nRgIWZ0E20m5PfTfOKt3g73igicrVl/vlGsi4ldLWxsxFGL6MOm5eLwnQQN0G3grxAr7imTwI9p2CpEZWZA7IaK8HoH1UfMuoaOaUtPUNZ7Jx9a28jQxcJM/Jzbr9byYOFtZ9Gc6rigV2wqfcCOaH5xMk+i+K1ajHJdquCvSexSTP+meGuqtd7v+wKZaPZ2nUbHL/nMJJU88K6Qyqg7rW8CNgPGxfNER2GCSpJNa/z6ZmkEYRR59Iy5LtiGMYPkt5tnLN4GWkGYRJGLxmG8Zekm1dDY6O4a9ATpCmEQTf3Hywqq2vku2EYxi8CEbDfuns/aQxh0PL1iU0SZRjGGYEwL6x7HPrsJNIcgqz7h412NckgwzDWCYR5BYUVH20mTcpIB499IWsyDOM3bF4a7JiXnztiA2RjfX/dJrF9/2FRVGK+H6Nd0rJy+mShzQpBznOcZ61mMmZ1bZ3ynNMYJEaMtZ+Bqu9SEx9JLi2v6NNuhUtz9bQUl5aJbXsPio+27RKZObGF61GEzUvDig3WzSsz178f96hJ05RBDcxRQ1cVx8cGum5BbQv3wuzX5avO2Xvk0z7tQsPHJ746oKyySmnr6PGeXdFr6xvEoKfHi9EvzBCtbW3Kc3YZMGpsn3OF+o9IfPPX1Zs+Jtvevu+QLJE4C99f1af9qXPeVAbFogiblward17zljjbFMEJm3ftU46ZXxTbfUhN7Lh+6075TGIMHjNRLFm5Tj4SYuy0V1w1r89Onup1x5GamS1LOEdrXs0trWLEhKli+HMvupJDraC4VGn7+Nen5TOJA/O6bcAw+UgoBvvM1Jmi3/AU+UxizH93hXLOuF5UVm7YojwHA4sigTSvNZu3KV0kvzVm6izlyzbT7QOH9eqqeM2+T46JnQeOyEcxHhr5rHg0ZYJ8lBi44/DSvLz4z6+aF+KO2CcAd11ufS9+mBeAueB6coM7Hxkuxk3vm0ByyJiegbAoEljzwgceRG3cbm8zBLdA3EVrtOjK4HzcAF1RL80LbWvPPT078ZRBqnlhWzksiC+/+Ngt/DCv0+cuiKFjJyt3i4mCuzic79otO+QzMd764EPltdyCIvlMdAikeXV0dIqHnqTjD8kU0lh3dnXJs/SXw58d77U+U93QxA3wo8KPS8Vt83pq8oxe5+6GKajmhTjlLQ8OIe9OneKVeaFNrQaOGicuONx7QAu6zWhvx/7D8pkYy9ZsUF6L4vK1wMa8vjpzttcXHQQhjbXfbNqxR9l/Ug+C3vcOGSUfOQcpfPDeDnz6uXwmXN1GxLxgXPgb8TQ38Mq8YLJq3E8bw3QDtA2j0vPiq28o76XEIG9YmAl0wB6BRnzwQZAbP2Yn4OJDFxGjaSroQuKcZs5fLJ9xzobtu5W2tPGisJkXwOgr7kYLihLf3suvmJebTJo1V9w39Kle0y/Uzwjx0SgSaPPCfJ1bHxqqfAHJFPZfxDydZIApGbjoEZfCiBL+u97x8HBx92MjlYszERDoxvt7fWnvDV297jZOnPkfWcI5evNC3AfBaXTF6hsSM8swmldeYbFyjcDAcJ0sXbVOefyv4SnKaG8UCbR5AUyWVG+1kyW3c9LbBQHuKa/N//+PH6mm3QjAIsD78d6D8lEM7Hx04GisG+kUTJLUBupVaeNrTmlsalba0n4OMB08d+JUYtt81V28y0U7aM8tzpxPFas2bpWPvAHn/c7q9coUjBnzFrk6hyyIBN68GIZhKNi8GIYJJWxeDMOEEjYvhmFCCZsXwzChhM2LYZhQwubFMEwoYfNiGCaUsHkxDBNK2LwYhgklbF4Mw4QSNi+GYUIJmxfDMKGEzYthmFDC5sUwTChh82IYJpSweTEME0rYvBiGCSVsXgzDhBAh/gef8DJlkW7OBAAAAABJRU5ErkJggg=="},5358:function(t,e,s){var a={"./af":5177,"./af.js":5177,"./ar":1509,"./ar-dz":1488,"./ar-dz.js":1488,"./ar-kw":8676,"./ar-kw.js":8676,"./ar-ly":2353,"./ar-ly.js":2353,"./ar-ma":4496,"./ar-ma.js":4496,"./ar-ps":6947,"./ar-ps.js":6947,"./ar-sa":2682,"./ar-sa.js":2682,"./ar-tn":9756,"./ar-tn.js":9756,"./ar.js":1509,"./az":5533,"./az.js":5533,"./be":8959,"./be.js":8959,"./bg":7777,"./bg.js":7777,"./bm":4903,"./bm.js":4903,"./bn":1290,"./bn-bd":7357,"./bn-bd.js":7357,"./bn.js":1290,"./bo":3926,"./bo.js":3926,"./br":1470,"./br.js":1470,"./bs":4429,"./bs.js":4429,"./ca":7306,"./ca.js":7306,"./cs":6464,"./cs.js":6464,"./cv":3635,"./cv.js":3635,"./cy":4226,"./cy.js":4226,"./da":3601,"./da.js":3601,"./de":7853,"./de-at":6111,"./de-at.js":6111,"./de-ch":4697,"./de-ch.js":4697,"./de.js":7853,"./dv":708,"./dv.js":708,"./el":4691,"./el.js":4691,"./en-au":3872,"./en-au.js":3872,"./en-ca":8298,"./en-ca.js":8298,"./en-gb":6195,"./en-gb.js":6195,"./en-ie":6584,"./en-ie.js":6584,"./en-il":5543,"./en-il.js":5543,"./en-in":9033,"./en-in.js":9033,"./en-nz":9402,"./en-nz.js":9402,"./en-sg":3004,"./en-sg.js":3004,"./eo":2934,"./eo.js":2934,"./es":7650,"./es-do":838,"./es-do.js":838,"./es-mx":7730,"./es-mx.js":7730,"./es-us":6575,"./es-us.js":6575,"./es.js":7650,"./et":3035,"./et.js":3035,"./eu":3508,"./eu.js":3508,"./fa":119,"./fa.js":119,"./fi":527,"./fi.js":527,"./fil":5995,"./fil.js":5995,"./fo":2477,"./fo.js":2477,"./fr":5498,"./fr-ca":6435,"./fr-ca.js":6435,"./fr-ch":7892,"./fr-ch.js":7892,"./fr.js":5498,"./fy":7071,"./fy.js":7071,"./ga":1734,"./ga.js":1734,"./gd":217,"./gd.js":217,"./gl":7329,"./gl.js":7329,"./gom-deva":2124,"./gom-deva.js":2124,"./gom-latn":3383,"./gom-latn.js":3383,"./gu":5050,"./gu.js":5050,"./he":1713,"./he.js":1713,"./hi":3861,"./hi.js":3861,"./hr":6308,"./hr.js":6308,"./hu":609,"./hu.js":609,"./hy-am":7160,"./hy-am.js":7160,"./id":4063,"./id.js":4063,"./is":6993,"./is.js":6993,"./it":8383,"./it-ch":1827,"./it-ch.js":1827,"./it.js":8383,"./ja":3827,"./ja.js":3827,"./jv":9722,"./jv.js":9722,"./ka":1794,"./ka.js":1794,"./kk":7088,"./kk.js":7088,"./km":6870,"./km.js":6870,"./kn":4451,"./kn.js":4451,"./ko":3164,"./ko.js":3164,"./ku":8174,"./ku-kmr":6181,"./ku-kmr.js":6181,"./ku.js":8174,"./ky":8474,"./ky.js":8474,"./lb":9680,"./lb.js":9680,"./lo":5867,"./lo.js":5867,"./lt":5766,"./lt.js":5766,"./lv":9532,"./lv.js":9532,"./me":8076,"./me.js":8076,"./mi":1848,"./mi.js":1848,"./mk":306,"./mk.js":306,"./ml":3739,"./ml.js":3739,"./mn":9053,"./mn.js":9053,"./mr":6169,"./mr.js":6169,"./ms":3386,"./ms-my":2297,"./ms-my.js":2297,"./ms.js":3386,"./mt":7075,"./mt.js":7075,"./my":2264,"./my.js":2264,"./nb":2274,"./nb.js":2274,"./ne":8235,"./ne.js":8235,"./nl":2572,"./nl-be":3784,"./nl-be.js":3784,"./nl.js":2572,"./nn":4566,"./nn.js":4566,"./oc-lnc":9330,"./oc-lnc.js":9330,"./pa-in":9849,"./pa-in.js":9849,"./pl":4418,"./pl.js":4418,"./pt":9834,"./pt-br":8303,"./pt-br.js":8303,"./pt.js":9834,"./ro":4457,"./ro.js":4457,"./ru":2271,"./ru.js":2271,"./sd":1221,"./sd.js":1221,"./se":3478,"./se.js":3478,"./si":7538,"./si.js":7538,"./sk":5784,"./sk.js":5784,"./sl":6637,"./sl.js":6637,"./sq":6794,"./sq.js":6794,"./sr":5719,"./sr-cyrl":3322,"./sr-cyrl.js":3322,"./sr.js":5719,"./ss":6e3,"./ss.js":6e3,"./sv":1011,"./sv.js":1011,"./sw":748,"./sw.js":748,"./ta":1025,"./ta.js":1025,"./te":1885,"./te.js":1885,"./tet":8861,"./tet.js":8861,"./tg":6571,"./tg.js":6571,"./th":5802,"./th.js":5802,"./tk":9527,"./tk.js":9527,"./tl-ph":9231,"./tl-ph.js":9231,"./tlh":1052,"./tlh.js":1052,"./tr":5096,"./tr.js":5096,"./tzl":9846,"./tzl.js":9846,"./tzm":1765,"./tzm-latn":7711,"./tzm-latn.js":7711,"./tzm.js":1765,"./ug-cn":8414,"./ug-cn.js":8414,"./uk":6618,"./uk.js":6618,"./ur":2539,"./ur.js":2539,"./uz":7609,"./uz-latn":2475,"./uz-latn.js":2475,"./uz.js":7609,"./vi":1135,"./vi.js":1135,"./x-pseudo":4051,"./x-pseudo.js":4051,"./yo":2218,"./yo.js":2218,"./zh-cn":2648,"./zh-cn.js":2648,"./zh-hk":1632,"./zh-hk.js":1632,"./zh-mo":1541,"./zh-mo.js":1541,"./zh-tw":304,"./zh-tw.js":304};function i(t){var e=r(t);return s(e)}function r(t){if(!s.o(a,t)){var e=new Error("Cannot find module '"+t+"'");throw e.code="MODULE_NOT_FOUND",e}return a[t]}i.keys=function(){return Object.keys(a)},i.resolve=r,t.exports=i,i.id=5358},6002:function(t,e,s){"use strict";t.exports=s.p+"img/404.87d9c111.svg"},9035:function(t,e,s){"use strict";s(8111),s(2489);var a=s(5471),i=s(2915),r=s(3847),o=s(6684),n=s(8166),l=function(){var t=this,e=t._self._c;return e(i.A,[e("router-view"),t._l(t.notifications,(function(s,a){return e(n.A,{key:a,style:`bottom: ${60*a+8}px`,attrs:{value:!0,color:s.type,timeout:s.timeout,absolute:"",bottom:"",right:""},scopedSlots:t._u([{key:"action",fn:function({attrs:a}){return[e(r.A,t._b({attrs:{text:""},on:{click:function(e){return t.removeNotification(s.id)}}},"v-btn",a,!1),[e(o.A,[t._v("mdi-close")])],1)]}}],null,!0)},[t._v(" "+t._s(s.message)+" ")])}))],2)},c=[],u=s(5353),d={name:"App",computed:{...(0,u.aH)("notification",["notifications"])},methods:{...(0,u.PY)("notification",["REMOVE_NOTIFICATION"]),removeNotification(t){this.REMOVE_NOTIFICATION(t)}}},m=d,p=s(1656),h=(0,p.A)(m,l,c,!1,null,null,null),f=h.exports,g=(s(3579),s(173)),y=(s(4114),s(4335));const v=y.A.create({baseURL:"http://localhost:3000/api",headers:{"Content-Type":"application/json"}});v.interceptors.request.use((t=>{const e=B.getters["auth/getToken"];return e&&(t.headers["Authorization"]=`Bearer ${e}`),t}),(t=>Promise.reject(t))),v.interceptors.response.use((t=>t),(t=>(t.response&&401===t.response.status&&B.dispatch("auth/logout"),Promise.reject(t))));var A=v;const _=()=>{const t=localStorage.getItem("auth_token"),e=localStorage.getItem("auth_user");let s=null;try{e&&(s=JSON.parse(e))}catch(a){localStorage.removeItem("auth_user")}return{token:t,user:s}},{token:b,user:C}=_(),S={token:b,user:C,loading:!1,error:null},q={isAuthenticated:t=>!!t.token,isAdmin:t=>t.user&&"admin"===t.user.role,isTechnician:t=>t.user&&"technician"===t.user.role,isUser:t=>t.user&&"user"===t.user.role,currentUser:t=>t.user,getToken:t=>t.token,authError:t=>t.error,isLoading:t=>t.loading},D={async login({commit:t},e){t("SET_LOADING",!0),t("SET_ERROR",null);try{const s=await A.post("/auth/login",e),{token:a,user:i}=s.data;return t("SET_AUTH_DATA",{token:a,user:i}),localStorage.setItem("auth_token",a),localStorage.setItem("auth_user",JSON.stringify(i)),i}catch(s){const e=s.response?.data?.message||"Ошибка при входе в систему";throw t("SET_ERROR",e),s}finally{t("SET_LOADING",!1)}},async register({commit:t},e){t("SET_LOADING",!0),t("SET_ERROR",null);try{const t=await A.post("/auth/register",e);return t.data}catch(s){const e=s.response?.data?.message||"Ошибка при регистрации";throw t("SET_ERROR",e),s}finally{t("SET_LOADING",!1)}},logout({commit:t}){localStorage.removeItem("auth_token"),localStorage.removeItem("auth_user"),t("CLEAR_AUTH_DATA"),Ws.push("/login")},async checkAuth({commit:t,state:e}){if(!e.token)return!1;try{const e=await A.get("/auth/me");return t("SET_USER",e.data),!0}catch(s){return localStorage.removeItem("auth_token"),localStorage.removeItem("auth_user"),t("CLEAR_AUTH_DATA"),!1}},async updateProfile({commit:t,state:e},s){t("SET_LOADING",!0);try{const a=await A.patch(`/users/${e.user.id}/profile`,s),i={...e.user,...a.data};return t("SET_USER",i),localStorage.setItem("auth_user",JSON.stringify(i)),a.data}catch(a){const e=a.response?.data?.message||"Ошибка при обновлении профиля";throw t("SET_ERROR",e),a}finally{t("SET_LOADING",!1)}},async changePassword({commit:t,state:e},{currentPassword:s,newPassword:a}){t("SET_LOADING",!0);try{await A.post(`/users/${e.user.id}/change-password`,{currentPassword:s,newPassword:a})}catch(i){const e=i.response?.data?.message||"Ошибка при изменении пароля";throw t("SET_ERROR",e),i}finally{t("SET_LOADING",!1)}}},E={SET_AUTH_DATA(t,{token:e,user:s}){t.token=e,t.user=s,t.error=null},SET_USER(t,e){t.user=e},SET_TOKEN(t,e){t.token=e},CLEAR_AUTH_DATA(t){t.token=null,t.user=null},SET_LOADING(t,e){t.loading=e},SET_ERROR(t,e){t.error=e}};var x={namespaced:!0,state:S,getters:q,actions:D,mutations:E};s(116);const R={equipmentList:[],totalEquipment:0,currentEquipment:null,categories:[],statuses:[],loading:!1,error:null},T={allEquipment:t=>t.equipmentList,equipmentById:t=>e=>t.equipmentList.find((t=>t.id===e)),totalEquipment:t=>t.totalEquipment,currentEquipment:t=>t.currentEquipment,allCategories:t=>t.categories,categoryById:t=>e=>t.categories.find((t=>t.id===e)),allStatuses:t=>t.statuses,statusById:t=>e=>t.statuses.find((t=>t.id===e)),loading:t=>t.loading,error:t=>t.error},w={async fetchEquipment({commit:t},e={}){t("SET_LOADING",!0);try{const s=await A.get("/equipment",{params:e});return t("SET_EQUIPMENT_LIST",s.data.data),t("SET_TOTAL_EQUIPMENT",s.data.total),s.data}catch(s){throw t("SET_ERROR",s.message||"Ошибка при получении списка оборудования"),s}finally{t("SET_LOADING",!1)}},async fetchEquipmentById({commit:t},e){t("SET_LOADING",!0);try{const s=await A.get(`/equipment/${e}`);return t("SET_CURRENT_EQUIPMENT",s.data),s.data}catch(s){throw t("SET_ERROR",s.message||"Ошибка при получении данных оборудования"),s}finally{t("SET_LOADING",!1)}},async createEquipment({commit:t},e){t("SET_LOADING",!0);try{const s=await A.post("/equipment",e);return t("ADD_EQUIPMENT",s.data),s.data}catch(s){throw t("SET_ERROR",s.message||"Ошибка при создании оборудования"),s}finally{t("SET_LOADING",!1)}},async updateEquipment({commit:t},{id:e,equipmentData:s}){t("SET_LOADING",!0);try{const a=await A.patch(`/equipment/${e}`,s);return t("UPDATE_EQUIPMENT",a.data),a.data}catch(a){throw t("SET_ERROR",a.message||"Ошибка при обновлении оборудования"),a}finally{t("SET_LOADING",!1)}},async deleteEquipment({commit:t},e){t("SET_LOADING",!0);try{await A.delete(`/equipment/${e}`),t("REMOVE_EQUIPMENT",e)}catch(s){throw t("SET_ERROR",s.message||"Ошибка при удалении оборудования"),s}finally{t("SET_LOADING",!1)}},async assignEquipment({commit:t},{id:e,userId:s}){t("SET_LOADING",!0);try{const a=await A.post(`/equipment/${e}/assign`,{userId:s});return t("UPDATE_EQUIPMENT",a.data),a.data}catch(a){throw t("SET_ERROR",a.message||"Ошибка при назначении оборудования"),a}finally{t("SET_LOADING",!1)}},async uploadEquipmentImage({commit:t},{id:e,imageFile:s}){t("SET_LOADING",!0);try{const a=new FormData;a.append("file",s);const i=await A.post(`/equipment/${e}/image`,a,{headers:{"Content-Type":"multipart/form-data"}});return t("UPDATE_EQUIPMENT",i.data),i.data}catch(a){throw t("SET_ERROR",a.message||"Ошибка при загрузке изображения"),a}finally{t("SET_LOADING",!1)}},async fetchCategories({commit:t}){t("SET_LOADING",!0);try{const e=await A.get("/equipment/categories");return t("SET_CATEGORIES",e.data),e.data}catch(e){throw t("SET_ERROR",e.message||"Ошибка при получении категорий"),e}finally{t("SET_LOADING",!1)}},async fetchCategoriesWithCount({commit:t}){t("SET_LOADING",!0);try{const e=await A.get("/equipment/categories/count");return t("SET_CATEGORIES",e.data),e.data}catch(e){throw t("SET_ERROR",e.message||"Ошибка при получении категорий"),e}finally{t("SET_LOADING",!1)}},async createCategory({commit:t},e){t("SET_LOADING",!0);try{const s=await A.post("/equipment/categories",e);return t("ADD_CATEGORY",s.data),s.data}catch(s){throw t("SET_ERROR",s.message||"Ошибка при создании категории"),s}finally{t("SET_LOADING",!1)}},async updateCategory({commit:t},{id:e,categoryData:s}){t("SET_LOADING",!0);try{const a=await A.patch(`/equipment/categories/${e}`,s);return t("UPDATE_CATEGORY",a.data),a.data}catch(a){throw t("SET_ERROR",a.message||"Ошибка при обновлении категории"),a}finally{t("SET_LOADING",!1)}},async deleteCategory({commit:t},e){t("SET_LOADING",!0);try{await A.delete(`/equipment/categories/${e}`),t("REMOVE_CATEGORY",e)}catch(s){throw t("SET_ERROR",s.message||"Ошибка при удалении категории"),s}finally{t("SET_LOADING",!1)}},async fetchStatuses({commit:t}){t("SET_LOADING",!0);try{const e=await A.get("/equipment/statuses");return t("SET_STATUSES",e.data),e.data}catch(e){throw t("SET_ERROR",e.message||"Ошибка при получении статусов"),e}finally{t("SET_LOADING",!1)}},async fetchStatusesWithCount({commit:t}){t("SET_LOADING",!0);try{const e=await A.get("/equipment/statuses/count");return t("SET_STATUSES",e.data),e.data}catch(e){throw t("SET_ERROR",e.message||"Ошибка при получении статусов"),e}finally{t("SET_LOADING",!1)}},async createStatus({commit:t},e){t("SET_LOADING",!0);try{const s=await A.post("/equipment/statuses",e);return t("ADD_STATUS",s.data),s.data}catch(s){throw t("SET_ERROR",s.message||"Ошибка при создании статуса"),s}finally{t("SET_LOADING",!1)}},async updateStatus({commit:t},{id:e,statusData:s}){t("SET_LOADING",!0);try{const a=await A.patch(`/equipment/statuses/${e}`,s);return t("UPDATE_STATUS",a.data),a.data}catch(a){throw t("SET_ERROR",a.message||"Ошибка при обновлении статуса"),a}finally{t("SET_LOADING",!1)}},async deleteStatus({commit:t},e){t("SET_LOADING",!0);try{await A.delete(`/equipment/statuses/${e}`),t("REMOVE_STATUS",e)}catch(s){throw t("SET_ERROR",s.message||"Ошибка при удалении статуса"),s}finally{t("SET_LOADING",!1)}},async changeEquipmentStatus({commit:t},{id:e,statusId:s}){t("SET_LOADING",!0);try{const a=await A.patch(`/equipment/${e}/status`,{statusId:s});return t("UPDATE_EQUIPMENT",a.data),a.data}catch(a){throw t("SET_ERROR",a.message||"Ошибка при изменении статуса оборудования"),a}finally{t("SET_LOADING",!1)}},resetCurrentEquipment({commit:t}){t("SET_CURRENT_EQUIPMENT",null)}},k={SET_EQUIPMENT_LIST(t,e){t.equipmentList=e},SET_TOTAL_EQUIPMENT(t,e){t.totalEquipment=e},SET_CURRENT_EQUIPMENT(t,e){t.currentEquipment=e},ADD_EQUIPMENT(t,e){t.equipmentList.push(e),t.totalEquipment++},UPDATE_EQUIPMENT(t,e){const s=t.equipmentList.findIndex((t=>t.id===e.id));-1!==s&&t.equipmentList.splice(s,1,e),t.currentEquipment&&t.currentEquipment.id===e.id&&(t.currentEquipment=e)},REMOVE_EQUIPMENT(t,e){t.equipmentList=t.equipmentList.filter((t=>t.id!==e)),t.totalEquipment--,t.currentEquipment&&t.currentEquipment.id===e&&(t.currentEquipment=null)},SET_CATEGORIES(t,e){t.categories=e},ADD_CATEGORY(t,e){t.categories.push(e)},UPDATE_CATEGORY(t,e){const s=t.categories.findIndex((t=>t.id===e.id));-1!==s&&t.categories.splice(s,1,e)},REMOVE_CATEGORY(t,e){t.categories=t.categories.filter((t=>t.id!==e))},SET_STATUSES(t,e){t.statuses=e},ADD_STATUS(t,e){t.statuses.push(e)},UPDATE_STATUS(t,e){const s=t.statuses.findIndex((t=>t.id===e.id));-1!==s&&t.statuses.splice(s,1,e)},REMOVE_STATUS(t,e){t.statuses=t.statuses.filter((t=>t.id!==e))},SET_LOADING(t,e){t.loading=e},SET_ERROR(t,e){t.error=e}};var I={namespaced:!0,state:R,getters:T,actions:w,mutations:k};const O={requestsList:[],totalRequests:0,currentRequest:null,requestTypes:[],requestStatuses:[],requestPriorities:[],requestActivities:[],loading:!1,error:null},L={allRequests:t=>t.requestsList,requestById:t=>e=>t.requestsList.find((t=>t.id===e)),totalRequests:t=>t.totalRequests,currentRequest:t=>t.currentRequest,allRequestTypes:t=>t.requestTypes,requestTypeById:t=>e=>t.requestTypes.find((t=>t.id===e)),allRequestStatuses:t=>t.requestStatuses,requestStatusById:t=>e=>t.requestStatuses.find((t=>t.id===e)),allRequestPriorities:t=>t.requestPriorities,requestPriorityById:t=>e=>t.requestPriorities.find((t=>t.id===e)),requestActivities:t=>t.requestActivities,loading:t=>t.loading,error:t=>t.error},U={async fetchRequests({commit:t},e={}){t("SET_LOADING",!0);try{const s=await A.get("/requests",{params:e});return t("SET_REQUESTS_LIST",s.data.data),t("SET_TOTAL_REQUESTS",s.data.total),s.data}catch(s){throw t("SET_ERROR",s.message||"Ошибка при получении списка заявок"),s}finally{t("SET_LOADING",!1)}},async fetchRequestById({commit:t},e){t("SET_LOADING",!0);try{const s=await A.get(`/requests/${e}`);return t("SET_CURRENT_REQUEST",s.data),s.data}catch(s){throw t("SET_ERROR",s.message||"Ошибка при получении данных заявки"),s}finally{t("SET_LOADING",!1)}},async createRequest({commit:t},e){t("SET_LOADING",!0);try{const s=await A.post("/requests",e);return t("ADD_REQUEST",s.data),s.data}catch(s){throw t("SET_ERROR",s.message||"Ошибка при создании заявки"),s}finally{t("SET_LOADING",!1)}},async updateRequest({commit:t},{id:e,requestData:s}){t("SET_LOADING",!0);try{const a=await A.patch(`/requests/${e}`,s);return t("UPDATE_REQUEST",a.data),a.data}catch(a){throw t("SET_ERROR",a.message||"Ошибка при обновлении заявки"),a}finally{t("SET_LOADING",!1)}},async deleteRequest({commit:t},e){t("SET_LOADING",!0);try{await A.delete(`/requests/${e}`),t("REMOVE_REQUEST",e)}catch(s){throw t("SET_ERROR",s.message||"Ошибка при удалении заявки"),s}finally{t("SET_LOADING",!1)}},async changeRequestStatus({commit:t},{id:e,statusId:s,comment:a}){t("SET_LOADING",!0);try{const i=await A.post(`/requests/${e}/status`,{statusId:s,comment:a});return t("UPDATE_REQUEST",i.data),i.data}catch(i){throw t("SET_ERROR",i.message||"Ошибка при изменении статуса заявки"),i}finally{t("SET_LOADING",!1)}},async assignRequest({commit:t},{id:e,userId:s,comment:a}){t("SET_LOADING",!0);try{const i=await A.post(`/requests/${e}/assign`,{userId:s,comment:a});return t("UPDATE_REQUEST",i.data),i.data}catch(i){throw t("SET_ERROR",i.message||"Ошибка при назначении исполнителя"),i}finally{t("SET_LOADING",!1)}},async addRequestComment({commit:t},{id:e,comment:s}){t("SET_LOADING",!0);try{const a=await A.post(`/requests/${e}/comment`,{comment:s});return t("ADD_REQUEST_ACTIVITY",a.data),a.data}catch(a){throw t("SET_ERROR",a.message||"Ошибка при добавлении комментария"),a}finally{t("SET_LOADING",!1)}},async completeRequest({commit:t},{id:e,resolutionComment:s}){t("SET_LOADING",!0);try{const a=await A.post(`/requests/${e}/complete`,{resolutionComment:s});return t("UPDATE_REQUEST",a.data),a.data}catch(a){throw t("SET_ERROR",a.message||"Ошибка при завершении заявки"),a}finally{t("SET_LOADING",!1)}},async cancelRequest({commit:t},{id:e,reason:s}){t("SET_LOADING",!0);try{const a=await A.post(`/requests/${e}/cancel`,{reason:s});return t("UPDATE_REQUEST",a.data),a.data}catch(a){throw t("SET_ERROR",a.message||"Ошибка при отмене заявки"),a}finally{t("SET_LOADING",!1)}},async fetchRequestActivities({commit:t},e){t("SET_LOADING",!0);try{const s=await A.get(`/requests/${e}/activities`);return t("SET_REQUEST_ACTIVITIES",s.data),s.data}catch(s){throw t("SET_ERROR",s.message||"Ошибка при получении активностей заявки"),s}finally{t("SET_LOADING",!1)}},async fetchRequestTypes({commit:t}){t("SET_LOADING",!0);try{const e=await A.get("/request-types");return t("SET_REQUEST_TYPES",e.data),e.data}catch(e){throw t("SET_ERROR",e.message||"Ошибка при получении типов заявок"),e}finally{t("SET_LOADING",!1)}},async fetchRequestStatuses({commit:t}){t("SET_LOADING",!0);try{const e=await A.get("/request-statuses");return t("SET_REQUEST_STATUSES",e.data),e.data}catch(e){throw t("SET_ERROR",e.message||"Ошибка при получении статусов заявок"),e}finally{t("SET_LOADING",!1)}},async fetchRequestPriorities({commit:t}){t("SET_LOADING",!0);try{const e=await A.get("/request-priorities");return t("SET_REQUEST_PRIORITIES",e.data),e.data}catch(e){throw t("SET_ERROR",e.message||"Ошибка при получении приоритетов заявок"),e}finally{t("SET_LOADING",!1)}},resetCurrentRequest({commit:t}){t("SET_CURRENT_REQUEST",null)}},$={SET_REQUESTS_LIST(t,e){t.requestsList=e},SET_TOTAL_REQUESTS(t,e){t.totalRequests=e},SET_CURRENT_REQUEST(t,e){t.currentRequest=e},ADD_REQUEST(t,e){t.requestsList.push(e),t.totalRequests++},UPDATE_REQUEST(t,e){const s=t.requestsList.findIndex((t=>t.id===e.id));-1!==s&&t.requestsList.splice(s,1,e),t.currentRequest&&t.currentRequest.id===e.id&&(t.currentRequest=e)},REMOVE_REQUEST(t,e){t.requestsList=t.requestsList.filter((t=>t.id!==e)),t.totalRequests--,t.currentRequest&&t.currentRequest.id===e&&(t.currentRequest=null)},SET_REQUEST_TYPES(t,e){t.requestTypes=e},SET_REQUEST_STATUSES(t,e){t.requestStatuses=e},SET_REQUEST_PRIORITIES(t,e){t.requestPriorities=e},SET_REQUEST_ACTIVITIES(t,e){t.requestActivities=e},ADD_REQUEST_ACTIVITY(t,e){t.requestActivities.unshift(e)},SET_LOADING(t,e){t.loading=e},SET_ERROR(t,e){t.error=e}};var P={namespaced:!0,state:O,getters:L,actions:U,mutations:$};const N={users:[],technicians:[],totalUsers:0,currentUser:null,loading:!1,error:null},F={allUsers:t=>t.users,totalUsers:t=>t.totalUsers,allTechnicians:t=>t.technicians,currentUser:t=>t.currentUser,loading:t=>t.loading,error:t=>t.error,getUserById:t=>e=>t.users.find((t=>t.id===e))},j={async fetchUsers({commit:t},e={}){t("SET_LOADING",!0);try{const s=await A.get("/users",{params:e});return t("SET_USERS",s.data.data),t("SET_TOTAL_USERS",s.data.total),s.data}catch(s){throw t("SET_ERROR",s.message||"Ошибка при получении списка пользователей"),s}finally{t("SET_LOADING",!1)}},async fetchTechnicians({commit:t}){t("SET_LOADING",!0);try{const e=await A.get("/users/technicians");return t("SET_TECHNICIANS",e.data),e.data}catch(e){throw t("SET_ERROR",e.message||"Ошибка при получении списка техников"),e}finally{t("SET_LOADING",!1)}},async fetchUserById({commit:t},e){t("SET_LOADING",!0);try{const s=await A.get(`/users/${e}`);return t("SET_CURRENT_USER",s.data),s.data}catch(s){throw t("SET_ERROR",s.message||"Ошибка при получении данных пользователя"),s}finally{t("SET_LOADING",!1)}},async createUser({commit:t},e){t("SET_LOADING",!0);try{const s=await A.post("/users",e);return t("ADD_USER",s.data),s.data}catch(s){throw t("SET_ERROR",s.message||"Ошибка при создании пользователя"),s}finally{t("SET_LOADING",!1)}},async updateUser({commit:t},{id:e,userData:s}){t("SET_LOADING",!0);try{const a=await A.patch(`/users/${e}`,s);return t("UPDATE_USER",a.data),a.data}catch(a){throw t("SET_ERROR",a.message||"Ошибка при обновлении пользователя"),a}finally{t("SET_LOADING",!1)}},async resetPassword({commit:t},{id:e,password:s}){t("SET_LOADING",!0);try{await A.post(`/users/${e}/reset-password`,{password:s})}catch(a){throw t("SET_ERROR",a.message||"Ошибка при сбросе пароля"),a}finally{t("SET_LOADING",!1)}},async toggleUserStatus({commit:t},{id:e,isActive:s}){t("SET_LOADING",!0);try{const a=await A.patch(`/users/${e}/status`,{isActive:s});return t("UPDATE_USER",a.data),a.data}catch(a){throw t("SET_ERROR",a.message||"Ошибка при изменении статуса пользователя"),a}finally{t("SET_LOADING",!1)}}},M={SET_USERS(t,e){t.users=e},SET_TOTAL_USERS(t,e){t.totalUsers=e},SET_TECHNICIANS(t,e){t.technicians=e},SET_CURRENT_USER(t,e){t.currentUser=e},ADD_USER(t,e){t.users.push(e)},UPDATE_USER(t,e){const s=t.users.findIndex((t=>t.id===e.id));-1!==s&&t.users.splice(s,1,e);const a=t.technicians.findIndex((t=>t.id===e.id));-1!==a?"technician"===e.role?t.technicians.splice(a,1,e):t.technicians.splice(a,1):"technician"===e.role&&t.technicians.push(e),t.currentUser&&t.currentUser.id===e.id&&(t.currentUser=e)},SET_LOADING(t,e){t.loading=e},SET_ERROR(t,e){t.error=e}};var G={namespaced:!0,state:N,getters:F,actions:j,mutations:M};const Q={notifications:[],nextId:1},W={getNotifications:t=>t.notifications},V={showNotification({commit:t},{type:e,message:s,timeout:a=5e3}){const i=Date.now();return t("ADD_NOTIFICATION",{id:i,type:e,message:s,timeout:a}),i},showSuccess({dispatch:t},e){return t("showNotification",{type:"success",message:e,timeout:5e3})},showError({dispatch:t},e){return t("showNotification",{type:"error",message:e,timeout:8e3})},showWarning({dispatch:t},e){return t("showNotification",{type:"warning",message:e,timeout:7e3})},showInfo({dispatch:t},e){return t("showNotification",{type:"info",message:e,timeout:5e3})},removeNotification({commit:t},e){t("REMOVE_NOTIFICATION",e)},clearNotifications({commit:t}){t("CLEAR_NOTIFICATIONS")}},z={ADD_NOTIFICATION(t,e){t.notifications.push({...e,id:t.nextId++}),e.timeout>0&&setTimeout((()=>{const s=t.notifications.findIndex((t=>t.id===e.id));-1!==s&&t.notifications.splice(s,1)}),e.timeout)},REMOVE_NOTIFICATION(t,e){const s=t.notifications.findIndex((t=>t.id===e));-1!==s&&t.notifications.splice(s,1)},CLEAR_NOTIFICATIONS(t){t.notifications=[]}};var H={namespaced:!0,state:Q,getters:W,actions:V,mutations:z};a.Ay.use(u.Ay);var B=new u.Ay.Store({modules:{auth:x,equipment:I,requests:P,users:G,notification:H}}),Z=s(5840),Y=s(4569),J=s(3224),X=s(7623),K=s(793),tt=s(9975),et=s(4988),st=s(3812),at=s(8748),it=s(4026),rt=s(998),ot=s(2772),nt=s(5475),lt=s(9555),ct=s(376),ut=s(3879),dt=s(5),mt=s(4636),pt=s(6702),ht=function(){var t=this,e=t._self._c;return e(i.A,[e(Z.A,{attrs:{color:"primary",dark:"",app:"",flat:""}},[e(Y.A,{on:{click:function(e){t.drawer=!t.drawer}}}),e(pt.sw,{staticClass:"ml-0 pl-3"},[e("span",[t._v("ATEX")]),e("span",{staticClass:"font-weight-light"},[t._v("Оборудование")])]),e(dt.A),t.isLoggedIn?e(mt.A,{staticClass:"mt-7 hidden-sm-and-down",attrs:{flat:"","hide-details":"","prepend-inner-icon":"mdi-magnify",label:"Поиск...","solo-inverted":"",rounded:"",dense:""}}):t._e(),e(dt.A),t.isLoggedIn?e(X.A,{attrs:{content:t.notificationsCount,value:t.notificationsCount,color:"error",overlap:""}},[e(r.A,{attrs:{icon:""}},[e(o.A,[t._v("mdi-bell")])],1)],1):t._e(),t.isLoggedIn?e(ct.A,{attrs:{bottom:"",left:"","offset-y":"",transition:"slide-y-transition"},scopedSlots:t._u([{key:"activator",fn:function({on:s,attrs:a}){return[e(r.A,t._g(t._b({staticClass:"ml-2",attrs:{"min-width":"0",text:""}},"v-btn",a,!1),s),[e(J.A,{staticClass:"mr-2",attrs:{size:"32",color:"blue lighten-2"}},[e("span",{staticClass:"white--text"},[t._v(t._s(t.userInitials))])]),e("span",{staticClass:"hidden-sm-and-down"},[t._v(t._s(t.userName))]),e(o.A,{attrs:{right:""}},[t._v("mdi-chevron-down")])],1)]}}],null,!1,1274228072)},[e(at.A,[e(it.A,{on:{click:t.onProfile}},[e(nt.A,[e(o.A,[t._v("mdi-account")])],1),e(ot.UZ,[t._v("Профиль")])],1),e(it.A,{on:{click:t.onSettings}},[e(nt.A,[e(o.A,[t._v("mdi-cog")])],1),e(ot.UZ,[t._v("Настройки")])],1),e(tt.A),e(it.A,{on:{click:t.onLogout}},[e(nt.A,[e(o.A,[t._v("mdi-logout")])],1),e(ot.UZ,[t._v("Выйти")])],1)],1)],1):t._e()],1),e(ut.A,{staticClass:"pt-4",attrs:{app:"","mini-variant":t.mini},on:{"update:miniVariant":function(e){t.mini=e},"update:mini-variant":function(e){t.mini=e}},scopedSlots:t._u([t.isAdmin?{key:"append",fn:function(){return[e("div",{staticClass:"pa-2"},[e(r.A,{attrs:{block:"",text:""}},[e(o.A,{attrs:{left:""}},[t._v("mdi-cog")]),t._v(" Администрирование ")],1)],1)]},proxy:!0}:null],null,!0),model:{value:t.drawer,callback:function(e){t.drawer=e},expression:"drawer"}},[e(at.A,{attrs:{nav:""}},[e(it.A,[e(rt.A,[e(st.A,{attrs:{src:s(3153)}})],1),e(ot.pr,[e(ot.UZ,{staticClass:"text-h6"},[t._v("ATEX-Электро")]),e(ot.w,[t._v("ИТ-Инвентаризация")])],1),e(r.A,{attrs:{icon:""},on:{click:function(e){e.stopPropagation(),t.mini=!t.mini}}},[e(o.A,[t._v("mdi-chevron-left")])],1)],1),e(tt.A,{staticClass:"my-2"}),t._l(t.menuItems,(function(s){return e(it.A,{key:s.title,attrs:{to:s.path,link:""}},[e(nt.A,[e(o.A,[t._v(t._s(s.icon))])],1),e(ot.pr,[e(ot.UZ,[t._v(t._s(s.title))])],1)],1)}))],2)],1),e(lt.A,[e(K.A,{staticClass:"pa-4",attrs:{fluid:""}},[e("router-view")],1)],1),e(et.A,{attrs:{app:"",color:"transparent",height:"48",inset:""}},[e("span",{staticClass:"text-caption grey--text"},[t._v(" © "+t._s((new Date).getFullYear())+" ATEX-Электро ")])])],1)},ft=[],gt={name:"MainLayout",data(){return{drawer:!0,mini:!1,menuItems:[{title:"Дашборд",icon:"mdi-view-dashboard",path:"/"},{title:"Оборудование",icon:"mdi-desktop-classic",path:"/equipment"},{title:"Заявки",icon:"mdi-clipboard-text",path:"/requests"},{title:"Категории",icon:"mdi-shape",path:"/categories"},{title:"Пользователи",icon:"mdi-account-group",path:"/users"},{title:"Отчеты",icon:"mdi-chart-bar",path:"/reports"}],notificationsCount:3}},computed:{isLoggedIn(){return!0},isAdmin(){return!0},userName(){return"Иван Иванов"},userInitials(){const t=this.userName;if(!t)return"";const e=t.split(" ");return e.length>=2?`${e[0][0]}${e[1][0]}`:t[0]||""}},methods:{onProfile(){this.$router.push("/profile")},onSettings(){this.$router.push("/settings")},onLogout(){console.log("Logout clicked")}}},yt=gt,vt=(0,p.A)(yt,ht,ft,!1,null,"03b9521c",null),At=vt.exports,_t=function(){var t=this,e=t._self._c;return e(i.A,[e(lt.A,[e("router-view")],1)],1)},bt=[],Ct={name:"BlankLayout"},St=Ct,qt=(0,p.A)(St,_t,bt,!1,null,null,null),Dt=qt.exports,Et=s(623),xt=s(89),Rt=s(1253),Tt=s(2710),wt=s(1231),kt=s(877),It=s(2369),Ot=function(){var t=this,e=t._self._c;return e(K.A,{staticClass:"login-page",attrs:{fluid:"","fill-height":""}},[e(It.A,{attrs:{align:"center",justify:"center"}},[e(wt.A,{attrs:{cols:"12",sm:"8",md:"6",lg:"4"}},[e(xt.A,{staticClass:"elevation-12 rounded-lg"},[e(Rt.ri,{staticClass:"headline primary white--text py-4 justify-center"},[e(st.A,{staticClass:"mr-2",attrs:{src:s(3153),"max-width":"40"}}),t._v(" ATEX-Электро: Система Учета и Заявок ")],1),e(Rt.OQ,{staticClass:"pt-6"},[e(kt.A,{ref:"form",on:{submit:function(e){return e.preventDefault(),t.login.apply(null,arguments)}}},[e(mt.A,{attrs:{rules:t.emailRules,label:"Email",name:"email","prepend-icon":"mdi-email",type:"email",required:"",outlined:"",dense:""},model:{value:t.email,callback:function(e){t.email=e},expression:"email"}}),e(mt.A,{attrs:{rules:t.passwordRules,label:"Пароль",name:"password","prepend-icon":"mdi-lock","append-icon":t.showPassword?"mdi-eye":"mdi-eye-off",type:t.showPassword?"text":"password",required:"",outlined:"",dense:""},on:{"click:append":function(e){t.showPassword=!t.showPassword}},model:{value:t.password,callback:function(e){t.password=e},expression:"password"}}),t.errorMessage?e(Et.A,{staticClass:"mt-4",attrs:{type:"error",dense:"",text:"",dismissible:""}},[t._v(" "+t._s(t.errorMessage)+" ")]):t._e(),e("div",{staticClass:"d-flex align-center justify-space-between mt-2"},[e(Tt.A,{attrs:{label:"Запомнить меня",color:"primary","hide-details":"",dense:""},model:{value:t.rememberMe,callback:function(e){t.rememberMe=e},expression:"rememberMe"}}),e(r.A,{attrs:{text:"",small:"",color:"primary"}},[t._v("Забыли пароль?")])],1)],1)],1),e(tt.A),e(Rt.SL,{staticClass:"pa-4"},[e(dt.A),e(r.A,{attrs:{color:"primary",loading:t.isLoading,large:"",depressed:"",disabled:!t.isFormValid},on:{click:t.login}},[t._v(" Войти в систему ")]),e(dt.A)],1)],1),e("div",{staticClass:"text-center mt-4"},[e("span",{staticClass:"text-body-2 grey--text text--darken-1"},[t._v("© "+t._s((new Date).getFullYear())+" ATEX-Электро. Все права защищены")])])],1)],1)],1)},Lt=[],Ut={name:"LoginView",data(){return{email:"",password:"",showPassword:!1,rememberMe:!1,isLoading:!1,errorMessage:"",emailRules:[t=>!!t||"Email обязателен",t=>/.+@.+\..+/.test(t)||"Email должен быть корректным"],passwordRules:[t=>!!t||"Пароль обязателен",t=>t.length>=6||"Пароль должен содержать не менее 6 символов"]}},computed:{isFormValid(){return this.email&&this.password}},methods:{async login(){if(this.$refs.form.validate()){this.isLoading=!0,this.errorMessage="";try{await new Promise((t=>setTimeout(t,1e3))),this.$router.push("/")}catch(t){console.error("Login error:",t),this.errorMessage=t.response?.data?.message||"Ошибка входа. Проверьте учетные данные."}finally{this.isLoading=!1}}}}},$t=Ut,Pt=(0,p.A)($t,Ot,Lt,!1,null,"a0f65870",null),Nt=Pt.exports,Ft=function(){var t=this,e=t._self._c;return e(K.A,{attrs:{"fill-height":""}},[e(It.A,{attrs:{align:"center",justify:"center"}},[e(wt.A,{staticClass:"text-center",attrs:{cols:"12",sm:"8",md:"6",lg:"4"}},[e(xt.A,{staticClass:"pa-6"},[e(Rt.ri,{staticClass:"text-h4 mb-4"},[t._v("404")]),e(Rt.ZR,{staticClass:"text-h6 mb-4"},[t._v("Страница не найдена")]),e(st.A,{staticClass:"mb-4",attrs:{src:s(6002),alt:"Страница не найдена","max-height":"300",contain:""}}),e(Rt.OQ,[e("p",{staticClass:"mb-4"},[t._v("Запрашиваемая страница не существует или была перемещена.")])]),e(Rt.SL,{staticClass:"justify-center"},[e(r.A,{attrs:{color:"primary",elevation:"2",to:{name:"Dashboard"}}},[t._v(" Вернуться на главную ")])],1)],1)],1)],1)],1)},jt=[],Mt={name:"NotFound"},Gt=Mt,Qt=(0,p.A)(Gt,Ft,jt,!1,null,null,null),Wt=Qt.exports,Vt=s(5137),zt=s(9292),Ht=s(8201),Bt=s(5477),Zt=s(2752),Yt=s(7226),Jt=function(){var t=this,e=t._self._c;return e("div",[e(xt.A,{staticClass:"mb-4",attrs:{flat:""}},[e(Rt.ri,{staticClass:"d-flex align-center py-2"},[e("h1",{staticClass:"text-h5"},[t._v("Обзорная панель")]),e(dt.A),e(r.A,{attrs:{color:"primary",text:"",loading:t.refreshing},on:{click:t.refreshData}},[e(o.A,{attrs:{left:""}},[t._v("mdi-refresh")]),t._v(" Обновить ")],1)],1)],1),e(It.A,[e(wt.A,{attrs:{cols:"12",sm:"6",md:"3"}},[e(xt.A,{attrs:{color:"primary",dark:""}},[e(Rt.OQ,[e("div",{staticClass:"text-h4 font-weight-bold"},[t._v(t._s(t.stats.equipmentTotal))]),e("div",[t._v("Единиц оборудования")]),e(o.A,{staticClass:"position-absolute opacity-6 bottom-0 end-0 mb-4 me-4",attrs:{size:"56"}},[t._v(" mdi-desktop-classic ")])],1)],1)],1),e(wt.A,{attrs:{cols:"12",sm:"6",md:"3"}},[e(xt.A,{attrs:{color:"success",dark:""}},[e(Rt.OQ,[e("div",{staticClass:"text-h4 font-weight-bold"},[t._v(t._s(t.stats.activeRequests))]),e("div",[t._v("Активных заявок")]),e(o.A,{staticClass:"position-absolute opacity-6 bottom-0 end-0 mb-4 me-4",attrs:{size:"56"}},[t._v(" mdi-clipboard-text ")])],1)],1)],1),e(wt.A,{attrs:{cols:"12",sm:"6",md:"3"}},[e(xt.A,{attrs:{color:"info",dark:""}},[e(Rt.OQ,[e("div",{staticClass:"text-h4 font-weight-bold"},[t._v(t._s(t.stats.workingEquipment))]),e("div",[t._v("Рабочее оборудование")]),e(o.A,{staticClass:"position-absolute opacity-6 bottom-0 end-0 mb-4 me-4",attrs:{size:"56"}},[t._v(" mdi-check-circle ")])],1)],1)],1),e(wt.A,{attrs:{cols:"12",sm:"6",md:"3"}},[e(xt.A,{attrs:{color:"warning",dark:""}},[e(Rt.OQ,[e("div",{staticClass:"text-h4 font-weight-bold"},[t._v(t._s(t.stats.needAttention))]),e("div",[t._v("Требует внимания")]),e(o.A,{staticClass:"position-absolute opacity-6 bottom-0 end-0 mb-4 me-4",attrs:{size:"56"}},[t._v(" mdi-alert ")])],1)],1)],1)],1),e(It.A,{staticClass:"mt-4"},[e(wt.A,{attrs:{cols:"12",md:"6"}},[e(xt.A,{attrs:{outlined:"",height:"100%"}},[e(Rt.ri,{staticClass:"py-2 grey lighten-4"},[e(o.A,{attrs:{left:""}},[t._v("mdi-chart-donut")]),t._v(" Распределение оборудования по категориям ")],1),e(Rt.OQ,{staticClass:"pa-4"},[e("canvas",{ref:"categoryChart"}),t.loading?e("div",{staticClass:"text-center"},[e(Ht.A,{attrs:{indeterminate:"",color:"primary"}})],1):t._e()])],1)],1),e(wt.A,{attrs:{cols:"12",md:"6"}},[e(xt.A,{attrs:{outlined:"",height:"100%"}},[e(Rt.ri,{staticClass:"py-2 grey lighten-4"},[e(o.A,{attrs:{left:""}},[t._v("mdi-chart-donut")]),t._v(" Распределение оборудования по статусам ")],1),e(Rt.OQ,{staticClass:"pa-4"},[e("canvas",{ref:"statusChart"}),t.loading?e("div",{staticClass:"text-center"},[e(Ht.A,{attrs:{indeterminate:"",color:"primary"}})],1):t._e()])],1)],1)],1),e(It.A,{staticClass:"mt-4"},[e(wt.A,{attrs:{cols:"12",md:"7"}},[e(xt.A,{attrs:{outlined:""}},[e(Rt.ri,{staticClass:"py-2 grey lighten-4 d-flex align-center"},[e("div",[e(o.A,{attrs:{left:""}},[t._v("mdi-clipboard-text")]),t._v(" Последние заявки ")],1),e(dt.A),e(r.A,{attrs:{text:"",color:"primary",small:"",to:{name:"RequestList"}}},[t._v(" Все заявки "),e(o.A,{attrs:{right:""}},[t._v("mdi-arrow-right")])],1)],1),e(Rt.OQ,{staticClass:"pa-0"},[e(zt.A,{staticClass:"requests-table",attrs:{headers:t.requestHeaders,items:t.recentRequests,loading:t.loading,"hide-default-footer":"","disable-pagination":"","disable-sort":""},scopedSlots:t._u([{key:"item.number",fn:function({item:s}){return[e(r.A,{attrs:{text:"",color:"primary",small:"",to:{name:"RequestDetails",params:{id:s.id}}}},[t._v(" "+t._s(s.number)+" ")])]}},{key:"item.status.name",fn:function({item:s}){return[e(Vt.A,{attrs:{small:"",color:t.getStatusColor(s.status),"text-color":"white"}},[t._v(" "+t._s(s.status?s.status.name:"Не указан")+" ")])]}},{key:"item.createdAt",fn:function({item:e}){return[t._v(" "+t._s(t.formatDateTime(e.createdAt))+" ")]}}])})],1)],1)],1),e(wt.A,{attrs:{cols:"12",md:"5"}},[e(xt.A,{attrs:{outlined:""}},[e(Rt.ri,{staticClass:"py-2 grey lighten-4"},[e(o.A,{attrs:{left:""}},[t._v("mdi-history")]),t._v(" Последние действия ")],1),e(Rt.OQ,{staticClass:"pa-0"},[e(Zt.A,{staticClass:"pt-0",attrs:{dense:""}},[t._l(t.recentActivities,(function(s,a){return e(Yt.A,{key:a,attrs:{color:t.getActivityColor(s.type),small:""}},[e("div",{staticClass:"font-weight-normal"},[e("strong",[t._v(t._s(t.getActivityTitle(s)))]),e("div",[t._v(t._s(s.message))]),e("div",[e("span",{staticClass:"caption grey--text"},[t._v(" "+t._s(t.formatDateTime(s.timestamp))+" ")]),e("span",{staticClass:"caption grey--text ml-2"},[t._v(" "+t._s(s.user?s.user.name:"Система")+" ")])])])])})),t.loading?[e(Yt.A,{attrs:{color:"grey",small:""}},[e(Bt.A,{attrs:{type:"text",width:"250"}})],1),e(Yt.A,{attrs:{color:"grey",small:""}},[e(Bt.A,{attrs:{type:"text",width:"200"}})],1)]:t._e()],2)],1)],1)],1)],1),e(It.A,{staticClass:"mt-4"},[e(wt.A,{attrs:{cols:"12"}},[e(xt.A,{attrs:{outlined:""}},[e(Rt.ri,{staticClass:"py-2 grey lighten-4 d-flex align-center"},[e("div",[e(o.A,{attrs:{left:""}},[t._v("mdi-desktop-classic")]),t._v(" Оборудование, требующее внимания ")],1),e(dt.A),e(r.A,{attrs:{text:"",color:"primary",small:"",to:{name:"EquipmentList"}}},[t._v(" Все оборудование "),e(o.A,{attrs:{right:""}},[t._v("mdi-arrow-right")])],1)],1),e(Rt.OQ,{staticClass:"pa-0"},[e(zt.A,{staticClass:"equipment-table",attrs:{headers:t.equipmentHeaders,items:t.attentionEquipment,loading:t.loading,"hide-default-footer":"","disable-pagination":"","disable-sort":""},scopedSlots:t._u([{key:"item.name",fn:function({item:s}){return[e(r.A,{attrs:{text:"",color:"primary",small:"",to:{name:"EquipmentDetails",params:{id:s.id}}}},[t._v(" "+t._s(s.name)+" ")])]}},{key:"item.status.name",fn:function({item:s}){return[e(Vt.A,{attrs:{small:"",color:t.getEquipmentStatusColor(s.status),"text-color":"white"}},[t._v(" "+t._s(s.status?s.status.name:"Не указан")+" ")])]}},{key:"item.category.name",fn:function({item:e}){return[t._v(" "+t._s(e.category?e.category.name:"Не указана")+" ")]}},{key:"item.actions",fn:function({item:s}){return[e(r.A,{staticClass:"mr-1",attrs:{text:"",small:"",color:"primary",to:{name:"EquipmentDetails",params:{id:s.id}}}},[e(o.A,{attrs:{small:""}},[t._v("mdi-eye")])],1),e(r.A,{staticClass:"mr-1",attrs:{text:"",small:"",color:"success",to:{name:"RequestCreate",query:{equipmentId:s.id}}}},[e(o.A,{attrs:{small:""}},[t._v("mdi-clipboard-plus")])],1)]}}])})],1)],1)],1)],1)],1)},Xt=[],Kt=(s(1701),s(8237),s(4736)),te={name:"DashboardView",data(){return{loading:!0,refreshing:!1,stats:{equipmentTotal:0,activeRequests:0,workingEquipment:0,needAttention:0},recentRequests:[],recentActivities:[],attentionEquipment:[],categoryChart:null,statusChart:null,requestHeaders:[{text:"Номер",value:"number",width:"100px"},{text:"Название",value:"title"},{text:"Статус",value:"status.name",width:"150px"},{text:"Создана",value:"createdAt",width:"150px"}],equipmentHeaders:[{text:"Наименование",value:"name"},{text:"Инв. номер",value:"inventoryNumber",width:"150px"},{text:"Категория",value:"category.name",width:"150px"},{text:"Статус",value:"status.name",width:"150px"},{text:"Действия",value:"actions",width:"100px",sortable:!1,align:"center"}]}},computed:{...(0,u.L8)("auth",["currentUser","isAdmin","isTechnician"]),...(0,u.L8)("equipment",["allCategories","allStatuses"])},created(){this.fetchDashboardData()},mounted(){this.renderCharts()},methods:{async fetchDashboardData(){this.loading=!0;try{const t=await this.$store.dispatch("dashboard/fetchStatistics");this.stats=t;const e=await this.$store.dispatch("dashboard/fetchRecentRequests");this.recentRequests=e;const s=await this.$store.dispatch("dashboard/fetchRecentActivities");this.recentActivities=s;const a=await this.$store.dispatch("dashboard/fetchAttentionEquipment");this.attentionEquipment=a,0===this.allCategories.length&&await this.$store.dispatch("equipment/fetchCategories"),0===this.allStatuses.length&&await this.$store.dispatch("equipment/fetchStatuses"),this.$nextTick((()=>{this.renderCharts()}))}catch(t){this.$store.commit("notification/SHOW_ERROR","Ошибка при загрузке данных для дашборда"),console.error("Dashboard data loading error:",t)}finally{this.loading=!1}},refreshData(){this.refreshing=!0,this.fetchDashboardData().finally((()=>{this.refreshing=!1}))},renderCharts(){this.renderCategoryChart(),this.renderStatusChart()},renderCategoryChart(){if(!this.$refs.categoryChart)return;this.categoryChart&&this.categoryChart.destroy();const t=this.$refs.categoryChart.getContext("2d"),e=this.stats.categoryStats||[],s=e.map((t=>t.category)),a=e.map((t=>t.count)),i=this.generateChartColors(a.length);this.categoryChart=new Kt.Ay(t,{type:"doughnut",data:{labels:s,datasets:[{data:a,backgroundColor:i,borderWidth:1}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"right",labels:{padding:20,boxWidth:10}},tooltip:{callbacks:{label:function(t){const e=t.label||"",s=t.raw||0,a=t.chart.data.datasets[0].data.reduce(((t,e)=>t+e),0),i=Math.round(s/a*100);return`${e}: ${s} (${i}%)`}}}}}})},renderStatusChart(){if(!this.$refs.statusChart)return;this.statusChart&&this.statusChart.destroy();const t=this.$refs.statusChart.getContext("2d"),e=this.stats.statusStats||[],s=e.map((t=>t.status)),a=e.map((t=>t.count)),i=this.getStatusColors(s);this.statusChart=new Kt.Ay(t,{type:"doughnut",data:{labels:s,datasets:[{data:a,backgroundColor:i,borderWidth:1}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"right",labels:{padding:20,boxWidth:10}},tooltip:{callbacks:{label:function(t){const e=t.label||"",s=t.raw||0,a=t.chart.data.datasets[0].data.reduce(((t,e)=>t+e),0),i=Math.round(s/a*100);return`${e}: ${s} (${i}%)`}}}}}})},formatDateTime(t){if(!t)return"-";const e=new Date(t);return new Intl.DateTimeFormat("ru-RU",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}).format(e)},getStatusColor(t){if(!t)return"grey";const e={"Новая":"info","В работе":"primary","Ожидает":"warning","Выполнена":"success","Отменена":"error"};return e[t.name]||t.color||"grey"},getEquipmentStatusColor(t){if(!t)return"grey";const e={"Новый":"info","Рабочий":"success","Дефектный":"warning","Нерабочий":"error"};return e[t.name]||t.color||"grey"},getActivityColor(t){const e={create:"green",update:"blue",statusChange:"orange",comment:"purple",assign:"indigo",complete:"green",cancel:"red"};return e[t]||"grey"},getActivityTitle(t){const e={create:"Создание заявки",update:"Обновление заявки",statusChange:"Изменение статуса",comment:"Комментарий",assign:"Назначение исполнителя",complete:"Завершение заявки",cancel:"Отмена заявки"};return e[t.type]||"Действие"},generateChartColors(t){const e=["#4CAF50","#2196F3","#FFC107","#FF5722","#9C27B0","#3F51B5","#009688","#795548","#607D8B","#E91E63"];if(t<=e.length)return e.slice(0,t);const s=[...e];for(let a=e.length;a<t;a++){const t=Math.floor(200*Math.random())+20,e=Math.floor(200*Math.random())+20,a=Math.floor(200*Math.random())+20;s.push(`rgb(${t}, ${e}, ${a})`)}return s},getStatusColors(t){const e={"Новый":"#2196F3","Рабочий":"#4CAF50","Дефектный":"#FFC107","Нерабочий":"#F44336","Новая":"#2196F3","В работе":"#FF9800","Ожидает":"#FFC107","Выполнена":"#4CAF50","Отменена":"#F44336"};return t.map((t=>e[t]||"#607D8B"))}}},ee=te,se=(0,p.A)(ee,Jt,Xt,!1,null,"9428a32c",null),ae=se.exports,ie=function(){var t=this,e=t._self._c;return e("div",[e(xt.A,{staticClass:"mb-4",attrs:{flat:""}},[e(Rt.ri,{staticClass:"d-flex align-center py-2"},[e("h1",{staticClass:"text-h5"},[t._v("Профиль пользователя")])])],1),e(It.A,[e(wt.A,{attrs:{cols:"12",md:"4"}},[e(xt.A,{staticClass:"mb-4",attrs:{outlined:""}},[e(Rt.OQ,{staticClass:"text-center pa-6"},[e(J.A,{staticClass:"mb-4",attrs:{size:"120",color:"primary"}},[e("span",{staticClass:"white--text text-h4"},[t._v(t._s(t.userInitials))])]),e("h2",{staticClass:"text-h5 mb-2"},[t._v(t._s(t.user.name))]),e("div",{staticClass:"subtitle-1 grey--text mb-4"},[t._v(t._s(t.roleName))]),e(Vt.A,{attrs:{color:t.user.isActive?"success":"error","text-color":"white",small:""}},[t._v(" "+t._s(t.user.isActive?"Активен":"Неактивен")+" ")])],1)],1),e(xt.A,{attrs:{outlined:""}},[e(Rt.ri,{staticClass:"py-2 grey lighten-4"},[e(o.A,{attrs:{left:"",color:"primary"}},[t._v("mdi-briefcase")]),t._v(" Рабочая информация ")],1),e(Rt.OQ,{staticClass:"pa-4"},[e(it.A,{attrs:{"two-line":""}},[e(ot.pr,[e(ot.w,{staticClass:"text-caption grey--text"},[t._v("Отдел")]),e(ot.UZ,[t._v(t._s(t.user.department||"Не указан"))])],1)],1),e(it.A,{attrs:{"two-line":""}},[e(ot.pr,[e(ot.w,{staticClass:"text-caption grey--text"},[t._v("Должность")]),e(ot.UZ,[t._v(t._s(t.user.position||"Не указана"))])],1)],1),e(it.A,{attrs:{"two-line":""}},[e(ot.pr,[e(ot.w,{staticClass:"text-caption grey--text"},[t._v("Роль в системе")]),e(ot.UZ,[t._v(t._s(t.roleName))])],1)],1)],1)],1)],1),e(wt.A,{attrs:{cols:"12",md:"8"}},[e(xt.A,{staticClass:"mb-4",attrs:{outlined:""}},[e(Rt.ri,{staticClass:"py-2 grey lighten-4"},[e(o.A,{attrs:{left:"",color:"primary"}},[t._v("mdi-account-edit")]),t._v(" Редактирование профиля ")],1),e(Rt.OQ,{staticClass:"pa-4"},[e(kt.A,{ref:"form",attrs:{"lazy-validation":""},model:{value:t.valid,callback:function(e){t.valid=e},expression:"valid"}},[e(It.A,[e(wt.A,{attrs:{cols:"12",md:"6"}},[e(mt.A,{attrs:{rules:t.nameRules,label:"ФИО",required:""},model:{value:t.formData.name,callback:function(e){t.$set(t.formData,"name",e)},expression:"formData.name"}})],1),e(wt.A,{attrs:{cols:"12",md:"6"}},[e(mt.A,{attrs:{rules:t.emailRules,label:"Email",required:"",disabled:""},model:{value:t.formData.email,callback:function(e){t.$set(t.formData,"email",e)},expression:"formData.email"}})],1),e(wt.A,{attrs:{cols:"12",md:"6"}},[e(mt.A,{attrs:{label:"Отдел"},model:{value:t.formData.department,callback:function(e){t.$set(t.formData,"department",e)},expression:"formData.department"}})],1),e(wt.A,{attrs:{cols:"12",md:"6"}},[e(mt.A,{attrs:{label:"Должность"},model:{value:t.formData.position,callback:function(e){t.$set(t.formData,"position",e)},expression:"formData.position"}})],1)],1),e(r.A,{attrs:{color:"primary",loading:t.loading,disabled:!t.valid||t.loading},on:{click:t.updateProfile}},[t._v(" Сохранить изменения ")])],1)],1)],1),e(xt.A,{attrs:{outlined:""}},[e(Rt.ri,{staticClass:"py-2 grey lighten-4"},[e(o.A,{attrs:{left:"",color:"primary"}},[t._v("mdi-lock")]),t._v(" Изменение пароля ")],1),e(Rt.OQ,{staticClass:"pa-4"},[e(kt.A,{ref:"passwordForm",attrs:{"lazy-validation":""},model:{value:t.passwordValid,callback:function(e){t.passwordValid=e},expression:"passwordValid"}},[e(It.A,[e(wt.A,{attrs:{cols:"12",md:"6"}},[e(mt.A,{attrs:{rules:t.passwordRules,label:"Текущий пароль",type:"password",required:""},model:{value:t.passwordData.currentPassword,callback:function(e){t.$set(t.passwordData,"currentPassword",e)},expression:"passwordData.currentPassword"}})],1),e(wt.A,{attrs:{cols:"12",md:"6"}},[e(mt.A,{attrs:{rules:t.newPasswordRules,label:"Новый пароль",type:"password",required:""},model:{value:t.passwordData.newPassword,callback:function(e){t.$set(t.passwordData,"newPassword",e)},expression:"passwordData.newPassword"}})],1),e(wt.A,{attrs:{cols:"12"}},[e(mt.A,{attrs:{rules:t.confirmPasswordRules,label:"Подтверждение нового пароля",type:"password",required:""},model:{value:t.passwordData.confirmPassword,callback:function(e){t.$set(t.passwordData,"confirmPassword",e)},expression:"passwordData.confirmPassword"}})],1)],1),e(r.A,{attrs:{color:"primary",loading:t.passwordLoading,disabled:!t.passwordValid||t.passwordLoading},on:{click:t.changePassword}},[t._v(" Изменить пароль ")])],1)],1)],1)],1)],1)],1)},re=[],oe={name:"ProfileView",data(){return{valid:!0,passwordValid:!0,loading:!1,passwordLoading:!1,formData:{name:"",email:"",department:"",position:""},passwordData:{currentPassword:"",newPassword:"",confirmPassword:""},nameRules:[t=>!!t||"ФИО обязательно",t=>t&&t.length>=3||"ФИО должно содержать минимум 3 символа"],emailRules:[t=>!!t||"Email обязателен",t=>/.+@.+\..+/.test(t)||"Email должен быть корректным"],passwordRules:[t=>!!t||"Пароль обязателен"],newPasswordRules:[t=>!!t||"Новый пароль обязателен",t=>t&&t.length>=6||"Пароль должен содержать минимум 6 символов"],confirmPasswordRules:[t=>!!t||"Подтверждение пароля обязательно",t=>t===this.passwordData.newPassword||"Пароли не совпадают"]}},computed:{...(0,u.L8)("auth",["currentUser","isAdmin","isTechnician","isUser"]),user(){return this.currentUser||{}},userInitials(){if(!this.user.name)return"";const t=this.user.name.split(" ");return t.length>=2?`${t[0][0]}${t[1][0]}`:this.user.name[0]||""},roleName(){return this.isAdmin?"Администратор":this.isTechnician?"Техник":this.isUser?"Пользователь":"Не определена"}},created(){this.fetchUserProfile()},methods:{async fetchUserProfile(){try{this.user.id||await this.$store.dispatch("auth/fetchCurrentUser"),this.formData={name:this.user.name||"",email:this.user.email||"",department:this.user.department||"",position:this.user.position||""}}catch(t){this.$store.commit("notification/SHOW_ERROR","Ошибка при загрузке профиля")}},async updateProfile(){if(this.$refs.form.validate()){this.loading=!0;try{await this.$store.dispatch("auth/updateProfile",this.formData),this.$store.commit("notification/SHOW_SUCCESS","Профиль успешно обновлен")}catch(t){this.$store.commit("notification/SHOW_ERROR",t.response?.data?.message||"Ошибка при обновлении профиля")}finally{this.loading=!1}}},async changePassword(){if(this.$refs.passwordForm.validate()){this.passwordLoading=!0;try{await this.$store.dispatch("auth/changePassword",{currentPassword:this.passwordData.currentPassword,newPassword:this.passwordData.newPassword}),this.passwordData={currentPassword:"",newPassword:"",confirmPassword:""},this.$store.commit("notification/SHOW_SUCCESS","Пароль успешно изменен")}catch(t){this.$store.commit("notification/SHOW_ERROR",t.response?.data?.message||"Ошибка при изменении пароля")}finally{this.passwordLoading=!1}}}}},ne=oe,le=(0,p.A)(ne,ie,re,!1,null,null,null),ce=le.exports,ue=s(8936),de=s(6765),me=s(9807),pe=s(5769),he=function(){var t=this,e=t._self._c;return e("div",[e(xt.A,{staticClass:"mb-4",attrs:{flat:""}},[e(Rt.ri,{staticClass:"d-flex align-center py-2"},[e("h1",{staticClass:"text-h5"},[t._v("Настройки системы")])])],1),e(It.A,[e(wt.A,{attrs:{cols:"12",md:"3"}},[e(xt.A,{attrs:{outlined:""}},[e(at.A,{attrs:{nav:"",dense:""}},[e(ue.A,{attrs:{color:"primary"},model:{value:t.selectedTab,callback:function(e){t.selectedTab=e},expression:"selectedTab"}},t._l(t.tabs,(function(s,a){return e(it.A,{key:a,attrs:{value:a}},[e(nt.A,[e(o.A,[t._v(t._s(s.icon))])],1),e(ot.pr,[e(ot.UZ,[t._v(t._s(s.title))])],1)],1)})),1)],1)],1)],1),e(wt.A,{attrs:{cols:"12",md:"9"}},[0===t.selectedTab?e(xt.A,{attrs:{outlined:""}},[e(Rt.ri,{staticClass:"py-2 grey lighten-4"},[e(o.A,{attrs:{left:"",color:"primary"}},[t._v("mdi-cog")]),t._v(" Основные настройки ")],1),e(Rt.OQ,{staticClass:"pa-4"},[e(kt.A,{ref:"generalForm",model:{value:t.generalValid,callback:function(e){t.generalValid=e},expression:"generalValid"}},[e(mt.A,{attrs:{label:"Название компании",rules:[t=>!!t||"Название компании обязательно"],required:""},model:{value:t.generalSettings.companyName,callback:function(e){t.$set(t.generalSettings,"companyName",e)},expression:"generalSettings.companyName"}}),e(mt.A,{attrs:{label:"Контактный email",rules:[t=>!!t||"Email обязателен",t=>/.+@.+\..+/.test(t)||"Email должен быть корректным"],required:""},model:{value:t.generalSettings.contactEmail,callback:function(e){t.$set(t.generalSettings,"contactEmail",e)},expression:"generalSettings.contactEmail"}}),e(de.A,{attrs:{items:t.paginationOptions,label:"Записей на странице по умолчанию",rules:[t=>!!t||"Выберите значение"]},model:{value:t.generalSettings.defaultPagination,callback:function(e){t.$set(t.generalSettings,"defaultPagination",e)},expression:"generalSettings.defaultPagination"}}),e(de.A,{attrs:{items:t.languageOptions,label:"Язык по умолчанию",rules:[t=>!!t||"Выберите язык"]},model:{value:t.generalSettings.defaultLanguage,callback:function(e){t.$set(t.generalSettings,"defaultLanguage",e)},expression:"generalSettings.defaultLanguage"}}),e(r.A,{staticClass:"mt-4",attrs:{color:"primary",disabled:!t.generalValid||t.generalLoading,loading:t.generalLoading},on:{click:t.saveGeneralSettings}},[t._v(" Сохранить ")])],1)],1)],1):t._e(),1===t.selectedTab?e(xt.A,{attrs:{outlined:""}},[e(Rt.ri,{staticClass:"py-2 grey lighten-4"},[e(o.A,{attrs:{left:"",color:"primary"}},[t._v("mdi-bell")]),t._v(" Настройки уведомлений ")],1),e(Rt.OQ,{staticClass:"pa-4"},[e(kt.A,{ref:"notificationForm"},[e(pe.A,{staticClass:"mb-2",attrs:{label:"Отправлять уведомления по email",color:"primary"},model:{value:t.notificationSettings.emailNotifications,callback:function(e){t.$set(t.notificationSettings,"emailNotifications",e)},expression:"notificationSettings.emailNotifications"}}),e(pe.A,{staticClass:"ml-4 mb-2",attrs:{label:"Уведомлять о новых заявках",color:"primary",disabled:!t.notificationSettings.emailNotifications},model:{value:t.notificationSettings.newRequestNotification,callback:function(e){t.$set(t.notificationSettings,"newRequestNotification",e)},expression:"notificationSettings.newRequestNotification"}}),e(pe.A,{staticClass:"ml-4 mb-2",attrs:{label:"Уведомлять об изменении статуса заявок",color:"primary",disabled:!t.notificationSettings.emailNotifications},model:{value:t.notificationSettings.statusChangeNotification,callback:function(e){t.$set(t.notificationSettings,"statusChangeNotification",e)},expression:"notificationSettings.statusChangeNotification"}}),e(pe.A,{staticClass:"ml-4 mb-2",attrs:{label:"Уведомлять о назначении заявок",color:"primary",disabled:!t.notificationSettings.emailNotifications},model:{value:t.notificationSettings.assignmentNotification,callback:function(e){t.$set(t.notificationSettings,"assignmentNotification",e)},expression:"notificationSettings.assignmentNotification"}}),e(pe.A,{staticClass:"ml-4 mb-4",attrs:{label:"Уведомлять о новых комментариях",color:"primary",disabled:!t.notificationSettings.emailNotifications},model:{value:t.notificationSettings.commentNotification,callback:function(e){t.$set(t.notificationSettings,"commentNotification",e)},expression:"notificationSettings.commentNotification"}}),e(tt.A,{staticClass:"mb-4"}),e(de.A,{attrs:{items:t.digestOptions,label:"Частота отправки дайджеста",disabled:!t.notificationSettings.emailNotifications},model:{value:t.notificationSettings.digestFrequency,callback:function(e){t.$set(t.notificationSettings,"digestFrequency",e)},expression:"notificationSettings.digestFrequency"}}),e(r.A,{staticClass:"mt-4",attrs:{color:"primary",disabled:!t.notificationSettings.emailNotifications||t.notificationLoading,loading:t.notificationLoading},on:{click:t.saveNotificationSettings}},[t._v(" Сохранить ")]),e(r.A,{staticClass:"mt-4 ml-2",attrs:{color:"secondary",text:"",disabled:t.notificationLoading},on:{click:t.testNotification}},[t._v(" Отправить тестовое уведомление ")])],1)],1)],1):t._e(),2===t.selectedTab?e(xt.A,{attrs:{outlined:""}},[e(Rt.ri,{staticClass:"py-2 grey lighten-4"},[e(o.A,{attrs:{left:"",color:"primary"}},[t._v("mdi-backup-restore")]),t._v(" Резервное копирование ")],1),e(Rt.OQ,{staticClass:"pa-4"},[e("div",{staticClass:"mb-4"},[e(Et.A,{attrs:{type:"info",text:"",dense:""}},[t._v(" Резервное копирование позволяет сохранить данные системы и восстановить их в случае необходимости. ")])],1),e(xt.A,{staticClass:"mb-4",attrs:{outlined:""}},[e(Rt.ri,{staticClass:"subtitle-1"},[t._v("Последнее резервное копирование")]),e(Rt.OQ,[e(It.A,{attrs:{align:"center"}},[e(wt.A,{attrs:{cols:"8"}},[t.backupInfo.lastBackup?e("div",[e("div",[e("strong",[t._v("Дата:")]),t._v(" "+t._s(t.formatDateTime(t.backupInfo.lastBackup.date)))]),e("div",[e("strong",[t._v("Размер:")]),t._v(" "+t._s(t.formatSize(t.backupInfo.lastBackup.size)))]),e("div",[e("strong",[t._v("Статус:")]),t._v(" "+t._s(t.backupInfo.lastBackup.status))])]):e("div",{staticClass:"grey--text"},[t._v(" Резервных копий не найдено ")])]),e(wt.A,{staticClass:"text-right",attrs:{cols:"4"}},[e(r.A,{attrs:{color:"primary",disabled:t.backupLoading,loading:t.backupLoading},on:{click:t.createBackup}},[e(o.A,{attrs:{left:""}},[t._v("mdi-database-export")]),t._v(" Создать резервную копию ")],1)],1)],1)],1)],1),e(xt.A,{attrs:{outlined:""}},[e(Rt.ri,{staticClass:"subtitle-1"},[t._v("Настройки автоматического резервного копирования")]),e(Rt.OQ,[e(kt.A,{ref:"backupForm"},[e(pe.A,{staticClass:"mb-2",attrs:{label:"Включить автоматическое резервное копирование",color:"primary"},model:{value:t.backupSettings.autoBackup,callback:function(e){t.$set(t.backupSettings,"autoBackup",e)},expression:"backupSettings.autoBackup"}}),e(de.A,{staticClass:"mb-2",attrs:{items:t.backupFrequencyOptions,label:"Частота резервного копирования",disabled:!t.backupSettings.autoBackup},model:{value:t.backupSettings.frequency,callback:function(e){t.$set(t.backupSettings,"frequency",e)},expression:"backupSettings.frequency"}}),e(mt.A,{attrs:{label:"Количество хранимых копий",type:"number",min:"1",max:"30",rules:[t=>!!t||"Введите количество копий",t=>t>0||"Значение должно быть больше 0",t=>t<=30||"Значение должно быть не больше 30"],disabled:!t.backupSettings.autoBackup},model:{value:t.backupSettings.keepCount,callback:function(e){t.$set(t.backupSettings,"keepCount",e)},expression:"backupSettings.keepCount"}}),e(r.A,{staticClass:"mt-2",attrs:{color:"primary",disabled:!t.backupSettings.autoBackup||t.backupSettingsLoading,loading:t.backupSettingsLoading},on:{click:t.saveBackupSettings}},[t._v(" Сохранить настройки ")])],1)],1)],1)],1)],1):t._e(),3===t.selectedTab?e(xt.A,{attrs:{outlined:""}},[e(Rt.ri,{staticClass:"py-2 grey lighten-4"},[e(o.A,{attrs:{left:"",color:"primary"}},[t._v("mdi-information")]),t._v(" Информация о системе ")],1),e(Rt.OQ,{staticClass:"pa-4"},[e(It.A,[e(wt.A,{attrs:{cols:"12",md:"6"}},[e(at.A,{attrs:{dense:""}},[e(it.A,[e(ot.pr,[e(ot.w,{staticClass:"text-caption grey--text"},[t._v("Версия системы")]),e(ot.UZ,[t._v(t._s(t.systemInfo.version))])],1)],1),e(it.A,[e(ot.pr,[e(ot.w,{staticClass:"text-caption grey--text"},[t._v("Дата установки")]),e(ot.UZ,[t._v(t._s(t.formatDate(t.systemInfo.installDate)))])],1)],1),e(it.A,[e(ot.pr,[e(ot.w,{staticClass:"text-caption grey--text"},[t._v("Дата последнего обновления")]),e(ot.UZ,[t._v(t._s(t.formatDate(t.systemInfo.lastUpdateDate)))])],1)],1)],1)],1),e(wt.A,{attrs:{cols:"12",md:"6"}},[e(at.A,{attrs:{dense:""}},[e(it.A,[e(ot.pr,[e(ot.w,{staticClass:"text-caption grey--text"},[t._v("Количество пользователей")]),e(ot.UZ,[t._v(t._s(t.systemInfo.userCount))])],1)],1),e(it.A,[e(ot.pr,[e(ot.w,{staticClass:"text-caption grey--text"},[t._v("Количество единиц оборудования")]),e(ot.UZ,[t._v(t._s(t.systemInfo.equipmentCount))])],1)],1),e(it.A,[e(ot.pr,[e(ot.w,{staticClass:"text-caption grey--text"},[t._v("Количество заявок")]),e(ot.UZ,[t._v(t._s(t.systemInfo.requestCount))])],1)],1)],1)],1)],1),e(tt.A,{staticClass:"my-4"}),e(It.A,[e(wt.A,{attrs:{cols:"12"}},[e("h3",{staticClass:"subtitle-1 mb-2"},[t._v("Статус сервисов")]),e(me.A,{scopedSlots:t._u([{key:"default",fn:function(){return[e("thead",[e("tr",[e("th",{staticClass:"text-left"},[t._v("Сервис")]),e("th",{staticClass:"text-left"},[t._v("Статус")]),e("th",{staticClass:"text-left"},[t._v("Время работы")])])]),e("tbody",t._l(t.systemInfo.services,(function(s,a){return e("tr",{key:a},[e("td",[t._v(t._s(s.name))]),e("td",[e(Vt.A,{attrs:{"x-small":"",color:"online"===s.status?"success":"error","text-color":"white"}},[t._v(" "+t._s(s.status)+" ")])],1),e("td",[t._v(t._s(s.uptime))])])})),0)]},proxy:!0}],null,!1,3802868150)})],1)],1),e(It.A,{staticClass:"mt-4"},[e(wt.A,{staticClass:"d-flex",attrs:{cols:"12"}},[e(r.A,{attrs:{color:"primary",loading:t.systemInfoLoading},on:{click:t.refreshSystemInfo}},[e(o.A,{attrs:{left:""}},[t._v("mdi-refresh")]),t._v(" Обновить информацию ")],1),e(dt.A),e(r.A,{attrs:{color:"error",outlined:"",loading:t.clearCacheLoading},on:{click:t.clearCache}},[e(o.A,{attrs:{left:""}},[t._v("mdi-cached")]),t._v(" Очистить кэш ")],1)],1)],1)],1)],1):t._e()],1)],1)],1)},fe=[],ge={name:"SettingsView",data(){return{selectedTab:0,tabs:[{title:"Основные настройки",icon:"mdi-cog"},{title:"Уведомления",icon:"mdi-bell"},{title:"Резервное копирование",icon:"mdi-backup-restore"},{title:"Информация о системе",icon:"mdi-information"}],generalValid:!0,generalLoading:!1,generalSettings:{companyName:'ООО "Атэкс-Электро"',contactEmail:"info@atelex.ru",defaultPagination:10,defaultLanguage:"ru"},paginationOptions:[{text:"10 записей",value:10},{text:"25 записей",value:25},{text:"50 записей",value:50},{text:"100 записей",value:100}],languageOptions:[{text:"Русский",value:"ru"},{text:"English",value:"en"}],notificationLoading:!1,notificationSettings:{emailNotifications:!0,newRequestNotification:!0,statusChangeNotification:!0,assignmentNotification:!0,commentNotification:!1,digestFrequency:"daily"},digestOptions:[{text:"Ежедневно",value:"daily"},{text:"Еженедельно",value:"weekly"},{text:"Никогда",value:"never"}],backupLoading:!1,backupSettingsLoading:!1,backupInfo:{lastBackup:{date:new Date("2025-04-10T14:30:00"),size:15728640,status:"Успешно"}},backupSettings:{autoBackup:!0,frequency:"daily",keepCount:7},backupFrequencyOptions:[{text:"Ежедневно",value:"daily"},{text:"Еженедельно",value:"weekly"},{text:"Ежемесячно",value:"monthly"}],systemInfoLoading:!1,clearCacheLoading:!1,systemInfo:{version:"1.0.0",installDate:new Date("2025-01-15"),lastUpdateDate:new Date("2025-04-01"),userCount:24,equipmentCount:124,requestCount:78,services:[{name:"API Сервер",status:"online",uptime:"10д 5ч 32м"},{name:"База данных",status:"online",uptime:"10д 5ч 30м"},{name:"Сервис уведомлений",status:"online",uptime:"10д 5ч 10м"},{name:"Планировщик задач",status:"online",uptime:"9д 3ч 15м"}]}}},computed:{...(0,u.L8)("auth",["isAdmin"])},created(){this.isAdmin?this.loadSettings():this.$router.push("/")},methods:{async loadSettings(){try{await new Promise((t=>setTimeout(t,500)))}catch(t){this.$store.commit("notification/SHOW_ERROR","Ошибка при загрузке настроек")}},async saveGeneralSettings(){if(this.$refs.generalForm.validate()){this.generalLoading=!0;try{await new Promise((t=>setTimeout(t,800))),this.$store.commit("notification/SHOW_SUCCESS","Основные настройки успешно сохранены")}catch(t){this.$store.commit("notification/SHOW_ERROR","Ошибка при сохранении настроек")}finally{this.generalLoading=!1}}},async saveNotificationSettings(){this.notificationLoading=!0;try{await new Promise((t=>setTimeout(t,800))),this.$store.commit("notification/SHOW_SUCCESS","Настройки уведомлений успешно сохранены")}catch(t){this.$store.commit("notification/SHOW_ERROR","Ошибка при сохранении настроек уведомлений")}finally{this.notificationLoading=!1}},async testNotification(){try{await new Promise((t=>setTimeout(t,800))),this.$store.commit("notification/SHOW_SUCCESS","Тестовое уведомление отправлено")}catch(t){this.$store.commit("notification/SHOW_ERROR","Ошибка при отправке тестового уведомления")}},async createBackup(){this.backupLoading=!0;try{await new Promise((t=>setTimeout(t,2e3))),this.backupInfo.lastBackup={date:new Date,size:Math.floor(2e7*Math.random())+1e7,status:"Успешно"},this.$store.commit("notification/SHOW_SUCCESS","Резервная копия успешно создана")}catch(t){this.$store.commit("notification/SHOW_ERROR","Ошибка при создании резервной копии")}finally{this.backupLoading=!1}},async saveBackupSettings(){this.backupSettingsLoading=!0;try{await new Promise((t=>setTimeout(t,800))),this.$store.commit("notification/SHOW_SUCCESS","Настройки резервного копирования успешно сохранены")}catch(t){this.$store.commit("notification/SHOW_ERROR","Ошибка при сохранении настроек резервного копирования")}finally{this.backupSettingsLoading=!1}},async refreshSystemInfo(){this.systemInfoLoading=!0;try{await new Promise((t=>setTimeout(t,800))),this.$store.commit("notification/SHOW_SUCCESS","Информация о системе успешно обновлена")}catch(t){this.$store.commit("notification/SHOW_ERROR","Ошибка при обновлении информации о системе")}finally{this.systemInfoLoading=!1}},async clearCache(){this.clearCacheLoading=!0;try{await new Promise((t=>setTimeout(t,1500))),this.$store.commit("notification/SHOW_SUCCESS","Кэш успешно очищен")}catch(t){this.$store.commit("notification/SHOW_ERROR","Ошибка при очистке кэша")}finally{this.clearCacheLoading=!1}},formatDate(t){if(!t)return"-";const e=new Date(t);return new Intl.DateTimeFormat("ru-RU",{day:"2-digit",month:"2-digit",year:"numeric"}).format(e)},formatDateTime(t){if(!t)return"-";const e=new Date(t);return new Intl.DateTimeFormat("ru-RU",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}).format(e)},formatSize(t){if(0===t)return"0 Байт";const e=1024,s=["Байт","КБ","МБ","ГБ","ТБ"],a=Math.floor(Math.log(t)/Math.log(e));return parseFloat((t/Math.pow(e,a)).toFixed(2))+" "+s[a]}}},ye=ge,ve=(0,p.A)(ye,he,fe,!1,null,null,null),Ae=ve.exports,_e=s(2872),be=s(4551),Ce=function(){var t=this,e=t._self._c;return e("div",[e(xt.A,{staticClass:"mb-4",attrs:{flat:""}},[e(Rt.ri,{staticClass:"d-flex align-center py-2"},[e("h1",{staticClass:"text-h5"},[t._v("Управление пользователями")]),e(dt.A),e(r.A,{attrs:{color:"primary"},on:{click:t.createUser}},[e(o.A,{attrs:{left:""}},[t._v("mdi-account-plus")]),t._v(" Добавить пользователя ")],1)],1)],1),e(xt.A,{staticClass:"mb-4",attrs:{outlined:""}},[e(Rt.ri,[e(o.A,{attrs:{left:""}},[t._v("mdi-filter")]),t._v(" Фильтры ")],1),e(Rt.OQ,[e(It.A,[e(wt.A,{attrs:{cols:"12",sm:"4"}},[e(mt.A,{attrs:{label:"Поиск","prepend-icon":"mdi-magnify",clearable:""},on:{input:t.applyFilters},model:{value:t.filters.search,callback:function(e){t.$set(t.filters,"search",e)},expression:"filters.search"}})],1),e(wt.A,{attrs:{cols:"12",sm:"4"}},[e(de.A,{attrs:{items:t.roles,label:"Роль","prepend-icon":"mdi-shield-account",clearable:""},on:{change:t.applyFilters},model:{value:t.filters.role,callback:function(e){t.$set(t.filters,"role",e)},expression:"filters.role"}})],1),e(wt.A,{attrs:{cols:"12",sm:"4"}},[e(de.A,{attrs:{items:t.statuses,label:"Статус","prepend-icon":"mdi-account-check",clearable:""},on:{change:t.applyFilters},model:{value:t.filters.status,callback:function(e){t.$set(t.filters,"status",e)},expression:"filters.status"}})],1)],1)],1)],1),e(xt.A,{attrs:{outlined:""}},[e(zt.A,{staticClass:"user-table",attrs:{headers:t.headers,items:t.users,loading:t.loading,"server-items-length":t.totalUsers,options:t.options,"footer-props":{"items-per-page-options":[10,25,50,100],"show-current-page":!0,"show-first-last-page":!0}},on:{"update:options":[function(e){t.options=e},t.fetchUsers]},scopedSlots:t._u([{key:"item.avatar",fn:function({item:s}){return[e(J.A,{attrs:{color:t.getAvatarColor(s),size:"36"}},[e("span",{staticClass:"white--text"},[t._v(t._s(t.getUserInitials(s)))])])]}},{key:"item.role",fn:function({item:s}){return[e(Vt.A,{attrs:{small:"",color:t.getRoleColor(s.role),"text-color":"white"}},[t._v(" "+t._s(t.getRoleName(s.role))+" ")])]}},{key:"item.isActive",fn:function({item:s}){return[e(Vt.A,{attrs:{small:"",color:s.isActive?"success":"error","text-color":"white"}},[t._v(" "+t._s(s.isActive?"Активен":"Неактивен")+" ")])]}},{key:"item.createdAt",fn:function({item:e}){return[t._v(" "+t._s(t.formatDate(e.createdAt))+" ")]}},{key:"item.actions",fn:function({item:s}){return[e(be.A,{attrs:{bottom:""},scopedSlots:t._u([{key:"activator",fn:function({on:a,attrs:i}){return[e(r.A,t._g(t._b({attrs:{icon:"",small:"",color:"primary"},on:{click:function(e){return t.editUser(s)}}},"v-btn",i,!1),a),[e(o.A,{attrs:{small:""}},[t._v("mdi-pencil")])],1)]}}],null,!0)},[e("span",[t._v("Редактировать")])]),e(be.A,{attrs:{bottom:""},scopedSlots:t._u([{key:"activator",fn:function({on:a,attrs:i}){return[e(r.A,t._g(t._b({attrs:{icon:"",small:"",color:s.isActive?"error":"success"},on:{click:function(e){return t.toggleUserStatus(s)}}},"v-btn",i,!1),a),[e(o.A,{attrs:{small:""}},[t._v(t._s(s.isActive?"mdi-account-off":"mdi-account-check"))])],1)]}}],null,!0)},[e("span",[t._v(t._s(s.isActive?"Деактивировать":"Активировать"))])]),e(be.A,{attrs:{bottom:""},scopedSlots:t._u([{key:"activator",fn:function({on:a,attrs:i}){return[e(r.A,t._g(t._b({attrs:{icon:"",small:"",color:"warning"},on:{click:function(e){return t.resetPassword(s)}}},"v-btn",i,!1),a),[e(o.A,{attrs:{small:""}},[t._v("mdi-lock-reset")])],1)]}}],null,!0)},[e("span",[t._v("Сбросить пароль")])])]}}])})],1),e(_e.A,{attrs:{"max-width":"600px",persistent:""},model:{value:t.dialog,callback:function(e){t.dialog=e},expression:"dialog"}},[e(xt.A,[e(Rt.ri,[e("span",{staticClass:"headline"},[t._v(t._s(t.isEditing?"Редактирование пользователя":"Создание пользователя"))])]),e(Rt.OQ,[e(K.A,[e(kt.A,{ref:"form",attrs:{"lazy-validation":""},model:{value:t.valid,callback:function(e){t.valid=e},expression:"valid"}},[e(It.A,[e(wt.A,{attrs:{cols:"12"}},[e(mt.A,{attrs:{rules:t.nameRules,label:"ФИО*",required:""},model:{value:t.formData.name,callback:function(e){t.$set(t.formData,"name",e)},expression:"formData.name"}})],1),e(wt.A,{attrs:{cols:"12"}},[e(mt.A,{attrs:{rules:t.emailRules,label:"Email*",required:"",disabled:t.isEditing},model:{value:t.formData.email,callback:function(e){t.$set(t.formData,"email",e)},expression:"formData.email"}})],1),e(wt.A,{attrs:{cols:"12",sm:"6"}},[e(mt.A,{attrs:{label:"Отдел"},model:{value:t.formData.department,callback:function(e){t.$set(t.formData,"department",e)},expression:"formData.department"}})],1),e(wt.A,{attrs:{cols:"12",sm:"6"}},[e(mt.A,{attrs:{label:"Должность"},model:{value:t.formData.position,callback:function(e){t.$set(t.formData,"position",e)},expression:"formData.position"}})],1),e(wt.A,{attrs:{cols:"12"}},[e(de.A,{attrs:{items:t.roles,rules:t.roleRules,label:"Роль*",required:""},model:{value:t.formData.role,callback:function(e){t.$set(t.formData,"role",e)},expression:"formData.role"}})],1),t.isEditing?t._e():e(wt.A,{attrs:{cols:"12"}},[e(mt.A,{attrs:{rules:t.passwordRules,label:"Пароль*",type:"password",required:""},model:{value:t.formData.password,callback:function(e){t.$set(t.formData,"password",e)},expression:"formData.password"}})],1),e(wt.A,{attrs:{cols:"12"}},[e(pe.A,{attrs:{label:"Активен",color:"success"},model:{value:t.formData.isActive,callback:function(e){t.$set(t.formData,"isActive",e)},expression:"formData.isActive"}})],1)],1)],1)],1),e("small",[t._v("*обязательные поля")])],1),e(Rt.SL,[e(dt.A),e(r.A,{attrs:{color:"blue darken-1",text:""},on:{click:t.closeDialog}},[t._v("Отмена")]),e(r.A,{attrs:{color:"blue darken-1",text:"",disabled:!t.valid||t.loading,loading:t.loading},on:{click:t.saveUser}},[t._v(" Сохранить ")])],1)],1)],1),e(_e.A,{attrs:{"max-width":"500px"},model:{value:t.resetDialog,callback:function(e){t.resetDialog=e},expression:"resetDialog"}},[e(xt.A,[e(Rt.ri,[e("span",{staticClass:"headline"},[t._v("Сброс пароля")])]),e(Rt.OQ,[e("p",{staticClass:"mb-3"},[t._v("Вы собираетесь сбросить пароль для пользователя "),e("strong",[t._v(t._s(t.selectedUser?t.selectedUser.name:""))]),t._v(".")]),e(kt.A,{ref:"resetForm",attrs:{"lazy-validation":""},model:{value:t.resetValid,callback:function(e){t.resetValid=e},expression:"resetValid"}},[e(mt.A,{attrs:{rules:t.passwordRules,label:"Новый пароль*",type:"password",required:""},model:{value:t.resetData.password,callback:function(e){t.$set(t.resetData,"password",e)},expression:"resetData.password"}}),e(mt.A,{attrs:{rules:t.confirmPasswordRules,label:"Подтверждение пароля*",type:"password",required:""},model:{value:t.resetData.confirmPassword,callback:function(e){t.$set(t.resetData,"confirmPassword",e)},expression:"resetData.confirmPassword"}})],1)],1),e(Rt.SL,[e(dt.A),e(r.A,{attrs:{color:"blue darken-1",text:""},on:{click:function(e){t.resetDialog=!1}}},[t._v("Отмена")]),e(r.A,{attrs:{color:"red darken-1",text:"",disabled:!t.resetValid||t.resetLoading,loading:t.resetLoading},on:{click:t.confirmResetPassword}},[t._v(" Сбросить пароль ")])],1)],1)],1),e(_e.A,{attrs:{"max-width":"500px"},model:{value:t.statusDialog,callback:function(e){t.statusDialog=e},expression:"statusDialog"}},[e(xt.A,[e(Rt.ri,[e("span",{staticClass:"headline"},[t._v(t._s(t.selectedUser&&t.selectedUser.isActive?"Деактивация пользователя":"Активация пользователя"))])]),e(Rt.OQ,[t.selectedUser&&t.selectedUser.isActive?e("p",[t._v(" Вы собираетесь деактивировать пользователя "),e("strong",[t._v(t._s(t.selectedUser.name))]),t._v(". После деактивации пользователь не сможет входить в систему. ")]):t.selectedUser?e("p",[t._v(" Вы собираетесь активировать пользователя "),e("strong",[t._v(t._s(t.selectedUser.name))]),t._v(". После активации пользователь сможет входить в систему. ")]):t._e()]),e(Rt.SL,[e(dt.A),e(r.A,{attrs:{color:"blue darken-1",text:""},on:{click:function(e){t.statusDialog=!1}}},[t._v("Отмена")]),e(r.A,{attrs:{color:t.selectedUser&&t.selectedUser.isActive?"red darken-1":"green darken-1",text:"",loading:t.statusLoading},on:{click:t.confirmToggleStatus}},[t._v(" "+t._s(t.selectedUser&&t.selectedUser.isActive?"Деактивировать":"Активировать")+" ")])],1)],1)],1)],1)},Se=[],qe=s(8221),De=s.n(qe),Ee={name:"UsersView",data(){return{loading:!1,users:[],totalUsers:0,options:{page:1,itemsPerPage:10,sortBy:["name"],sortDesc:[!1]},headers:[{text:"",value:"avatar",sortable:!1,width:"60px"},{text:"ФИО",value:"name",sortable:!0},{text:"Email",value:"email",sortable:!0},{text:"Роль",value:"role",sortable:!0,width:"120px"},{text:"Отдел",value:"department",sortable:!0},{text:"Должность",value:"position",sortable:!0},{text:"Статус",value:"isActive",sortable:!0,width:"120px"},{text:"Дата регистрации",value:"createdAt",sortable:!0,width:"150px"},{text:"Действия",value:"actions",sortable:!1,width:"150px",align:"center"}],filters:{search:"",role:null,status:null},roles:[{text:"Администратор",value:"admin"},{text:"Техник",value:"technician"},{text:"Пользователь",value:"user"}],statuses:[{text:"Активен",value:!0},{text:"Неактивен",value:!1}],dialog:!1,isEditing:!1,valid:!0,formData:{name:"",email:"",department:"",position:"",role:"user",password:"",isActive:!0},selectedUser:null,nameRules:[t=>!!t||"ФИО обязательно",t=>t&&t.length>=3||"ФИО должно содержать минимум 3 символа"],emailRules:[t=>!!t||"Email обязателен",t=>/.+@.+\..+/.test(t)||"Email должен быть корректным"],roleRules:[t=>!!t||"Роль обязательна"],passwordRules:[t=>!!t||"Пароль обязателен",t=>t&&t.length>=6||"Пароль должен содержать минимум 6 символов"],resetDialog:!1,resetValid:!0,resetLoading:!1,resetData:{password:"",confirmPassword:""},confirmPasswordRules:[t=>!!t||"Подтверждение пароля обязательно",t=>t===this.resetData.password||"Пароли не совпадают"],statusDialog:!1,statusLoading:!1}},computed:{...(0,u.L8)("auth",["isAdmin"])},created(){this.debouncedFilter=De()(this.fetchUsers,300),this.fetchUsers()},methods:{async fetchUsers(){if(this.isAdmin){this.loading=!0;try{const{page:t,itemsPerPage:e,sortBy:s,sortDesc:a}=this.options,i={page:t,limit:e,sortBy:s[0]||"name",order:a[0]?"DESC":"ASC",search:this.filters.search||void 0,role:this.filters.role||void 0,isActive:null===this.filters.status?void 0:this.filters.status},r=await this.$store.dispatch("users/fetchUsers",i);this.users=r.data,this.totalUsers=r.total}catch(t){this.$store.commit("notification/SHOW_ERROR","Ошибка при загрузке списка пользователей")}finally{this.loading=!1}}else this.$router.push("/")},applyFilters(){this.options.page=1,this.debouncedFilter()},getUserInitials(t){if(!t||!t.name)return"";const e=t.name.split(" ");return e.length>=2?`${e[0][0]}${e[1][0]}`:t.name[0]||""},getAvatarColor(t){if(!t)return"grey";const e={admin:"purple",technician:"blue",user:"teal"};return e[t.role]||"grey"},getRoleName(t){const e={admin:"Администратор",technician:"Техник",user:"Пользователь"};return e[t]||t},getRoleColor(t){const e={admin:"purple",technician:"blue",user:"teal"};return e[t]||"grey"},formatDate(t){if(!t)return"-";const e=new Date(t);return new Intl.DateTimeFormat("ru-RU",{day:"2-digit",month:"2-digit",year:"numeric"}).format(e)},createUser(){this.isEditing=!1,this.formData={name:"",email:"",department:"",position:"",role:"user",password:"",isActive:!0},this.dialog=!0},editUser(t){this.isEditing=!0,this.selectedUser=t,this.formData={id:t.id,name:t.name,email:t.email,department:t.department||"",position:t.position||"",role:t.role,isActive:t.isActive},this.dialog=!0},async saveUser(){if(this.$refs.form.validate()){this.loading=!0;try{this.isEditing?(await this.$store.dispatch("users/updateUser",{id:this.formData.id,userData:{name:this.formData.name,department:this.formData.department,position:this.formData.position,role:this.formData.role,isActive:this.formData.isActive}}),this.$store.commit("notification/SHOW_SUCCESS","Пользователь успешно обновлен")):(await this.$store.dispatch("users/createUser",this.formData),this.$store.commit("notification/SHOW_SUCCESS","Пользователь успешно создан")),this.closeDialog(),this.fetchUsers()}catch(t){const e=t.response?.data?.message||"Ошибка при сохранении пользователя";this.$store.commit("notification/SHOW_ERROR",e)}finally{this.loading=!1}}},closeDialog(){this.dialog=!1,this.selectedUser=null,this.$refs.form.resetValidation()},resetPassword(t){this.selectedUser=t,this.resetData={password:"",confirmPassword:""},this.resetDialog=!0},async confirmResetPassword(){if(this.$refs.resetForm.validate()){this.resetLoading=!0;try{await this.$store.dispatch("users/resetPassword",{id:this.selectedUser.id,password:this.resetData.password}),this.$store.commit("notification/SHOW_SUCCESS","Пароль успешно сброшен"),this.resetDialog=!1}catch(t){const e=t.response?.data?.message||"Ошибка при сбросе пароля";this.$store.commit("notification/SHOW_ERROR",e)}finally{this.resetLoading=!1}}},toggleUserStatus(t){this.selectedUser=t,this.statusDialog=!0},async confirmToggleStatus(){this.statusLoading=!0;try{await this.$store.dispatch("users/toggleUserStatus",{id:this.selectedUser.id,isActive:!this.selectedUser.isActive});const t=this.selectedUser.isActive?"деактивирован":"активирован";this.$store.commit("notification/SHOW_SUCCESS",`Пользователь успешно ${t}`),this.statusDialog=!1,this.fetchUsers()}catch(t){const e=t.response?.data?.message||"Ошибка при изменении статуса пользователя";this.$store.commit("notification/SHOW_ERROR",e)}finally{this.statusLoading=!1}}},beforeDestroy(){this.debouncedFilter.cancel()}},xe=Ee,Re=(0,p.A)(xe,Ce,Se,!1,null,"6dfd9479",null),Te=Re.exports,we=function(){var t=this,e=t._self._c;return e("div",{staticClass:"equipment-list"},[e(K.A,[e(It.A,[e(wt.A,{attrs:{cols:"12"}},[e(xt.A,[e(Rt.ri,[t._v(" Список оборудования "),e(dt.A),e(mt.A,{attrs:{"append-icon":"mdi-magnify",label:"Поиск","single-line":"","hide-details":""},on:{input:t.debouncedSearch},model:{value:t.search,callback:function(e){t.search=e},expression:"search"}})],1),e(Rt.OQ,[e(It.A,{staticClass:"mb-4"},[e(wt.A,{attrs:{cols:"12",sm:"3"}},[e(de.A,{attrs:{items:t.categories,"item-text":"name","item-value":"id",label:"Категория",clearable:""},on:{change:t.applyFilters},model:{value:t.selectedCategory,callback:function(e){t.selectedCategory=e},expression:"selectedCategory"}})],1),e(wt.A,{attrs:{cols:"12",sm:"3"}},[e(de.A,{attrs:{items:t.statuses,"item-text":"name","item-value":"id",label:"Статус",clearable:""},on:{change:t.applyFilters},model:{value:t.selectedStatus,callback:function(e){t.selectedStatus=e},expression:"selectedStatus"}})],1),e(wt.A,{attrs:{cols:"12",sm:"3"}},[e(mt.A,{attrs:{label:"Инвентарный номер",clearable:""},on:{input:t.debouncedSearch},model:{value:t.inventoryNumberFilter,callback:function(e){t.inventoryNumberFilter=e},expression:"inventoryNumberFilter"}})],1),e(wt.A,{staticClass:"d-flex justify-end align-center",attrs:{cols:"12",sm:"3"}},[e(r.A,{staticClass:"mr-2",attrs:{color:"primary"},on:{click:t.resetFilters}},[t._v(" Сбросить ")]),t.canManageEquipment?e(r.A,{attrs:{color:"success"},on:{click:t.openCreateDialog}},[e(o.A,{attrs:{left:""}},[t._v("mdi-plus")]),t._v(" Добавить ")],1):t._e()],1)],1),e(zt.A,{attrs:{headers:t.headers,items:t.equipment,loading:t.loading,"server-items-length":t.totalItems,options:t.options,"footer-props":{"items-per-page-options":[10,25,50]}},on:{"update:options":[function(e){t.options=e},t.fetchEquipment]},scopedSlots:t._u([{key:"item.image",fn:function({item:s}){return[s.image?e(J.A,{attrs:{size:"36"}},[e("img",{attrs:{src:t.getImageUrl(s.image),alt:"Изображение"}})]):e(o.A,[t._v("mdi-image-off")])]}},{key:"item.category.name",fn:function({item:s}){return[e(Vt.A,{attrs:{small:""}},[t._v(t._s(s.category?s.category.name:"-"))])]}},{key:"item.status.name",fn:function({item:s}){return[e(Vt.A,{attrs:{small:"",color:t.getStatusColor(s.status),"text-color":"white"}},[t._v(" "+t._s(s.status?s.status.name:"-")+" ")])]}},{key:"item.assignedTo.name",fn:function({item:e}){return[t._v(" "+t._s(e.assignedTo?e.assignedTo.name:"Не назначено")+" ")]}},{key:"item.purchaseDate",fn:function({item:e}){return[t._v(" "+t._s(t.formatDate(e.purchaseDate))+" ")]}},{key:"item.actions",fn:function({item:s}){return[e(o.A,{staticClass:"mr-2",attrs:{small:""},on:{click:function(e){return t.viewEquipment(s)}}},[t._v(" mdi-eye ")]),t.canManageEquipment?e(o.A,{staticClass:"mr-2",attrs:{small:""},on:{click:function(e){return t.editEquipment(s)}}},[t._v(" mdi-pencil ")]):t._e(),t.isAdmin?e(o.A,{attrs:{small:""},on:{click:function(e){return t.confirmDelete(s)}}},[t._v(" mdi-delete ")]):t._e()]}}])})],1)],1)],1)],1)],1),e("equipment-form-dialog",{attrs:{dialog:t.dialog,editMode:t.editMode,equipment:t.selectedEquipment},on:{close:t.closeDialog,saved:t.onEquipmentSaved}}),e(_e.A,{attrs:{"max-width":"500px"},model:{value:t.deleteDialog,callback:function(e){t.deleteDialog=e},expression:"deleteDialog"}},[e(xt.A,[e(Rt.ri,{staticClass:"headline"},[t._v("Подтвердите удаление")]),e(Rt.OQ,[t._v(' Вы действительно хотите удалить оборудование "'+t._s(t.selectedEquipment?t.selectedEquipment.name:"")+'"? Это действие нельзя отменить. ')]),e(Rt.SL,[e(dt.A),e(r.A,{attrs:{color:"blue darken-1",text:""},on:{click:function(e){t.deleteDialog=!1}}},[t._v("Отмена")]),e(r.A,{attrs:{color:"red darken-1",text:""},on:{click:t.deleteEquipment}},[t._v("Удалить")])],1)],1)],1)],1)},ke=[],Ie=s(643),Oe=s(1333),Le=function(){var t=this,e=t._self._c;return e(_e.A,{attrs:{"max-width":"800px",persistent:""},model:{value:t.dialogVisible,callback:function(e){t.dialogVisible=e},expression:"dialogVisible"}},[e(xt.A,[e(Rt.ri,[e("span",{staticClass:"headline"},[t._v(t._s(t.editMode?"Редактировать оборудование":"Добавить оборудование"))])]),e(Rt.OQ,[e(K.A,[e(kt.A,{ref:"form",attrs:{"lazy-validation":""},model:{value:t.valid,callback:function(e){t.valid=e},expression:"valid"}},[e(It.A,[e(wt.A,{attrs:{cols:"12",sm:"6"}},[e(mt.A,{attrs:{rules:t.nameRules,label:"Наименование*",required:""},model:{value:t.formData.name,callback:function(e){t.$set(t.formData,"name",e)},expression:"formData.name"}})],1),e(wt.A,{attrs:{cols:"12",sm:"6"}},[e(mt.A,{attrs:{rules:t.inventoryNumberRules,label:"Инвентарный номер*",required:""},model:{value:t.formData.inventoryNumber,callback:function(e){t.$set(t.formData,"inventoryNumber",e)},expression:"formData.inventoryNumber"}})],1),e(wt.A,{attrs:{cols:"12",sm:"6"}},[e(mt.A,{attrs:{label:"Модель"},model:{value:t.formData.model,callback:function(e){t.$set(t.formData,"model",e)},expression:"formData.model"}})],1),e(wt.A,{attrs:{cols:"12",sm:"6"}},[e(de.A,{attrs:{items:t.categories,rules:t.categoryRules,"item-text":"name","item-value":"id",label:"Категория*",required:""},model:{value:t.formData.categoryId,callback:function(e){t.$set(t.formData,"categoryId",e)},expression:"formData.categoryId"}})],1),e(wt.A,{attrs:{cols:"12",sm:"6"}},[e(de.A,{attrs:{items:t.statuses,rules:t.statusRules,"item-text":"name","item-value":"id",label:"Статус*",required:""},model:{value:t.formData.statusId,callback:function(e){t.$set(t.formData,"statusId",e)},expression:"formData.statusId"}})],1),e(wt.A,{attrs:{cols:"12",sm:"6"}},[e(mt.A,{attrs:{label:"Местоположение"},model:{value:t.formData.location,callback:function(e){t.$set(t.formData,"location",e)},expression:"formData.location"}})],1),e(wt.A,{attrs:{cols:"12",sm:"6"}},[e(ct.A,{ref:"dateMenu",attrs:{"close-on-content-click":!1,"return-value":t.formData.purchaseDate,transition:"scale-transition","offset-y":"","min-width":"auto"},on:{"update:returnValue":function(e){return t.$set(t.formData,"purchaseDate",e)},"update:return-value":function(e){return t.$set(t.formData,"purchaseDate",e)}},scopedSlots:t._u([{key:"activator",fn:function({on:s,attrs:a}){return[e(mt.A,t._g(t._b({attrs:{label:"Дата поступления","prepend-icon":"mdi-calendar",readonly:""},model:{value:t.formattedDate,callback:function(e){t.formattedDate=e},expression:"formattedDate"}},"v-text-field",a,!1),s))]}}]),model:{value:t.dateMenu,callback:function(e){t.dateMenu=e},expression:"dateMenu"}},[e(Ie.A,{attrs:{"no-title":"",scrollable:""},on:{input:function(e){t.dateMenu=!1}},model:{value:t.formData.purchaseDate,callback:function(e){t.$set(t.formData,"purchaseDate",e)},expression:"formData.purchaseDate"}},[e(dt.A),e(r.A,{attrs:{text:"",color:"primary"},on:{click:function(e){t.dateMenu=!1}}},[t._v("Отмена")]),e(r.A,{attrs:{text:"",color:"primary"},on:{click:function(e){return t.$refs.dateMenu.save(t.formData.purchaseDate)}}},[t._v("OK")])],1)],1)],1),e(wt.A,{attrs:{cols:"12"}},[e(Oe.A,{attrs:{label:"Описание",rows:"3"},model:{value:t.formData.description,callback:function(e){t.$set(t.formData,"description",e)},expression:"formData.description"}})],1)],1)],1)],1),e("small",[t._v("*обязательные поля")])],1),e(Rt.SL,[e(dt.A),e(r.A,{attrs:{color:"blue darken-1",text:""},on:{click:t.close}},[t._v("Отмена")]),e(r.A,{attrs:{color:"blue darken-1",text:"",disabled:!t.valid||t.loading,loading:t.loading},on:{click:t.save}},[t._v(" Сохранить ")])],1)],1)],1)},Ue=[],$e={name:"EquipmentFormDialog",props:{dialog:{type:Boolean,required:!0},editMode:{type:Boolean,default:!1},equipment:{type:Object,default:null}},data(){return{dialogVisible:this.dialog,valid:!0,loading:!1,dateMenu:!1,formData:{name:"",inventoryNumber:"",model:"",categoryId:"",statusId:"",location:"",purchaseDate:null,description:""},nameRules:[t=>!!t||"Наименование обязательно",t=>t&&t.length>=3||"Наименование должно содержать минимум 3 символа"],inventoryNumberRules:[t=>!!t||"Инвентарный номер обязателен",t=>t&&t.length>=2||"Инвентарный номер должен содержать минимум 2 символа"],categoryRules:[t=>!!t||"Категория обязательна"],statusRules:[t=>!!t||"Статус обязателен"]}},computed:{...(0,u.L8)("equipment",["allCategories","allStatuses"]),categories(){return this.allCategories||[]},statuses(){return this.allStatuses||[]},formattedDate(){if(!this.formData.purchaseDate)return"";const[t,e,s]=this.formData.purchaseDate.split("-");return`${s}.${e}.${t}`}},watch:{dialog(t){this.dialogVisible=t},dialogVisible(t){t||this.$emit("close")},equipment:{handler(t){t?this.formData={name:t.name||"",inventoryNumber:t.inventoryNumber||"",model:t.model||"",categoryId:t.categoryId||"",statusId:t.statusId||"",location:t.location||"",purchaseDate:t.purchaseDate||null,description:t.description||""}:this.resetForm()},immediate:!0}},created(){0===this.categories.length&&this.$store.dispatch("equipment/fetchCategories"),0===this.statuses.length&&this.$store.dispatch("equipment/fetchStatuses")},methods:{close(){this.dialogVisible=!1,this.resetForm()},resetForm(){this.formData={name:"",inventoryNumber:"",model:"",categoryId:"",statusId:"",location:"",purchaseDate:null,description:""},this.$refs.form&&this.$refs.form.resetValidation()},async save(){if(this.$refs.form.validate()){this.loading=!0;try{this.editMode&&this.equipment?(await this.$store.dispatch("equipment/updateEquipment",{id:this.equipment.id,equipmentData:this.formData}),this.$store.commit("notification/SHOW_SUCCESS","Оборудование успешно обновлено")):(await this.$store.dispatch("equipment/createEquipment",this.formData),this.$store.commit("notification/SHOW_SUCCESS","Оборудование успешно добавлено")),this.$emit("saved"),this.close()}catch(t){const e=t.message||"Ошибка при сохранении оборудования";this.$store.commit("notification/SHOW_ERROR",e)}finally{this.loading=!1}}}}},Pe=$e,Ne=(0,p.A)(Pe,Le,Ue,!1,null,null,null),Fe=Ne.exports,je={name:"EquipmentList",components:{EquipmentFormDialog:Fe},data(){return{search:"",selectedCategory:null,selectedStatus:null,inventoryNumberFilter:"",options:{page:1,itemsPerPage:10,sortBy:["name"],sortDesc:[!1]},dialog:!1,editMode:!1,selectedEquipment:null,deleteDialog:!1,headers:[{text:"Фото",value:"image",sortable:!1,width:"80px"},{text:"Наименование",value:"name",sortable:!0},{text:"Инв. номер",value:"inventoryNumber",sortable:!0},{text:"Модель",value:"model",sortable:!0},{text:"Категория",value:"category.name",sortable:!1},{text:"Статус",value:"status.name",sortable:!1},{text:"Местоположение",value:"location",sortable:!0},{text:"Дата поступления",value:"purchaseDate",sortable:!0},{text:"Закреплено за",value:"assignedTo.name",sortable:!1},{text:"Действия",value:"actions",sortable:!1,align:"center",width:"100px"}],totalItems:0,loading:!1}},computed:{...(0,u.L8)("equipment",["allCategories","allStatuses"]),...(0,u.L8)("auth",["isAdmin","isTechnician"]),canManageEquipment(){return this.isAdmin||this.isTechnician},equipment(){return this.$store.state.equipment.equipmentList||[]},categories(){return this.allCategories||[]},statuses(){return this.allStatuses||[]}},created(){this.debouncedSearch=De()(this.applyFilters,300),this.fetchEquipment(),this.loadCategories(),this.loadStatuses()},methods:{...(0,u.i0)("equipment",["fetchEquipment","fetchCategories","fetchStatuses","deleteEquipment"]),loadCategories(){this.fetchCategories()},loadStatuses(){this.fetchStatuses()},async fetchEquipment(){this.loading=!0;try{const t={page:this.options.page,limit:this.options.itemsPerPage,sortBy:this.options.sortBy[0],order:this.options.sortDesc[0]?"DESC":"ASC",search:this.search,categoryId:this.selectedCategory,statusId:this.selectedStatus,inventoryNumber:this.inventoryNumberFilter},e=await this.$store.dispatch("equipment/fetchEquipment",t);this.totalItems=e.total}catch(t){this.$store.commit("notification/SHOW_ERROR","Ошибка при загрузке оборудования")}finally{this.loading=!1}},applyFilters(){this.options.page=1,this.fetchEquipment()},resetFilters(){this.search="",this.selectedCategory=null,this.selectedStatus=null,this.inventoryNumberFilter="",this.applyFilters()},openCreateDialog(){this.editMode=!1,this.selectedEquipment=null,this.dialog=!0},viewEquipment(t){this.$router.push({name:"EquipmentDetails",params:{id:t.id}})},editEquipment(t){this.editMode=!0,this.selectedEquipment=t,this.dialog=!0},closeDialog(){this.dialog=!1,this.selectedEquipment=null},onEquipmentSaved(){this.closeDialog(),this.fetchEquipment()},confirmDelete(t){this.selectedEquipment=t,this.deleteDialog=!0},async deleteEquipment(){try{await this.$store.dispatch("equipment/deleteEquipment",this.selectedEquipment.id),this.$store.commit("notification/SHOW_SUCCESS","Оборудование успешно удалено"),this.deleteDialog=!1,this.fetchEquipment()}catch(t){this.$store.commit("notification/SHOW_ERROR","Ошибка при удалении оборудования")}},formatDate(t){if(!t)return"-";const e=new Date(t);return new Intl.DateTimeFormat("ru-RU").format(e)},getImageUrl(t){return t?`http://localhost:3000/api/files/${t}`:""},getStatusColor(t){return t?t.color||"blue":"grey"}}},Me=je,Ge=(0,p.A)(Me,we,ke,!1,null,"e314c604",null),Qe=Ge.exports,We=function(){var t=this,e=t._self._c;return e("div",[t.loading?e(Bt.A,{attrs:{type:"card, list-item-three-line, divider, paragraph, card-heading"}}):e("div",[e(xt.A,{staticClass:"mb-4",attrs:{flat:""}},[e(Rt.ri,{staticClass:"d-flex align-center py-2"},[e(r.A,{staticClass:"mr-3",attrs:{icon:"",color:"grey darken-1"},on:{click:function(e){return t.$router.go(-1)}}},[e(o.A,[t._v("mdi-arrow-left")])],1),e("h1",{staticClass:"text-h5"},[t._v(t._s(t.equipment.name))]),e(Vt.A,{staticClass:"ml-4",attrs:{color:t.getStatusColor(t.equipment.status),small:"","text-color":"white"}},[t._v(" "+t._s(t.equipment.status?.name||"Статус не указан")+" ")]),e(dt.A),e(r.A,{staticClass:"mr-2",attrs:{color:"primary",text:""},on:{click:t.openCreateRequestDialog}},[e(o.A,{attrs:{left:""}},[t._v("mdi-clipboard-plus")]),t._v(" Создать заявку ")],1),e(r.A,{staticClass:"mr-2",attrs:{color:"success",text:""},on:{click:t.editEquipment}},[e(o.A,{attrs:{left:""}},[t._v("mdi-pencil")]),t._v(" Редактировать ")],1),e(r.A,{attrs:{color:"error",text:""},on:{click:t.deleteEquipment}},[e(o.A,{attrs:{left:""}},[t._v("mdi-delete")]),t._v(" Удалить ")],1)],1)],1),e(It.A,[e(wt.A,{attrs:{cols:"12",md:"8"}},[e(xt.A,{staticClass:"mb-4",attrs:{outlined:""}},[e(Rt.ri,{staticClass:"py-2 grey lighten-4"},[e(o.A,{attrs:{left:"",color:"primary"}},[t._v("mdi-information")]),t._v(" Основная информация ")],1),e(Rt.OQ,{staticClass:"py-3"},[e(It.A,[e(wt.A,{attrs:{cols:"12",md:"6"}},[e(it.A,{attrs:{"two-line":""}},[e(ot.pr,[e(ot.w,{staticClass:"text-caption grey--text"},[t._v("Инвентарный номер")]),e(ot.UZ,{staticClass:"subtitle-1"},[t._v(t._s(t.equipment.inventoryNumber))])],1)],1),e(it.A,{attrs:{"two-line":""}},[e(ot.pr,[e(ot.w,{staticClass:"text-caption grey--text"},[t._v("Модель")]),e(ot.UZ,{staticClass:"subtitle-1"},[t._v(t._s(t.equipment.model||"Не указана"))])],1)],1),e(it.A,{attrs:{"two-line":""}},[e(ot.pr,[e(ot.w,{staticClass:"text-caption grey--text"},[t._v("Категория")]),e(ot.UZ,{staticClass:"subtitle-1"},[t._v(t._s(t.equipment.category?.name||"Не указана"))])],1)],1),e(it.A,{attrs:{"two-line":""}},[e(ot.pr,[e(ot.w,{staticClass:"text-caption grey--text"},[t._v("Ответственный")]),t.equipment.assignedTo?e(ot.UZ,{staticClass:"subtitle-1"},[t._v(" "+t._s(t.equipment.assignedTo.name)+" ("+t._s(t.equipment.assignedTo.department)+") ")]):e(ot.UZ,{staticClass:"subtitle-1"},[e("span",{staticClass:"grey--text"},[t._v("Не назначен")]),e(r.A,{staticClass:"ml-2",attrs:{"x-small":"",text:"",color:"primary"},on:{click:t.assignEquipment}},[t._v(" Назначить ")])],1)],1)],1)],1),e(wt.A,{attrs:{cols:"12",md:"6"}},[e(it.A,{attrs:{"two-line":""}},[e(ot.pr,[e(ot.w,{staticClass:"text-caption grey--text"},[t._v("Статус")]),e(ot.UZ,{staticClass:"subtitle-1"},[e(Vt.A,{staticClass:"mr-2",attrs:{color:t.getStatusColor(t.equipment.status),"x-small":"","text-color":"white"}},[t._v(" "+t._s(t.equipment.status?.name||"Не указан")+" ")]),e(r.A,{attrs:{"x-small":"",text:"",color:"primary"},on:{click:t.changeStatus}},[t._v(" Изменить ")])],1)],1)],1),e(it.A,{attrs:{"two-line":""}},[e(ot.pr,[e(ot.w,{staticClass:"text-caption grey--text"},[t._v("Местоположение")]),e(ot.UZ,{staticClass:"subtitle-1"},[t._v(t._s(t.equipment.location||"Не указано"))])],1)],1),e(it.A,{attrs:{"two-line":""}},[e(ot.pr,[e(ot.w,{staticClass:"text-caption grey--text"},[t._v("Дата поступления")]),e(ot.UZ,{staticClass:"subtitle-1"},[t._v(t._s(t.formatDate(t.equipment.purchaseDate)))])],1)],1),e(it.A,{attrs:{"two-line":""}},[e(ot.pr,[e(ot.w,{staticClass:"text-caption grey--text"},[t._v("Добавлено")]),e(ot.UZ,{staticClass:"subtitle-1"},[t._v(t._s(t.formatDate(t.equipment.createdAt)))])],1)],1)],1)],1)],1)],1),e(xt.A,{staticClass:"mb-4",attrs:{outlined:""}},[e(Rt.ri,{staticClass:"py-2 grey lighten-4"},[e(o.A,{attrs:{left:"",color:"primary"}},[t._v("mdi-text-box")]),t._v(" Описание ")],1),e(Rt.OQ,{staticClass:"py-3"},[t.equipment.description?e("div",[t._v(t._s(t.equipment.description))]):e("div",{staticClass:"grey--text"},[t._v("Описание отсутствует")])])],1),e(xt.A,{staticClass:"mb-4",attrs:{outlined:""}},[e(Rt.ri,{staticClass:"py-2 grey lighten-4 d-flex justify-space-between"},[e("div",[e(o.A,{attrs:{left:"",color:"primary"}},[t._v("mdi-clipboard-list")]),t._v(" Технические характеристики ")],1),e(r.A,{attrs:{small:"",text:"",color:"primary"},on:{click:t.editSpecifications}},[e(o.A,{attrs:{left:""}},[t._v("mdi-pencil")]),t._v(" Редактировать ")],1)],1),t.equipment.specifications&&t.equipment.specifications.length?e(Rt.OQ,{staticClass:"py-0"},[e(me.A,{scopedSlots:t._u([{key:"default",fn:function(){return[e("thead",[e("tr",[e("th",{staticClass:"text-left"},[t._v("Характеристика")]),e("th",{staticClass:"text-left"},[t._v("Значение")])])]),e("tbody",t._l(t.equipment.specifications,(function(s){return e("tr",{key:s.id},[e("td",[t._v(t._s(s.key))]),e("td",[t._v(t._s(s.value)+t._s(s.unit?" "+s.unit:""))])])})),0)]},proxy:!0}],null,!1,3152966755)})],1):e(Rt.OQ,{staticClass:"py-3"},[e("div",{staticClass:"grey--text"},[t._v("Технические характеристики не указаны")])])],1),e(xt.A,{attrs:{outlined:""}},[e(Rt.ri,{staticClass:"py-2 grey lighten-4"},[e(o.A,{attrs:{left:"",color:"primary"}},[t._v("mdi-history")]),t._v(" История заявок ")],1),t.equipmentRequests.length?e(Rt.OQ,{staticClass:"py-0"},[e(Zt.A,{attrs:{dense:""}},t._l(t.equipmentRequests,(function(s){return e(Yt.A,{key:s.id,attrs:{color:t.getRequestStatusColor(s.status),small:""}},[e("div",{staticClass:"d-flex justify-space-between"},[e("div",[e("div",{staticClass:"subtitle-1"},[e("router-link",{staticClass:"text-decoration-none",attrs:{to:`/requests/${s.id}`}},[t._v(" "+t._s(s.number)+" - "+t._s(s.title)+" ")]),e(Vt.A,{staticClass:"ml-2",attrs:{color:t.getRequestStatusColor(s.status),"x-small":"","text-color":"white"}},[t._v(" "+t._s(s.status.name)+" ")])],1),e("div",{staticClass:"text-caption grey--text"},[t._v(" "+t._s(t.formatDateTime(s.createdAt))+" • "+t._s(s.type.name)+" ")])]),e("div",[e(Vt.A,{attrs:{color:t.getRequestPriorityColor(s.priority),outlined:"","x-small":""}},[t._v(" "+t._s(s.priority.name)+" ")])],1)])])})),1)],1):e(Rt.OQ,{staticClass:"py-3"},[e("div",{staticClass:"grey--text"},[t._v("Нет связанных заявок")])])],1)],1),e(wt.A,{attrs:{cols:"12",md:"4"}},[e(xt.A,{staticClass:"mb-4",attrs:{outlined:""}},[e(Rt.ri,{staticClass:"py-2 grey lighten-4 d-flex justify-space-between"},[e("div",[e(o.A,{attrs:{left:"",color:"primary"}},[t._v("mdi-image")]),t._v(" Изображение ")],1),e(r.A,{attrs:{small:"",text:"",color:"primary"},on:{click:t.uploadImage}},[e(o.A,{attrs:{left:""}},[t._v("mdi-upload")]),t._v(" Загрузить ")],1)],1),e(Rt.OQ,{staticClass:"d-flex justify-center pa-6"},[t.equipment.image?e(st.A,{staticClass:"rounded",attrs:{src:`/api/files/${t.equipment.image}`,"max-height":"300",contain:""}}):e("div",{staticClass:"d-flex flex-column align-center justify-center grey lighten-4 rounded",staticStyle:{height:"200px",width:"100%"}},[e(o.A,{attrs:{size:"64",color:"grey lighten-1"}},[t._v("mdi-image-off")]),e("div",{staticClass:"mt-2 grey--text text--darken-1"},[t._v("Изображение отсутствует")])],1)],1)],1),e(xt.A,{staticClass:"mb-4",attrs:{outlined:""}},[e(Rt.ri,{staticClass:"py-2 grey lighten-4"},[e(o.A,{attrs:{left:"",color:"primary"}},[t._v("mdi-qrcode")]),t._v(" QR-код ")],1),e(Rt.OQ,{staticClass:"d-flex justify-center pa-6"},[e("div",{staticClass:"text-center"},[e("img",{staticClass:"rounded",attrs:{src:"https://api.qrserver.com/v1/create-qr-code/?size=150x150&data=Equipment:INV-2023-1001",alt:"QR Code"}}),e("div",{staticClass:"mt-2 text-caption grey--text"},[t._v(" Просканируйте QR-код для быстрого доступа к информации об оборудовании ")])])])],1),e(xt.A,{attrs:{outlined:""}},[e(Rt.ri,{staticClass:"py-2 grey lighten-4"},[e(o.A,{attrs:{left:"",color:"primary"}},[t._v("mdi-cog")]),t._v(" Действия ")],1),e(Rt.OQ,{staticClass:"py-3"},[e(at.A,{attrs:{dense:""}},[e(it.A,{on:{click:t.openCreateRequestDialog}},[e(nt.A,[e(o.A,{attrs:{color:"blue"}},[t._v("mdi-clipboard-plus")])],1),e(ot.pr,[e(ot.UZ,[t._v("Создать заявку")])],1)],1),e(it.A,{on:{click:t.assignEquipment}},[e(nt.A,[e(o.A,{attrs:{color:"green"}},[t._v("mdi-account-plus")])],1),e(ot.pr,[e(ot.UZ,[t._v("Назначить ответственного")])],1)],1),e(it.A,{on:{click:t.changeStatus}},[e(nt.A,[e(o.A,{attrs:{color:"orange"}},[t._v("mdi-tag")])],1),e(ot.pr,[e(ot.UZ,[t._v("Изменить статус")])],1)],1),e(it.A,{on:{click:t.printInfo}},[e(nt.A,[e(o.A,{attrs:{color:"purple"}},[t._v("mdi-printer")])],1),e(ot.pr,[e(ot.UZ,[t._v("Распечатать информацию")])],1)],1),e(it.A,{on:{click:t.deleteEquipment}},[e(nt.A,[e(o.A,{attrs:{color:"red"}},[t._v("mdi-delete")])],1),e(ot.pr,[e(ot.UZ,[t._v("Удалить оборудование")])],1)],1)],1)],1)],1)],1)],1)],1),e(_e.A,{attrs:{"max-width":"500"},model:{value:t.deleteDialog,callback:function(e){t.deleteDialog=e},expression:"deleteDialog"}},[e(xt.A,[e(Rt.ri,{staticClass:"headline"},[t._v(" Удаление оборудования ")]),e(Rt.OQ,[t._v(" Вы действительно хотите удалить оборудование "),e("strong",[t._v(t._s(t.equipment.name))]),t._v("? Это действие нельзя отменить. ")]),e(Rt.SL,[e(dt.A),e(r.A,{attrs:{color:"grey darken-1",text:""},on:{click:function(e){t.deleteDialog=!1}}},[t._v(" Отмена ")]),e(r.A,{attrs:{color:"error",loading:t.deleteLoading},on:{click:t.confirmDelete}},[t._v(" Удалить ")])],1)],1)],1),e(_e.A,{attrs:{"max-width":"500"},model:{value:t.assignDialog,callback:function(e){t.assignDialog=e},expression:"assignDialog"}},[e(xt.A,[e(Rt.ri,{staticClass:"headline"},[t._v(" Назначение ответственного ")]),e(Rt.OQ,[e(de.A,{attrs:{items:t.userOptions,label:"Выберите ответственного",outlined:"",dense:""},model:{value:t.selectedUserId,callback:function(e){t.selectedUserId=e},expression:"selectedUserId"}})],1),e(Rt.SL,[e(dt.A),e(r.A,{attrs:{color:"grey darken-1",text:""},on:{click:function(e){t.assignDialog=!1}}},[t._v(" Отмена ")]),e(r.A,{attrs:{color:"primary",loading:t.assignLoading},on:{click:t.confirmAssign}},[t._v(" Назначить ")])],1)],1)],1),e(_e.A,{attrs:{"max-width":"500"},model:{value:t.statusDialog,callback:function(e){t.statusDialog=e},expression:"statusDialog"}},[e(xt.A,[e(Rt.ri,{staticClass:"headline"},[t._v(" Изменение статуса ")]),e(Rt.OQ,[e(de.A,{attrs:{items:t.statusOptions,label:"Выберите статус",outlined:"",dense:""},model:{value:t.selectedStatusId,callback:function(e){t.selectedStatusId=e},expression:"selectedStatusId"}})],1),e(Rt.SL,[e(dt.A),e(r.A,{attrs:{color:"grey darken-1",text:""},on:{click:function(e){t.statusDialog=!1}}},[t._v(" Отмена ")]),e(r.A,{attrs:{color:"primary",loading:t.statusLoading},on:{click:t.confirmStatusChange}},[t._v(" Изменить ")])],1)],1)],1)],1)},Ve=[],ze={name:"EquipmentDetails",data(){return{loading:!0,deleteLoading:!1,assignLoading:!1,statusLoading:!1,equipment:{id:"",name:"",inventoryNumber:"",model:"",description:"",category:null,status:null,assignedTo:null,location:"",purchaseDate:null,image:null,createdAt:null,updatedAt:null,specifications:[]},equipmentRequests:[],deleteDialog:!1,assignDialog:!1,statusDialog:!1,selectedUserId:null,selectedStatusId:null,userOptions:[{text:"Иванов И.И.",value:"1"},{text:"Петров П.П.",value:"2"},{text:"Сидоров С.С.",value:"3"}],statusOptions:[{text:"Новый",value:"1"},{text:"Рабочий",value:"2"},{text:"Дефектный",value:"3"},{text:"Нерабочий",value:"4"}]}},created(){this.fetchEquipmentDetails()},methods:{async fetchEquipmentDetails(){this.loading=!0;try{await new Promise((t=>setTimeout(t,800))),this.equipment=this.getMockEquipmentDetails(),this.equipmentRequests=this.getMockEquipmentRequests()}catch(t){console.error("Error fetching equipment details:",t),this.$toast.error("Ошибка при загрузке данных об оборудовании")}finally{this.loading=!1}},editEquipment(){this.$router.push(`/equipment/${this.equipment.id}/edit`)},deleteEquipment(){this.deleteDialog=!0},async confirmDelete(){this.deleteLoading=!0;try{await new Promise((t=>setTimeout(t,800))),this.$toast.success("Оборудование успешно удалено"),this.$router.push("/equipment")}catch(t){console.error("Error deleting equipment:",t),this.$toast.error("Ошибка при удалении оборудования")}finally{this.deleteLoading=!1,this.deleteDialog=!1}},assignEquipment(){this.selectedUserId=this.equipment.assignedTo?.id||null,this.assignDialog=!0},async confirmAssign(){this.assignLoading=!0;try{await new Promise((t=>setTimeout(t,800))),this.fetchEquipmentDetails(),this.$toast.success("Ответственный успешно назначен")}catch(t){console.error("Error assigning user:",t),this.$toast.error("Ошибка при назначении ответственного")}finally{this.assignLoading=!1,this.assignDialog=!1}},changeStatus(){this.selectedStatusId=this.equipment.status?.id||null,this.statusDialog=!0},async confirmStatusChange(){this.statusLoading=!0;try{await new Promise((t=>setTimeout(t,800))),this.fetchEquipmentDetails(),this.$toast.success("Статус успешно изменен")}catch(t){console.error("Error changing status:",t),this.$toast.error("Ошибка при изменении статуса")}finally{this.statusLoading=!1,this.statusDialog=!1}},editSpecifications(){this.$router.push(`/equipment/${this.equipment.id}/specifications`)},uploadImage(){this.$toast.info("Функция загрузки изображения будет доступна в следующей версии")},openCreateRequestDialog(){this.$router.push({path:"/requests/create",query:{equipmentId:this.equipment.id}})},printInfo(){window.print()},formatDate(t){if(!t)return"—";const e=new Date(t);return e.toLocaleDateString("ru-RU")},formatDateTime(t){if(!t)return"—";const e=new Date(t);return`${e.toLocaleDateString("ru-RU")} ${e.toLocaleTimeString("ru-RU",{hour:"2-digit",minute:"2-digit"})}`},getStatusColor(t){if(!t)return"grey";const e={"Новый":"info","Рабочий":"success","Дефектный":"warning","Нерабочий":"error"};return e[t.name]||"grey"},getRequestStatusColor(t){if(!t)return"grey";const e={"Новая":"info","В работе":"primary","Ожидает":"warning","Выполнена":"success","Отменена":"error"};return e[t.name]||"grey"},getRequestPriorityColor(t){if(!t)return"grey";const e={"Низкий":"success","Средний":"info","Высокий":"warning","Критический":"error"};return e[t.name]||"grey"},getMockEquipmentDetails(){return{id:"1",name:"Монитор Dell P2419H",inventoryNumber:"INV-2023-1001",model:"P2419H",description:'Монитор Dell 24" с разрешением 1920x1080, IPS-матрицей и регулируемой подставкой. Поддерживает подключение через DisplayPort и HDMI.',category:{id:"1",name:"Мониторы"},status:{id:"2",name:"Рабочий",color:"#28a745"},assignedTo:{id:"1",name:"Иванов И.И.",department:"IT",position:"Администратор"},location:"Офис 302, рабочее место №5",purchaseDate:new Date(2022,3,15),image:"equipment-1.jpg",createdAt:new Date(2022,3,16),updatedAt:new Date(2022,5,20),specifications:[{id:"1",key:"Диагональ",value:"24",unit:"дюйм"},{id:"2",key:"Разрешение",value:"1920x1080",unit:""},{id:"3",key:"Тип матрицы",value:"IPS",unit:""},{id:"4",key:"Частота обновления",value:"60",unit:"Гц"},{id:"5",key:"Интерфейсы",value:"DisplayPort, HDMI, VGA",unit:""}]}},getMockEquipmentRequests(){return[{id:"1",number:"REQ-2023-0001",title:"Настройка монитора",status:{id:"4",name:"Выполнена",color:"#28a745"},type:{id:"1",name:"Ремонт",color:"#dc3545"},priority:{id:"2",name:"Средний",color:"#17a2b8"},createdAt:new Date(2023,1,10)},{id:"2",number:"REQ-2023-0023",title:"Замена кабеля питания",status:{id:"2",name:"В работе",color:"#007bff"},type:{id:"1",name:"Ремонт",color:"#dc3545"},priority:{id:"3",name:"Высокий",color:"#fd7e14"},createdAt:new Date(2023,3,5)}]}}},He=ze,Be=(0,p.A)(He,We,Ve,!1,null,null,null),Ze=Be.exports,Ye=function(){var t=this,e=t._self._c;return e("div",[e(xt.A,{staticClass:"mb-4",attrs:{flat:""}},[e(Rt.ri,{staticClass:"d-flex align-center py-2"},[e("h1",{staticClass:"text-h5"},[t._v("Категории оборудования")]),e(dt.A),e(r.A,{attrs:{color:"primary"},on:{click:t.createCategory}},[e(o.A,{attrs:{left:""}},[t._v("mdi-plus")]),t._v(" Добавить категорию ")],1)],1)],1),e(It.A,[e(wt.A,{attrs:{cols:"12",md:"8"}},[e(xt.A,{attrs:{outlined:""}},[e(zt.A,{staticClass:"elevation-0",attrs:{headers:t.headers,items:t.categories,loading:t.loading,search:t.search,"item-key":"id"},scopedSlots:t._u([{key:"top",fn:function(){return[e(Rt.ri,[e(mt.A,{attrs:{"prepend-icon":"mdi-magnify",label:"Поиск","single-line":"","hide-details":""},model:{value:t.search,callback:function(e){t.search=e},expression:"search"}})],1)]},proxy:!0},{key:"item.equipmentCount",fn:function({item:s}){return[e(Vt.A,{attrs:{small:"",color:"primary",outlined:""}},[t._v(" "+t._s(s.equipmentCount)+" ")])]}},{key:"item.actions",fn:function({item:s}){return[e(r.A,{staticClass:"mr-2",attrs:{icon:"",small:"",color:"primary"},on:{click:function(e){return t.editCategory(s)}}},[e(o.A,{attrs:{small:""}},[t._v("mdi-pencil")])],1),e(r.A,{attrs:{icon:"",small:"",color:"error",disabled:s.equipmentCount>0},on:{click:function(e){return t.deleteCategory(s)}}},[e(o.A,{attrs:{small:""}},[t._v("mdi-delete")])],1)]}},{key:"item.createdAt",fn:function({item:e}){return[t._v(" "+t._s(t.formatDate(e.createdAt))+" ")]}},{key:"no-data",fn:function(){return[e("div",{staticClass:"text-center py-3"},[e(o.A,{attrs:{large:"",color:"grey lighten-1"}},[t._v("mdi-tag-off")]),e("p",{staticClass:"mt-2 grey--text"},[t._v("Нет категорий")])],1)]},proxy:!0}])})],1)],1),e(wt.A,{attrs:{cols:"12",md:"4"}},[e(xt.A,{staticClass:"mb-4",attrs:{outlined:""}},[e(Rt.ri,{staticClass:"py-2 grey lighten-4"},[e(o.A,{attrs:{left:"",color:"primary"}},[t._v("mdi-chart-pie")]),t._v(" Статистика ")],1),e(Rt.OQ,[e("div",{staticClass:"d-flex justify-space-between mb-2"},[e("span",[t._v("Всего категорий:")]),e("span",{staticClass:"font-weight-bold"},[t._v(t._s(t.categories.length))])]),e("div",{staticClass:"d-flex justify-space-between mb-2"},[e("span",[t._v("Категории с оборудованием:")]),e("span",{staticClass:"font-weight-bold"},[t._v(t._s(t.categoriesWithEquipment))])]),e("div",{staticClass:"d-flex justify-space-between"},[e("span",[t._v("Пустые категории:")]),e("span",{staticClass:"font-weight-bold"},[t._v(t._s(t.categories.length-t.categoriesWithEquipment))])])])],1),e(xt.A,{attrs:{outlined:""}},[e(Rt.ri,{staticClass:"py-2 grey lighten-4"},[e(o.A,{attrs:{left:"",color:"primary"}},[t._v("mdi-chart-donut")]),t._v(" Распределение оборудования ")],1),e(Rt.OQ,{staticClass:"pa-4"},[e("canvas",{ref:"categoryChart",attrs:{height:"250"}}),t.loading?e("div",{staticClass:"text-center"},[e(Ht.A,{attrs:{indeterminate:"",color:"primary"}})],1):0===t.categories.length?e("div",{staticClass:"text-center py-3"},[e(o.A,{attrs:{large:"",color:"grey lighten-1"}},[t._v("mdi-chart-donut")]),e("p",{staticClass:"mt-2 grey--text"},[t._v("Нет данных для отображения")])],1):t._e()])],1)],1)],1),e(_e.A,{attrs:{"max-width":"500px",persistent:""},model:{value:t.dialog,callback:function(e){t.dialog=e},expression:"dialog"}},[e(xt.A,[e(Rt.ri,[e("span",{staticClass:"headline"},[t._v(t._s(t.isEditing?"Редактирование категории":"Создание категории"))])]),e(Rt.OQ,[e(kt.A,{ref:"form",attrs:{"lazy-validation":""},model:{value:t.valid,callback:function(e){t.valid=e},expression:"valid"}},[e(mt.A,{attrs:{rules:t.nameRules,label:"Название категории*",required:""},model:{value:t.formData.name,callback:function(e){t.$set(t.formData,"name",e)},expression:"formData.name"}}),e(Oe.A,{attrs:{label:"Описание",rows:"3","auto-grow":""},model:{value:t.formData.description,callback:function(e){t.$set(t.formData,"description",e)},expression:"formData.description"}})],1),e("small",[t._v("*обязательное поле")])],1),e(Rt.SL,[e(dt.A),e(r.A,{attrs:{color:"blue darken-1",text:""},on:{click:t.closeDialog}},[t._v("Отмена")]),e(r.A,{attrs:{color:"blue darken-1",text:"",disabled:!t.valid||t.saveLoading,loading:t.saveLoading},on:{click:t.saveCategory}},[t._v(" Сохранить ")])],1)],1)],1),e(_e.A,{attrs:{"max-width":"500px"},model:{value:t.deleteDialog,callback:function(e){t.deleteDialog=e},expression:"deleteDialog"}},[e(xt.A,[e(Rt.ri,[e("span",{staticClass:"headline"},[t._v("Удаление категории")])]),e(Rt.OQ,[t._v(" Вы действительно хотите удалить категорию "),e("strong",[t._v(t._s(t.selectedCategory?t.selectedCategory.name:""))]),t._v("? "),e("div",{staticClass:"mt-2"},[t.selectedCategory&&t.selectedCategory.equipmentCount>0?e(Et.A,{attrs:{type:"error",text:"",dense:""}},[t._v(" Невозможно удалить категорию, так как к ней привязано "+t._s(t.selectedCategory.equipmentCount)+" единиц оборудования. ")]):e(Et.A,{attrs:{type:"warning",text:"",dense:""}},[t._v(" Это действие нельзя отменить. ")])],1)]),e(Rt.SL,[e(dt.A),e(r.A,{attrs:{color:"blue darken-1",text:""},on:{click:function(e){t.deleteDialog=!1}}},[t._v("Отмена")]),e(r.A,{attrs:{color:"red darken-1",text:"",disabled:t.selectedCategory&&t.selectedCategory.equipmentCount>0||t.deleteLoading,loading:t.deleteLoading},on:{click:t.confirmDelete}},[t._v(" Удалить ")])],1)],1)],1)],1)},Je=[],Xe={name:"CategoryList",data(){return{loading:!1,search:"",categories:[],headers:[{text:"Название",value:"name",sortable:!0},{text:"Описание",value:"description",sortable:!1},{text:"Оборудование",value:"equipmentCount",sortable:!0,align:"center",width:"150px"},{text:"Создана",value:"createdAt",sortable:!0,width:"150px"},{text:"Действия",value:"actions",sortable:!1,align:"center",width:"120px"}],dialog:!1,isEditing:!1,valid:!0,saveLoading:!1,formData:{name:"",description:""},nameRules:[t=>!!t||"Название категории обязательно",t=>t&&t.length>=2||"Название должно содержать минимум 2 символа"],deleteDialog:!1,deleteLoading:!1,selectedCategory:null,categoryChart:null}},computed:{...(0,u.L8)("auth",["isAdmin"]),categoriesWithEquipment(){return this.categories.filter((t=>t.equipmentCount>0)).length}},created(){this.fetchCategories()},mounted(){this.$nextTick((()=>{this.renderChart()}))},methods:{async fetchCategories(){this.loading=!0;try{const t=await this.$store.dispatch("equipment/fetchCategoriesWithCount");this.categories=t,this.$nextTick((()=>{this.renderChart()}))}catch(t){this.$store.commit("notification/SHOW_ERROR","Ошибка при загрузке категорий")}finally{this.loading=!1}},renderChart(){if(!this.$refs.categoryChart||0===this.categories.length)return;this.categoryChart&&this.categoryChart.destroy();const t=this.$refs.categoryChart.getContext("2d"),e=this.categories.filter((t=>t.equipmentCount>0)),s=e.map((t=>t.name)),a=e.map((t=>t.equipmentCount)),i=this.generateChartColors(a.length);this.categoryChart=new Kt.Ay(t,{type:"doughnut",data:{labels:s,datasets:[{data:a,backgroundColor:i,borderWidth:1}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"bottom",labels:{padding:15,boxWidth:10,font:{size:10}}},tooltip:{callbacks:{label:function(t){const e=t.label||"",s=t.raw||0,a=t.chart.data.datasets[0].data.reduce(((t,e)=>t+e),0),i=Math.round(s/a*100);return`${e}: ${s} (${i}%)`}}}}}})},formatDate(t){if(!t)return"-";const e=new Date(t);return new Intl.DateTimeFormat("ru-RU",{day:"2-digit",month:"2-digit",year:"numeric"}).format(e)},createCategory(){this.isEditing=!1,this.formData={name:"",description:""},this.dialog=!0},editCategory(t){this.isEditing=!0,this.selectedCategory=t,this.formData={id:t.id,name:t.name,description:t.description||""},this.dialog=!0},async saveCategory(){if(this.$refs.form.validate()){this.saveLoading=!0;try{this.isEditing?(await this.$store.dispatch("equipment/updateCategory",{id:this.formData.id,categoryData:{name:this.formData.name,description:this.formData.description}}),this.$store.commit("notification/SHOW_SUCCESS","Категория успешно обновлена")):(await this.$store.dispatch("equipment/createCategory",this.formData),this.$store.commit("notification/SHOW_SUCCESS","Категория успешно создана")),this.closeDialog(),this.fetchCategories()}catch(t){const e=t.response?.data?.message||"Ошибка при сохранении категории";this.$store.commit("notification/SHOW_ERROR",e)}finally{this.saveLoading=!1}}},closeDialog(){this.dialog=!1,this.selectedCategory=null,this.$refs.form&&this.$refs.form.resetValidation()},deleteCategory(t){this.selectedCategory=t,this.deleteDialog=!0},async confirmDelete(){if(this.selectedCategory&&!(this.selectedCategory.equipmentCount>0)){this.deleteLoading=!0;try{await this.$store.dispatch("equipment/deleteCategory",this.selectedCategory.id),this.$store.commit("notification/SHOW_SUCCESS","Категория успешно удалена"),this.deleteDialog=!1,this.fetchCategories()}catch(t){const e=t.response?.data?.message||"Ошибка при удалении категории";this.$store.commit("notification/SHOW_ERROR",e)}finally{this.deleteLoading=!1}}},generateChartColors(t){const e=["#4CAF50","#2196F3","#FFC107","#FF5722","#9C27B0","#3F51B5","#009688","#795548","#607D8B","#E91E63"];if(t<=e.length)return e.slice(0,t);const s=[...e];for(let a=e.length;a<t;a++){const t=Math.floor(200*Math.random())+20,e=Math.floor(200*Math.random())+20,a=Math.floor(200*Math.random())+20;s.push(`rgb(${t}, ${e}, ${a})`)}return s}}},Ke=Xe,ts=(0,p.A)(Ke,Ye,Je,!1,null,"264cfeed",null),es=ts.exports,ss=s(3268),as=function(){var t=this,e=t._self._c;return e("div",[e(xt.A,{staticClass:"mb-4",attrs:{flat:""}},[e(Rt.ri,{staticClass:"d-flex align-center py-2"},[e("h1",{staticClass:"text-h5"},[t._v("Статусы оборудования")]),e(dt.A),e(r.A,{attrs:{color:"primary"},on:{click:t.createStatus}},[e(o.A,{attrs:{left:""}},[t._v("mdi-plus")]),t._v(" Добавить статус ")],1)],1)],1),e(It.A,[e(wt.A,{attrs:{cols:"12",md:"8"}},[e(xt.A,{attrs:{outlined:""}},[e(zt.A,{staticClass:"elevation-0",attrs:{headers:t.headers,items:t.statuses,loading:t.loading,search:t.search,"item-key":"id"},scopedSlots:t._u([{key:"top",fn:function(){return[e(Rt.ri,[e(mt.A,{attrs:{"prepend-icon":"mdi-magnify",label:"Поиск","single-line":"","hide-details":""},model:{value:t.search,callback:function(e){t.search=e},expression:"search"}})],1)]},proxy:!0},{key:"item.name",fn:function({item:s}){return[e("div",{staticClass:"d-flex align-center"},[e(J.A,{staticClass:"mr-2",attrs:{size:"10",color:s.color||"#808080"}}),t._v(" "+t._s(s.name)+" ")],1)]}},{key:"item.color",fn:function({item:s}){return[e(Vt.A,{attrs:{small:"",color:s.color||"#808080","text-color":"white"}},[t._v(" "+t._s(s.color||"#808080")+" ")])]}},{key:"item.equipmentCount",fn:function({item:s}){return[e(Vt.A,{attrs:{small:"",color:"primary",outlined:""}},[t._v(" "+t._s(s.equipmentCount)+" ")])]}},{key:"item.actions",fn:function({item:s}){return[e(r.A,{staticClass:"mr-2",attrs:{icon:"",small:"",color:"primary"},on:{click:function(e){return t.editStatus(s)}}},[e(o.A,{attrs:{small:""}},[t._v("mdi-pencil")])],1),e(r.A,{attrs:{icon:"",small:"",color:"error",disabled:s.equipmentCount>0},on:{click:function(e){return t.deleteStatus(s)}}},[e(o.A,{attrs:{small:""}},[t._v("mdi-delete")])],1)]}},{key:"no-data",fn:function(){return[e("div",{staticClass:"text-center py-3"},[e(o.A,{attrs:{large:"",color:"grey lighten-1"}},[t._v("mdi-tag-off")]),e("p",{staticClass:"mt-2 grey--text"},[t._v("Нет статусов")])],1)]},proxy:!0}])})],1)],1),e(wt.A,{attrs:{cols:"12",md:"4"}},[e(xt.A,{staticClass:"mb-4",attrs:{outlined:""}},[e(Rt.ri,{staticClass:"py-2 grey lighten-4"},[e(o.A,{attrs:{left:"",color:"primary"}},[t._v("mdi-chart-pie")]),t._v(" Статистика ")],1),e(Rt.OQ,[e("div",{staticClass:"d-flex justify-space-between mb-2"},[e("span",[t._v("Всего статусов:")]),e("span",{staticClass:"font-weight-bold"},[t._v(t._s(t.statuses.length))])]),e("div",{staticClass:"d-flex justify-space-between mb-2"},[e("span",[t._v("Используются в оборудовании:")]),e("span",{staticClass:"font-weight-bold"},[t._v(t._s(t.statusesWithEquipment))])]),e("div",{staticClass:"d-flex justify-space-between"},[e("span",[t._v("Не используются:")]),e("span",{staticClass:"font-weight-bold"},[t._v(t._s(t.statuses.length-t.statusesWithEquipment))])])])],1),e(xt.A,{attrs:{outlined:""}},[e(Rt.ri,{staticClass:"py-2 grey lighten-4"},[e(o.A,{attrs:{left:"",color:"primary"}},[t._v("mdi-chart-donut")]),t._v(" Распределение оборудования ")],1),e(Rt.OQ,{staticClass:"pa-4"},[e("canvas",{ref:"statusChart",attrs:{height:"250"}}),t.loading?e("div",{staticClass:"text-center"},[e(Ht.A,{attrs:{indeterminate:"",color:"primary"}})],1):0===t.statuses.length?e("div",{staticClass:"text-center py-3"},[e(o.A,{attrs:{large:"",color:"grey lighten-1"}},[t._v("mdi-chart-donut")]),e("p",{staticClass:"mt-2 grey--text"},[t._v("Нет данных для отображения")])],1):t._e()])],1)],1)],1),e(_e.A,{attrs:{"max-width":"500px",persistent:""},model:{value:t.dialog,callback:function(e){t.dialog=e},expression:"dialog"}},[e(xt.A,[e(Rt.ri,[e("span",{staticClass:"headline"},[t._v(t._s(t.isEditing?"Редактирование статуса":"Создание статуса"))])]),e(Rt.OQ,[e(kt.A,{ref:"form",attrs:{"lazy-validation":""},model:{value:t.valid,callback:function(e){t.valid=e},expression:"valid"}},[e(mt.A,{attrs:{rules:t.nameRules,label:"Название статуса*",required:""},model:{value:t.formData.name,callback:function(e){t.$set(t.formData,"name",e)},expression:"formData.name"}}),e(Oe.A,{attrs:{label:"Описание",rows:"3","auto-grow":""},model:{value:t.formData.description,callback:function(e){t.$set(t.formData,"description",e)},expression:"formData.description"}}),e(ss.A,{staticClass:"mb-3",attrs:{"hide-inputs":"","hide-canvas":"","show-swatches":"","swatches-max-height":"200px"},model:{value:t.formData.color,callback:function(e){t.$set(t.formData,"color",e)},expression:"formData.color"}})],1),e("small",[t._v("*обязательное поле")])],1),e(Rt.SL,[e(dt.A),e(r.A,{attrs:{color:"blue darken-1",text:""},on:{click:t.closeDialog}},[t._v("Отмена")]),e(r.A,{attrs:{color:"blue darken-1",text:"",disabled:!t.valid||t.saveLoading,loading:t.saveLoading},on:{click:t.saveStatus}},[t._v(" Сохранить ")])],1)],1)],1),e(_e.A,{attrs:{"max-width":"500px"},model:{value:t.deleteDialog,callback:function(e){t.deleteDialog=e},expression:"deleteDialog"}},[e(xt.A,[e(Rt.ri,[e("span",{staticClass:"headline"},[t._v("Удаление статуса")])]),e(Rt.OQ,[t._v(" Вы действительно хотите удалить статус "),e("strong",[t._v(t._s(t.selectedStatus?t.selectedStatus.name:""))]),t._v("? "),e("div",{staticClass:"mt-2"},[t.selectedStatus&&t.selectedStatus.equipmentCount>0?e(Et.A,{attrs:{type:"error",text:"",dense:""}},[t._v(" Невозможно удалить статус, так как он используется для "+t._s(t.selectedStatus.equipmentCount)+" единиц оборудования. ")]):e(Et.A,{attrs:{type:"warning",text:"",dense:""}},[t._v(" Это действие нельзя отменить. ")])],1)]),e(Rt.SL,[e(dt.A),e(r.A,{attrs:{color:"blue darken-1",text:""},on:{click:function(e){t.deleteDialog=!1}}},[t._v("Отмена")]),e(r.A,{attrs:{color:"red darken-1",text:"",disabled:t.selectedStatus&&t.selectedStatus.equipmentCount>0||t.deleteLoading,loading:t.deleteLoading},on:{click:t.confirmDelete}},[t._v(" Удалить ")])],1)],1)],1)],1)},is=[],rs={name:"StatusList",data(){return{loading:!1,search:"",statuses:[],headers:[{text:"Название",value:"name",sortable:!0},{text:"Описание",value:"description",sortable:!1},{text:"Цвет",value:"color",sortable:!0,width:"150px"},{text:"Оборудование",value:"equipmentCount",sortable:!0,align:"center",width:"150px"},{text:"Действия",value:"actions",sortable:!1,align:"center",width:"120px"}],dialog:!1,isEditing:!1,valid:!0,saveLoading:!1,formData:{name:"",description:"",color:"#2196F3"},nameRules:[t=>!!t||"Название статуса обязательно",t=>t&&t.length>=2||"Название должно содержать минимум 2 символа"],deleteDialog:!1,deleteLoading:!1,selectedStatus:null,statusChart:null}},computed:{...(0,u.L8)("auth",["isAdmin"]),statusesWithEquipment(){return this.statuses.filter((t=>t.equipmentCount>0)).length}},created(){this.fetchStatuses()},mounted(){this.$nextTick((()=>{this.renderChart()}))},methods:{async fetchStatuses(){this.loading=!0;try{const t=await this.$store.dispatch("equipment/fetchStatusesWithCount");this.statuses=t,this.$nextTick((()=>{this.renderChart()}))}catch(t){this.$store.commit("notification/SHOW_ERROR","Ошибка при загрузке статусов")}finally{this.loading=!1}},renderChart(){if(!this.$refs.statusChart||0===this.statuses.length)return;this.statusChart&&this.statusChart.destroy();const t=this.$refs.statusChart.getContext("2d"),e=this.statuses.filter((t=>t.equipmentCount>0)),s=e.map((t=>t.name)),a=e.map((t=>t.equipmentCount)),i=e.map((t=>t.color||"#808080"));this.statusChart=new Kt.Ay(t,{type:"doughnut",data:{labels:s,datasets:[{data:a,backgroundColor:i,borderWidth:1}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"bottom",labels:{padding:15,boxWidth:10,font:{size:10}}},tooltip:{callbacks:{label:function(t){const e=t.label||"",s=t.raw||0,a=t.chart.data.datasets[0].data.reduce(((t,e)=>t+e),0),i=Math.round(s/a*100);return`${e}: ${s} (${i}%)`}}}}}})},createStatus(){this.isEditing=!1,this.formData={name:"",description:"",color:"#2196F3"},this.dialog=!0},editStatus(t){this.isEditing=!0,this.selectedStatus=t,this.formData={id:t.id,name:t.name,description:t.description||"",color:t.color||"#2196F3"},this.dialog=!0},async saveStatus(){if(this.$refs.form.validate()){this.saveLoading=!0;try{this.isEditing?(await this.$store.dispatch("equipment/updateStatus",{id:this.formData.id,statusData:{name:this.formData.name,description:this.formData.description,color:this.formData.color}}),this.$store.commit("notification/SHOW_SUCCESS","Статус успешно обновлен")):(await this.$store.dispatch("equipment/createStatus",this.formData),this.$store.commit("notification/SHOW_SUCCESS","Статус успешно создан")),this.closeDialog(),this.fetchStatuses()}catch(t){const e=t.response?.data?.message||"Ошибка при сохранении статуса";this.$store.commit("notification/SHOW_ERROR",e)}finally{this.saveLoading=!1}}},closeDialog(){this.dialog=!1,this.selectedStatus=null,this.$refs.form&&this.$refs.form.resetValidation()},deleteStatus(t){this.selectedStatus=t,this.deleteDialog=!0},async confirmDelete(){if(this.selectedStatus&&!(this.selectedStatus.equipmentCount>0)){this.deleteLoading=!0;try{await this.$store.dispatch("equipment/deleteStatus",this.selectedStatus.id),this.$store.commit("notification/SHOW_SUCCESS","Статус успешно удален"),this.deleteDialog=!1,this.fetchStatuses()}catch(t){const e=t.response?.data?.message||"Ошибка при удалении статуса";this.$store.commit("notification/SHOW_ERROR",e)}finally{this.deleteLoading=!1}}}}},os=rs,ns=(0,p.A)(os,as,is,!1,null,"828cdb12",null),ls=ns.exports,cs=function(){var t=this,e=t._self._c;return e("div",{staticClass:"request-list"},[e(xt.A,{staticClass:"mb-4",attrs:{flat:""}},[e(Rt.ri,{staticClass:"d-flex align-center py-2"},[e("h1",{staticClass:"text-h5"},[t._v("Управление заявками")]),e(dt.A),e(r.A,{attrs:{color:"primary"},on:{click:t.openCreateDialog}},[e(o.A,{attrs:{left:""}},[t._v("mdi-plus")]),t._v(" Создать заявку ")],1)],1)],1),e(xt.A,{staticClass:"mb-4",attrs:{outlined:""}},[e(Rt.ri,[e(o.A,{attrs:{left:""}},[t._v("mdi-filter")]),t._v(" Фильтры ")],1),e(Rt.OQ,[e(It.A,[e(wt.A,{attrs:{cols:"12",sm:"6",md:"3"}},[e(mt.A,{attrs:{label:"Поиск","prepend-icon":"mdi-magnify",clearable:""},on:{input:t.debouncedSearch},model:{value:t.filters.search,callback:function(e){t.$set(t.filters,"search",e)},expression:"filters.search"}})],1),e(wt.A,{attrs:{cols:"12",sm:"6",md:"3"}},[e(de.A,{attrs:{items:t.requestStatuses,"item-text":"name","item-value":"id",label:"Статус","prepend-icon":"mdi-tag",clearable:""},on:{change:t.applyFilters},model:{value:t.filters.statusId,callback:function(e){t.$set(t.filters,"statusId",e)},expression:"filters.statusId"}})],1),e(wt.A,{attrs:{cols:"12",sm:"6",md:"3"}},[e(de.A,{attrs:{items:t.requestTypes,"item-text":"name","item-value":"id",label:"Тип заявки","prepend-icon":"mdi-clipboard-text",clearable:""},on:{change:t.applyFilters},model:{value:t.filters.typeId,callback:function(e){t.$set(t.filters,"typeId",e)},expression:"filters.typeId"}})],1),e(wt.A,{attrs:{cols:"12",sm:"6",md:"3"}},[e(de.A,{attrs:{items:t.requestPriorities,"item-text":"name","item-value":"id",label:"Приоритет","prepend-icon":"mdi-flag",clearable:""},on:{change:t.applyFilters},model:{value:t.filters.priorityId,callback:function(e){t.$set(t.filters,"priorityId",e)},expression:"filters.priorityId"}})],1)],1),e(It.A,[e(wt.A,{attrs:{cols:"12",sm:"6",md:"3"}},[e(de.A,{attrs:{items:t.technicians,"item-text":"name","item-value":"id",label:"Исполнитель","prepend-icon":"mdi-account-wrench",clearable:""},on:{change:t.applyFilters},model:{value:t.filters.assignedToId,callback:function(e){t.$set(t.filters,"assignedToId",e)},expression:"filters.assignedToId"}})],1),e(wt.A,{attrs:{cols:"12",sm:"6",md:"3"}},[e(ct.A,{ref:"fromDateMenu",attrs:{"close-on-content-click":!1,"return-value":t.filters.dateFrom,transition:"scale-transition","offset-y":"","min-width":"auto"},on:{"update:returnValue":function(e){return t.$set(t.filters,"dateFrom",e)},"update:return-value":function(e){return t.$set(t.filters,"dateFrom",e)}},scopedSlots:t._u([{key:"activator",fn:function({on:s,attrs:a}){return[e(mt.A,t._g(t._b({attrs:{label:"Дата создания от","prepend-icon":"mdi-calendar",readonly:""},model:{value:t.filters.dateFrom,callback:function(e){t.$set(t.filters,"dateFrom",e)},expression:"filters.dateFrom"}},"v-text-field",a,!1),s))]}}]),model:{value:t.fromDateMenu,callback:function(e){t.fromDateMenu=e},expression:"fromDateMenu"}},[e(Ie.A,{attrs:{"no-title":"",scrollable:""},on:{input:function(e){t.fromDateMenu=!1,t.applyFilters()}},model:{value:t.filters.dateFrom,callback:function(e){t.$set(t.filters,"dateFrom",e)},expression:"filters.dateFrom"}})],1)],1),e(wt.A,{attrs:{cols:"12",sm:"6",md:"3"}},[e(ct.A,{ref:"toDateMenu",attrs:{"close-on-content-click":!1,"return-value":t.filters.dateTo,transition:"scale-transition","offset-y":"","min-width":"auto"},on:{"update:returnValue":function(e){return t.$set(t.filters,"dateTo",e)},"update:return-value":function(e){return t.$set(t.filters,"dateTo",e)}},scopedSlots:t._u([{key:"activator",fn:function({on:s,attrs:a}){return[e(mt.A,t._g(t._b({attrs:{label:"Дата создания до","prepend-icon":"mdi-calendar",readonly:""},model:{value:t.filters.dateTo,callback:function(e){t.$set(t.filters,"dateTo",e)},expression:"filters.dateTo"}},"v-text-field",a,!1),s))]}}]),model:{value:t.toDateMenu,callback:function(e){t.toDateMenu=e},expression:"toDateMenu"}},[e(Ie.A,{attrs:{"no-title":"",scrollable:""},on:{input:function(e){t.toDateMenu=!1,t.applyFilters()}},model:{value:t.filters.dateTo,callback:function(e){t.$set(t.filters,"dateTo",e)},expression:"filters.dateTo"}})],1)],1),e(wt.A,{staticClass:"d-flex align-center",attrs:{cols:"12",sm:"6",md:"3"}},[e(Tt.A,{attrs:{label:"Мои заявки"},on:{change:t.applyFilters},model:{value:t.filters.myRequests,callback:function(e){t.$set(t.filters,"myRequests",e)},expression:"filters.myRequests"}}),e(dt.A),e(r.A,{staticClass:"mr-2",attrs:{color:"primary"},on:{click:t.resetFilters}},[t._v(" Сбросить фильтры ")])],1)],1)],1)],1),e(xt.A,{attrs:{outlined:""}},[e(zt.A,{staticClass:"request-table",attrs:{headers:t.headers,items:t.requests,loading:t.loading,"server-items-length":t.totalRequests,options:t.options,"footer-props":{"items-per-page-options":[10,25,50,100],"show-current-page":!0,"show-first-last-page":!0}},on:{"update:options":[function(e){t.options=e},t.fetchRequests]},scopedSlots:t._u([{key:"item.number",fn:function({item:s}){return[e(r.A,{attrs:{text:"",color:"primary",small:"",to:{name:"RequestDetails",params:{id:s.id}}}},[t._v(" "+t._s(s.number)+" ")])]}},{key:"item.type.name",fn:function({item:s}){return[e(Vt.A,{attrs:{small:"",color:t.getRequestTypeColor(s.type),"text-color":"white"}},[t._v(" "+t._s(s.type?s.type.name:"Не указан")+" ")])]}},{key:"item.status.name",fn:function({item:s}){return[e(Vt.A,{attrs:{small:"",color:t.getStatusColor(s.status),"text-color":"white"}},[t._v(" "+t._s(s.status?s.status.name:"Не указан")+" ")])]}},{key:"item.priority.name",fn:function({item:s}){return[e(Vt.A,{attrs:{small:"",outlined:"",color:t.getPriorityColor(s.priority)}},[t._v(" "+t._s(s.priority?s.priority.name:"Не указан")+" ")])]}},{key:"item.createdAt",fn:function({item:e}){return[t._v(" "+t._s(t.formatDate(e.createdAt))+" ")]}},{key:"item.assignedTo.name",fn:function({item:s}){return[s.assignedTo?e("div",[t._v(" "+t._s(s.assignedTo.name)+" ")]):e("div",{staticClass:"grey--text"},[t._v("Не назначен")])]}},{key:"item.actions",fn:function({item:s}){return[e(be.A,{attrs:{bottom:""},scopedSlots:t._u([{key:"activator",fn:function({on:a,attrs:i}){return[e(r.A,t._g(t._b({attrs:{icon:"",small:"",color:"primary",to:{name:"RequestDetails",params:{id:s.id}}}},"v-btn",i,!1),a),[e(o.A,{attrs:{small:""}},[t._v("mdi-eye")])],1)]}}],null,!0)},[e("span",[t._v("Просмотр")])]),t.canEditRequest(s)?e(be.A,{attrs:{bottom:""},scopedSlots:t._u([{key:"activator",fn:function({on:a,attrs:i}){return[e(r.A,t._g(t._b({attrs:{icon:"",small:"",color:"success"},on:{click:function(e){return t.editRequest(s)}}},"v-btn",i,!1),a),[e(o.A,{attrs:{small:""}},[t._v("mdi-pencil")])],1)]}}],null,!0)},[e("span",[t._v("Редактировать")])]):t._e(),t.isAdmin||s.assignedTo&&s.assignedTo.id===t.currentUser.id?e(be.A,{attrs:{bottom:""},scopedSlots:t._u([{key:"activator",fn:function({on:a,attrs:i}){return[e(r.A,t._g(t._b({attrs:{icon:"",small:"",color:"orange"},on:{click:function(e){return t.changeStatus(s)}}},"v-btn",i,!1),a),[e(o.A,{attrs:{small:""}},[t._v("mdi-refresh")])],1)]}}],null,!0)},[e("span",[t._v("Изменить статус")])]):t._e()]}},{key:"no-data",fn:function(){return[e("div",{staticClass:"text-center pa-5"},[e(o.A,{attrs:{size:"64",color:"grey lighten-1"}},[t._v("mdi-clipboard-text-outline")]),e("div",{staticClass:"mt-3 grey--text"},[t._v("Заявки не найдены")])],1)]},proxy:!0}])})],1),t.createDialog?e("request-create-dialog",{attrs:{dialog:t.createDialog,"equipment-id":t.selectedEquipmentId},on:{close:t.closeCreateDialog,saved:t.onRequestSaved}}):t._e(),t.statusDialog?e("request-status-dialog",{attrs:{dialog:t.statusDialog,request:t.selectedRequest},on:{close:t.closeStatusDialog,updated:t.fetchRequests}}):t._e(),t.editDialog?e("request-edit-dialog",{attrs:{dialog:t.editDialog,request:t.selectedRequest},on:{close:t.closeEditDialog,updated:t.fetchRequests}}):t._e()],1)},us=[],ds=function(){var t=this,e=t._self._c;return e(_e.A,{attrs:{"max-width":"800px",persistent:""},model:{value:t.dialogVisible,callback:function(e){t.dialogVisible=e},expression:"dialogVisible"}},[e(xt.A,[e(Rt.ri,[e("span",{staticClass:"headline"},[t._v("Создание новой заявки")])]),e(Rt.OQ,[e(K.A,[e(kt.A,{ref:"form",attrs:{"lazy-validation":""},model:{value:t.valid,callback:function(e){t.valid=e},expression:"valid"}},[e(It.A,[e(wt.A,{attrs:{cols:"12"}},[e(mt.A,{attrs:{rules:t.titleRules,label:"Тема заявки*",required:""},model:{value:t.formData.title,callback:function(e){t.$set(t.formData,"title",e)},expression:"formData.title"}})],1),e(wt.A,{attrs:{cols:"12",sm:"6"}},[e(de.A,{attrs:{items:t.requestTypes,rules:t.typeRules,"item-text":"name","item-value":"id",label:"Тип заявки*",required:""},model:{value:t.formData.typeId,callback:function(e){t.$set(t.formData,"typeId",e)},expression:"formData.typeId"}})],1),e(wt.A,{attrs:{cols:"12",sm:"6"}},[e(de.A,{attrs:{items:t.requestPriorities,rules:t.priorityRules,"item-text":"name","item-value":"id",label:"Приоритет*",required:""},model:{value:t.formData.priorityId,callback:function(e){t.$set(t.formData,"priorityId",e)},expression:"formData.priorityId"}})],1),e(wt.A,{attrs:{cols:"12",sm:"6"}},[e(de.A,{attrs:{items:t.equipmentList,"item-text":"name","item-value":"id",label:"Оборудование",clearable:""},model:{value:t.formData.equipmentId,callback:function(e){t.$set(t.formData,"equipmentId",e)},expression:"formData.equipmentId"}})],1),e(wt.A,{attrs:{cols:"12",sm:"6"}},[e(mt.A,{attrs:{label:"Местоположение"},model:{value:t.formData.location,callback:function(e){t.$set(t.formData,"location",e)},expression:"formData.location"}})],1),t.isCartridgeRefillType?e(wt.A,{attrs:{cols:"12",sm:"6"}},[e(mt.A,{attrs:{label:"Модель картриджа*",rules:t.cartridgeModelRules},model:{value:t.formData.cartridgeModel,callback:function(e){t.$set(t.formData,"cartridgeModel",e)},expression:"formData.cartridgeModel"}})],1):t._e(),e(wt.A,{attrs:{cols:"12"}},[e(Oe.A,{attrs:{label:"Описание заявки",rows:"4"},model:{value:t.formData.description,callback:function(e){t.$set(t.formData,"description",e)},expression:"formData.description"}})],1)],1)],1)],1),e("small",[t._v("*обязательные поля")])],1),e(Rt.SL,[e(dt.A),e(r.A,{attrs:{color:"blue darken-1",text:""},on:{click:t.close}},[t._v("Отмена")]),e(r.A,{attrs:{color:"blue darken-1",text:"",disabled:!t.valid||t.loading,loading:t.loading},on:{click:t.save}},[t._v(" Создать ")])],1)],1)],1)},ms=[],ps={name:"RequestCreateDialog",props:{dialog:{type:Boolean,required:!0},equipmentId:{type:String,default:null}},data(){return{dialogVisible:this.dialog,valid:!0,loading:!1,cartridgeRefillTypeId:null,formData:{title:"",typeId:"",priorityId:"",equipmentId:this.equipmentId||null,cartridgeModel:"",location:"",description:""},titleRules:[t=>!!t||"Тема заявки обязательна",t=>t&&t.length>=5||"Тема должна содержать минимум 5 символов"],typeRules:[t=>!!t||"Тип заявки обязателен"],priorityRules:[t=>!!t||"Приоритет обязателен"],cartridgeModelRules:[t=>!this.isCartridgeRefillType||!!t||"Укажите модель картриджа"]}},computed:{...(0,u.L8)("requests",["allRequestTypes","allRequestPriorities"]),...(0,u.L8)("equipment",["allEquipment"]),requestTypes(){return this.allRequestTypes||[]},requestPriorities(){return this.allRequestPriorities||[]},equipmentList(){return this.allEquipment||[]},isCartridgeRefillType(){return!(!this.cartridgeRefillTypeId||!this.formData.typeId)&&this.formData.typeId===this.cartridgeRefillTypeId}},watch:{dialog(t){this.dialogVisible=t},dialogVisible(t){t||this.$emit("close")},equipmentId(t){this.formData.equipmentId=t}},created(){this.loadData()},methods:{async loadData(){try{0===this.requestTypes.length&&await this.$store.dispatch("requests/fetchRequestTypes"),0===this.requestPriorities.length&&await this.$store.dispatch("requests/fetchRequestPriorities"),0===this.equipmentList.length&&await this.$store.dispatch("equipment/fetchEquipment"),this.findCartridgeRefillTypeId()}catch(t){this.$store.commit("notification/SHOW_ERROR","Ошибка при загрузке данных")}},findCartridgeRefillTypeId(){const t=this.requestTypes.find((t=>t.name.toLowerCase().includes("заправка картридж")));t&&(this.cartridgeRefillTypeId=t.id)},close(){this.dialogVisible=!1,this.resetForm()},resetForm(){this.formData={title:"",typeId:"",priorityId:"",equipmentId:this.equipmentId||null,cartridgeModel:"",location:"",description:""},this.$refs.form&&this.$refs.form.resetValidation()},async save(){if(this.$refs.form.validate()){this.loading=!0;try{await this.$store.dispatch("requests/createRequest",this.formData),this.$store.commit("notification/SHOW_SUCCESS","Заявка успешно создана"),this.$emit("saved"),this.close()}catch(t){const e=t.message||"Ошибка при создании заявки";this.$store.commit("notification/SHOW_ERROR",e)}finally{this.loading=!1}}}}},hs=ps,fs=(0,p.A)(hs,ds,ms,!1,null,null,null),gs=fs.exports,ys=function(){var t=this,e=t._self._c;return e(_e.A,{attrs:{"max-width":"600px",persistent:""},model:{value:t.dialogVisible,callback:function(e){t.dialogVisible=e},expression:"dialogVisible"}},[e(xt.A,[e(Rt.ri,[e("span",{staticClass:"headline"},[t._v("Изменение статуса заявки")])]),e(Rt.OQ,[e(K.A,[e(kt.A,{ref:"form",attrs:{"lazy-validation":""},model:{value:t.valid,callback:function(e){t.valid=e},expression:"valid"}},[e(It.A,[e(wt.A,{attrs:{cols:"12"}},[e("div",{staticClass:"subtitle-2 mb-2"},[t._v("Текущий статус:")]),e(Vt.A,{staticClass:"mb-4",attrs:{color:t.getCurrentStatusColor(),"text-color":"white"}},[t._v(" "+t._s(t.getCurrentStatusName())+" ")])],1),e(wt.A,{attrs:{cols:"12"}},[e(de.A,{attrs:{items:t.availableStatuses,rules:t.statusRules,"item-text":"name","item-value":"id",label:"Новый статус*",required:""},scopedSlots:t._u([{key:"item",fn:function({item:s}){return[e(Vt.A,{staticClass:"mr-2",attrs:{small:"",color:s.color||"grey","text-color":"white"}}),t._v(" "+t._s(s.name)+" ")]}}]),model:{value:t.formData.statusId,callback:function(e){t.$set(t.formData,"statusId",e)},expression:"formData.statusId"}})],1),e(wt.A,{attrs:{cols:"12"}},[e(Oe.A,{attrs:{label:"Комментарий",rows:"3",placeholder:"Добавьте комментарий о причине изменения статуса..."},model:{value:t.formData.comment,callback:function(e){t.$set(t.formData,"comment",e)},expression:"formData.comment"}})],1)],1)],1)],1)],1),e(Rt.SL,[e(dt.A),e(r.A,{attrs:{color:"blue darken-1",text:""},on:{click:t.close}},[t._v("Отмена")]),e(r.A,{attrs:{color:"blue darken-1",text:"",disabled:!t.valid||t.loading,loading:t.loading},on:{click:t.saveStatus}},[t._v(" Сохранить ")])],1)],1)],1)},vs=[],As={name:"RequestStatusDialog",props:{dialog:{type:Boolean,required:!0},request:{type:Object,required:!0}},data(){return{dialogVisible:this.dialog,valid:!0,loading:!1,formData:{statusId:"",comment:""},statusRules:[t=>!!t||"Статус обязателен"],allowedTransitions:{}}},computed:{...(0,u.L8)("requests",["allRequestStatuses","requestStatusById"]),requestStatuses(){return this.allRequestStatuses||[]},availableStatuses(){if(!this.request||!this.request.statusId)return[];const t=this.request.statusId;return this.allowedTransitions[t]?this.requestStatuses.filter((e=>this.allowedTransitions[t].includes(e.id)&&e.id!==t)):this.requestStatuses.filter((e=>e.id!==t))}},watch:{dialog(t){this.dialogVisible=t},dialogVisible(t){t||this.$emit("close")},request:{handler(t){t&&t.statusId&&(this.formData.statusId="",this.formData.comment="")},immediate:!0}},created(){0===this.requestStatuses.length&&this.$store.dispatch("requests/fetchRequestStatuses"),this.initializeStatusTransitions()},methods:{initializeStatusTransitions(){this.$store.dispatch("requests/fetchRequestStatuses").then((()=>{const t=this.requestStatuses,e=e=>{const s=t.find((t=>t.name===e));return s?s.id:null},s=e("Новая"),a=e("В работе"),i=e("Ожидает"),r=e("Выполнена"),o=e("Отменена");s&&(this.allowedTransitions[s]=[a,o].filter(Boolean)),a&&(this.allowedTransitions[a]=[i,r,o].filter(Boolean)),i&&(this.allowedTransitions[i]=[a,r,o].filter(Boolean)),r&&(this.allowedTransitions[r]=[]),o&&(this.allowedTransitions[o]=[])}))},getCurrentStatusName(){return this.request&&this.request.status?this.request.status.name:"Не указан"},getCurrentStatusColor(){return this.request&&this.request.status?this.request.status.color||"blue":"grey"},close(){this.dialogVisible=!1,this.formData.statusId="",this.formData.comment="",this.$refs.form&&this.$refs.form.resetValidation()},async saveStatus(){if(this.$refs.form.validate()){this.loading=!0;try{await this.$store.dispatch("requests/changeRequestStatus",{id:this.request.id,statusId:this.formData.statusId,comment:this.formData.comment}),this.$store.commit("notification/SHOW_SUCCESS","Статус заявки успешно изменен"),this.$emit("updated"),this.close()}catch(t){const e=t.message||"Ошибка при изменении статуса";this.$store.commit("notification/SHOW_ERROR",e)}finally{this.loading=!1}}}}},_s=As,bs=(0,p.A)(_s,ys,vs,!1,null,null,null),Cs=bs.exports,Ss=function(){var t=this,e=t._self._c;return e(_e.A,{attrs:{"max-width":"600px",persistent:""},model:{value:t.dialogVisible,callback:function(e){t.dialogVisible=e},expression:"dialogVisible"}},[e(xt.A,[e(Rt.ri,[e("span",{staticClass:"headline"},[t._v("Редактирование заявки")])]),e(Rt.OQ,[e(K.A,[e(kt.A,{ref:"form",attrs:{"lazy-validation":""},model:{value:t.valid,callback:function(e){t.valid=e},expression:"valid"}},[e(It.A,[e(wt.A,{attrs:{cols:"12"}},[e(mt.A,{attrs:{rules:t.titleRules,label:"Тема заявки*",required:""},model:{value:t.formData.title,callback:function(e){t.$set(t.formData,"title",e)},expression:"formData.title"}})],1),e(wt.A,{attrs:{cols:"12",sm:"6"}},[e(de.A,{attrs:{items:t.requestTypes,rules:t.typeRules,"item-text":"name","item-value":"id",label:"Тип заявки*",required:""},model:{value:t.formData.typeId,callback:function(e){t.$set(t.formData,"typeId",e)},expression:"formData.typeId"}})],1),e(wt.A,{attrs:{cols:"12",sm:"6"}},[e(de.A,{attrs:{items:t.requestPriorities,rules:t.priorityRules,"item-text":"name","item-value":"id",label:"Приоритет*",required:""},model:{value:t.formData.priorityId,callback:function(e){t.$set(t.formData,"priorityId",e)},expression:"formData.priorityId"}})],1),e(wt.A,{attrs:{cols:"12",sm:"6"}},[e(de.A,{attrs:{items:t.equipmentList,"item-text":"name","item-value":"id",label:"Оборудование",clearable:""},model:{value:t.formData.equipmentId,callback:function(e){t.$set(t.formData,"equipmentId",e)},expression:"formData.equipmentId"}})],1),e(wt.A,{attrs:{cols:"12",sm:"6"}},[e(mt.A,{attrs:{label:"Местоположение"},model:{value:t.formData.location,callback:function(e){t.$set(t.formData,"location",e)},expression:"formData.location"}})],1),t.isCartridgeRefillType?e(wt.A,{attrs:{cols:"12",sm:"6"}},[e(mt.A,{attrs:{label:"Модель картриджа*",rules:t.cartridgeModelRules},model:{value:t.formData.cartridgeModel,callback:function(e){t.$set(t.formData,"cartridgeModel",e)},expression:"formData.cartridgeModel"}})],1):t._e(),e(wt.A,{attrs:{cols:"12"}},[e(Oe.A,{attrs:{label:"Описание заявки",rows:"4"},model:{value:t.formData.description,callback:function(e){t.$set(t.formData,"description",e)},expression:"formData.description"}})],1)],1)],1)],1),e("small",[t._v("*обязательные поля")])],1),e(Rt.SL,[e(dt.A),e(r.A,{attrs:{color:"blue darken-1",text:""},on:{click:t.close}},[t._v("Отмена")]),e(r.A,{attrs:{color:"blue darken-1",text:"",disabled:!t.valid||t.loading,loading:t.loading},on:{click:t.save}},[t._v(" Сохранить ")])],1)],1)],1)},qs=[],Ds={name:"RequestEditDialog",props:{request:{type:Object,required:!0}},data(){return{dialogVisible:!0,valid:!0,loading:!1,cartridgeRefillTypeId:null,formData:{title:"",typeId:"",priorityId:"",equipmentId:null,cartridgeModel:"",location:"",description:""},titleRules:[t=>!!t||"Тема заявки обязательна",t=>t&&t.length>=5||"Тема должна содержать минимум 5 символов"],typeRules:[t=>!!t||"Тип заявки обязателен"],priorityRules:[t=>!!t||"Приоритет обязателен"],cartridgeModelRules:[t=>!this.isCartridgeRefillType||!!t||"Укажите модель картриджа"]}},computed:{...(0,u.L8)("requests",["allRequestTypes","allRequestPriorities"]),...(0,u.L8)("equipment",["allEquipment"]),requestTypes(){return this.allRequestTypes||[]},requestPriorities(){return this.allRequestPriorities||[]},equipmentList(){return this.allEquipment||[]},isCartridgeRefillType(){return!(!this.cartridgeRefillTypeId||!this.formData.typeId)&&this.formData.typeId===this.cartridgeRefillTypeId}},created(){this.loadData(),this.initFormData()},methods:{async loadData(){try{0===this.requestTypes.length&&await this.$store.dispatch("requests/fetchRequestTypes"),0===this.requestPriorities.length&&await this.$store.dispatch("requests/fetchRequestPriorities"),0===this.equipmentList.length&&await this.$store.dispatch("equipment/fetchEquipment"),this.findCartridgeRefillTypeId()}catch(t){this.$store.commit("notification/SHOW_ERROR","Ошибка при загрузке данных")}},initFormData(){this.request&&(this.formData={title:this.request.title||"",typeId:this.request.typeId||"",priorityId:this.request.priorityId||"",equipmentId:this.request.equipmentId||null,cartridgeModel:this.request.cartridgeModel||"",location:this.request.location||"",description:this.request.description||""})},findCartridgeRefillTypeId(){const t=this.requestTypes.find((t=>t.name.toLowerCase().includes("заправк")||t.name.toLowerCase().includes("картридж")));t&&(this.cartridgeRefillTypeId=t.id)},close(){this.dialogVisible=!1,this.$emit("close")},async save(){if(this.$refs.form.validate()){this.loading=!0;try{await this.$store.dispatch("requests/updateRequest",{id:this.request.id,requestData:this.formData}),this.$store.commit("notification/SHOW_SUCCESS","Заявка успешно обновлена"),this.$emit("updated"),this.close()}catch(t){const e=t.message||"Ошибка при обновлении заявки";this.$store.commit("notification/SHOW_ERROR",e)}finally{this.loading=!1}}}}},Es=Ds,xs=(0,p.A)(Es,Ss,qs,!1,null,null,null),Rs=xs.exports,Ts=s(5093),ws=s.n(Ts);const ks=(t,e="-")=>t?ws()(t).format("DD.MM.YYYY"):e;var Is={name:"RequestListView",components:{RequestCreateDialog:gs,RequestStatusDialog:Cs,RequestEditDialog:Rs},data(){return{loading:!1,requests:[],totalRequests:0,options:{page:1,itemsPerPage:10,sortBy:["createdAt"],sortDesc:[!0]},headers:[{text:"Номер",value:"number",sortable:!0,width:"100px"},{text:"Тема",value:"title",sortable:!0},{text:"Тип",value:"type.name",sortable:!1,width:"120px"},{text:"Статус",value:"status.name",sortable:!1,width:"120px"},{text:"Приоритет",value:"priority.name",sortable:!1,width:"120px"},{text:"Создана",value:"createdAt",sortable:!0,width:"130px"},{text:"Исполнитель",value:"assignedTo.name",sortable:!1,width:"150px"},{text:"Действия",value:"actions",sortable:!1,align:"center",width:"120px"}],filters:{search:"",statusId:null,typeId:null,priorityId:null,assignedToId:null,dateFrom:null,dateTo:null,myRequests:!1},fromDateMenu:!1,toDateMenu:!1,createDialog:!1,statusDialog:!1,editDialog:!1,selectedRequest:null,selectedEquipmentId:null}},computed:{...(0,u.L8)("auth",["currentUser","isAdmin","isTechnician"]),...(0,u.L8)("requests",["allRequestTypes","allRequestStatuses","allRequestPriorities"]),...(0,u.L8)("users",["allTechnicians"]),requestTypes(){return this.allRequestTypes||[]},requestStatuses(){return this.allRequestStatuses||[]},requestPriorities(){return this.allRequestPriorities||[]},technicians(){return this.allTechnicians||[]}},created(){this.debouncedSearch=De()(this.applyFilters,300),this.loadReferenceData(),this.fetchRequests();const t=this.$route.query.equipmentId;t&&(this.selectedEquipmentId=t,this.openCreateDialog())},methods:{async loadReferenceData(){try{0===this.requestStatuses.length&&await this.$store.dispatch("requests/fetchRequestStatuses"),0===this.requestTypes.length&&await this.$store.dispatch("requests/fetchRequestTypes"),0===this.requestPriorities.length&&await this.$store.dispatch("requests/fetchRequestPriorities"),0===this.technicians.length&&await this.$store.dispatch("users/fetchTechnicians")}catch(t){this.$store.commit("notification/SHOW_ERROR","Ошибка при загрузке справочных данных")}},async fetchRequests(){this.loading=!0;try{const t={page:this.options.page,limit:this.options.itemsPerPage,sortBy:this.options.sortBy[0],order:this.options.sortDesc[0]?"DESC":"ASC",search:this.filters.search,statusId:this.filters.statusId,typeId:this.filters.typeId,priorityId:this.filters.priorityId,assignedToId:this.filters.assignedToId,dateFrom:this.filters.dateFrom,dateTo:this.filters.dateTo};this.filters.myRequests&&this.currentUser&&(this.isTechnician?t.assignedToId=this.currentUser.id:t.createdById=this.currentUser.id);const e=await this.$store.dispatch("requests/fetchRequests",t);this.requests=e.data,this.totalRequests=e.total}catch(t){this.$store.commit("notification/SHOW_ERROR","Ошибка при загрузке заявок")}finally{this.loading=!1}},applyFilters(){this.options.page=1,this.fetchRequests()},resetFilters(){this.filters={search:"",statusId:null,typeId:null,priorityId:null,assignedToId:null,dateFrom:null,dateTo:null,myRequests:!1},this.applyFilters()},openCreateDialog(){this.createDialog=!0},closeCreateDialog(){this.createDialog=!1,this.selectedEquipmentId=null,this.$route.query.equipmentId&&this.$router.replace({query:{...this.$route.query,equipmentId:void 0}})},onRequestSaved(){this.fetchRequests(),this.closeCreateDialog()},editRequest(t){this.selectedRequest=t,this.editDialog=!0},closeEditDialog(){this.editDialog=!1,this.selectedRequest=null},changeStatus(t){this.selectedRequest=t,this.statusDialog=!0},closeStatusDialog(){this.statusDialog=!1,this.selectedRequest=null},canEditRequest(t){if(!t||!this.currentUser)return!1;if(this.isAdmin)return!0;if(this.isTechnician&&t.assignedToId===this.currentUser.id)return!0;if(t.createdById===this.currentUser.id){const e=this.requestStatuses.find((t=>"Новая"===t.name));return t.statusId===e?.id}return!1},formatDate(t){return ks(t)},getStatusColor(t){if(!t)return"grey";const e={"Новая":"info","В работе":"primary","Ожидает":"warning","Выполнена":"success","Отменена":"error"};return e[t.name]||t.color||"grey"},getPriorityColor(t){if(!t)return"grey";const e={"Низкий":"success","Средний":"info","Высокий":"warning","Критический":"error"};return e[t.name]||t.color||"grey"},getRequestTypeColor(t){if(!t)return"grey";const e={"Ремонт":"red","Заправка картриджа":"blue","Утилизация":"deep-purple","Перемещение":"teal"};return e[t.name]||t.color||"grey"}}},Os=Is,Ls=(0,p.A)(Os,cs,us,!1,null,"0a3270be",null),Us=Ls.exports,$s=function(){var t=this,e=t._self._c;return e("div",[e(xt.A,{staticClass:"mb-4",attrs:{flat:""}},[e(Rt.ri,{staticClass:"d-flex align-center py-2"},[e("h1",{staticClass:"text-h5"},[t._v("Отчеты и аналитика")])])],1),e(It.A,[e(wt.A,{attrs:{cols:"12",md:"3"}},[e(xt.A,{staticClass:"mb-4",attrs:{outlined:""}},[e(Rt.ri,{staticClass:"py-2 grey lighten-4"},[e(o.A,{attrs:{left:"",color:"primary"}},[t._v("mdi-file-chart")]),t._v(" Параметры отчета ")],1),e(Rt.OQ,{staticClass:"pa-4"},[e(de.A,{attrs:{items:t.reportTypes,label:"Тип отчета"},on:{change:t.resetParams},model:{value:t.selectedReportType,callback:function(e){t.selectedReportType=e},expression:"selectedReportType"}}),e(tt.A,{staticClass:"my-4"}),"equipment"===t.selectedReportType?e("div",[e(de.A,{attrs:{items:t.categories,"item-text":"name","item-value":"id",label:"Категории",multiple:"",chips:"","small-chips":""},model:{value:t.equipmentParams.categoryIds,callback:function(e){t.$set(t.equipmentParams,"categoryIds",e)},expression:"equipmentParams.categoryIds"}}),e(de.A,{attrs:{items:t.statuses,"item-text":"name","item-value":"id",label:"Статусы",multiple:"",chips:"","small-chips":""},model:{value:t.equipmentParams.statusIds,callback:function(e){t.$set(t.equipmentParams,"statusIds",e)},expression:"equipmentParams.statusIds"}}),e(ct.A,{ref:"fromDateMenu",attrs:{"close-on-content-click":!1,"return-value":t.equipmentParams.dateFrom,transition:"scale-transition","offset-y":"","min-width":"auto"},on:{"update:returnValue":function(e){return t.$set(t.equipmentParams,"dateFrom",e)},"update:return-value":function(e){return t.$set(t.equipmentParams,"dateFrom",e)}},scopedSlots:t._u([{key:"activator",fn:function({on:s,attrs:a}){return[e(mt.A,t._g(t._b({attrs:{label:"Дата поступления от","prepend-icon":"mdi-calendar",readonly:""},model:{value:t.equipmentParams.dateFrom,callback:function(e){t.$set(t.equipmentParams,"dateFrom",e)},expression:"equipmentParams.dateFrom"}},"v-text-field",a,!1),s))]}}],null,!1,4032816136),model:{value:t.fromDateMenu,callback:function(e){t.fromDateMenu=e},expression:"fromDateMenu"}},[e(Ie.A,{attrs:{"no-title":"",scrollable:""},on:{input:function(e){t.fromDateMenu=!1}},model:{value:t.equipmentParams.dateFrom,callback:function(e){t.$set(t.equipmentParams,"dateFrom",e)},expression:"equipmentParams.dateFrom"}})],1),e(ct.A,{ref:"toDateMenu",attrs:{"close-on-content-click":!1,"return-value":t.equipmentParams.dateTo,transition:"scale-transition","offset-y":"","min-width":"auto"},on:{"update:returnValue":function(e){return t.$set(t.equipmentParams,"dateTo",e)},"update:return-value":function(e){return t.$set(t.equipmentParams,"dateTo",e)}},scopedSlots:t._u([{key:"activator",fn:function({on:s,attrs:a}){return[e(mt.A,t._g(t._b({attrs:{label:"Дата поступления до","prepend-icon":"mdi-calendar",readonly:""},model:{value:t.equipmentParams.dateTo,callback:function(e){t.$set(t.equipmentParams,"dateTo",e)},expression:"equipmentParams.dateTo"}},"v-text-field",a,!1),s))]}}],null,!1,1134403315),model:{value:t.toDateMenu,callback:function(e){t.toDateMenu=e},expression:"toDateMenu"}},[e(Ie.A,{attrs:{"no-title":"",scrollable:""},on:{input:function(e){t.toDateMenu=!1}},model:{value:t.equipmentParams.dateTo,callback:function(e){t.$set(t.equipmentParams,"dateTo",e)},expression:"equipmentParams.dateTo"}})],1)],1):t._e(),"requests"===t.selectedReportType?e("div",[e(de.A,{attrs:{items:t.requestStatuses,"item-text":"name","item-value":"id",label:"Статусы заявок",multiple:"",chips:"","small-chips":""},model:{value:t.requestParams.statusIds,callback:function(e){t.$set(t.requestParams,"statusIds",e)},expression:"requestParams.statusIds"}}),e(de.A,{attrs:{items:t.requestTypes,"item-text":"name","item-value":"id",label:"Типы заявок",multiple:"",chips:"","small-chips":""},model:{value:t.requestParams.typeIds,callback:function(e){t.$set(t.requestParams,"typeIds",e)},expression:"requestParams.typeIds"}}),e(de.A,{attrs:{items:t.technicians,"item-text":"name","item-value":"id",label:"Исполнители",multiple:"",chips:"","small-chips":""},model:{value:t.requestParams.assignedToIds,callback:function(e){t.$set(t.requestParams,"assignedToIds",e)},expression:"requestParams.assignedToIds"}}),e(ct.A,{ref:"requestFromDateMenu",attrs:{"close-on-content-click":!1,"return-value":t.requestParams.dateFrom,transition:"scale-transition","offset-y":"","min-width":"auto"},on:{"update:returnValue":function(e){return t.$set(t.requestParams,"dateFrom",e)},"update:return-value":function(e){return t.$set(t.requestParams,"dateFrom",e)}},scopedSlots:t._u([{key:"activator",fn:function({on:s,attrs:a}){return[e(mt.A,t._g(t._b({attrs:{label:"Дата создания от","prepend-icon":"mdi-calendar",readonly:""},model:{value:t.requestParams.dateFrom,callback:function(e){t.$set(t.requestParams,"dateFrom",e)},expression:"requestParams.dateFrom"}},"v-text-field",a,!1),s))]}}],null,!1,1957929519),model:{value:t.requestFromDateMenu,callback:function(e){t.requestFromDateMenu=e},expression:"requestFromDateMenu"}},[e(Ie.A,{attrs:{"no-title":"",scrollable:""},on:{input:function(e){t.requestFromDateMenu=!1}},model:{value:t.requestParams.dateFrom,callback:function(e){t.$set(t.requestParams,"dateFrom",e)},expression:"requestParams.dateFrom"}})],1),e(ct.A,{ref:"requestToDateMenu",attrs:{"close-on-content-click":!1,"return-value":t.requestParams.dateTo,transition:"scale-transition","offset-y":"","min-width":"auto"},on:{"update:returnValue":function(e){return t.$set(t.requestParams,"dateTo",e)},"update:return-value":function(e){return t.$set(t.requestParams,"dateTo",e)}},scopedSlots:t._u([{key:"activator",fn:function({on:s,attrs:a}){return[e(mt.A,t._g(t._b({attrs:{label:"Дата создания до","prepend-icon":"mdi-calendar",readonly:""},model:{value:t.requestParams.dateTo,callback:function(e){t.$set(t.requestParams,"dateTo",e)},expression:"requestParams.dateTo"}},"v-text-field",a,!1),s))]}}],null,!1,2237919028),model:{value:t.requestToDateMenu,callback:function(e){t.requestToDateMenu=e},expression:"requestToDateMenu"}},[e(Ie.A,{attrs:{"no-title":"",scrollable:""},on:{input:function(e){t.requestToDateMenu=!1}},model:{value:t.requestParams.dateTo,callback:function(e){t.$set(t.requestParams,"dateTo",e)},expression:"requestParams.dateTo"}})],1)],1):t._e(),e(tt.A,{staticClass:"my-4"}),e(r.A,{attrs:{color:"primary",block:"",loading:t.loading,disabled:t.loading},on:{click:t.generateReport}},[t._v(" Сформировать отчет ")]),e(r.A,{staticClass:"mt-2",attrs:{color:"success",block:"",disabled:!t.reportData||t.loading},on:{click:t.exportReport}},[e(o.A,{attrs:{left:""}},[t._v("mdi-file-excel")]),t._v(" Экспорт в Excel ")],1),e(r.A,{staticClass:"mt-2",attrs:{color:"info",block:"",disabled:!t.reportData||t.loading},on:{click:t.printReport}},[e(o.A,{attrs:{left:""}},[t._v("mdi-printer")]),t._v(" Печать ")],1)],1)],1)],1),e(wt.A,{attrs:{cols:"12",md:"9"}},[t.loading?e("div",{staticClass:"text-center pa-5"},[e(Ht.A,{attrs:{indeterminate:"",color:"primary"}}),e("div",{staticClass:"mt-3"},[t._v("Формирование отчета...")])],1):t.reportData?["equipment"===t.selectedReportType?[e(xt.A,{staticClass:"mb-4",attrs:{outlined:"",id:"report-content"}},[e(Rt.ri,{staticClass:"py-2 grey lighten-4"},[e(o.A,{attrs:{left:"",color:"primary"}},[t._v("mdi-desktop-classic")]),t._v(" Отчет по оборудованию "),e(dt.A),e("div",{staticClass:"text-subtitle-2"},[t._v(t._s(t.formatReportDate()))])],1),e(Rt.OQ,{staticClass:"px-4 pt-4 pb-0"},[e("h3",{staticClass:"mb-3"},[t._v("Количество оборудования по категориям")]),e(me.A,{scopedSlots:t._u([{key:"default",fn:function(){return[e("thead",[e("tr",[e("th",{staticClass:"text-left"},[t._v("Категория")]),e("th",{staticClass:"text-right"},[t._v("Количество")]),e("th",{staticClass:"text-right"},[t._v("% от общего")])])]),e("tbody",[t._l(t.reportData.byCategory,(function(s,a){return e("tr",{key:a},[e("td",[t._v(t._s(s.category))]),e("td",{staticClass:"text-right"},[t._v(t._s(s.count))]),e("td",{staticClass:"text-right"},[t._v(t._s(t.calculatePercentage(s.count,t.reportData.total))+"%")])])})),e("tr",{staticClass:"font-weight-bold"},[e("td",[t._v("Итого")]),e("td",{staticClass:"text-right"},[t._v(t._s(t.reportData.total))]),e("td",{staticClass:"text-right"},[t._v("100%")])])],2)]},proxy:!0}],null,!1,3983433681)})],1),e(Rt.OQ,{staticClass:"px-4 pt-4 pb-0"},[e("h3",{staticClass:"mb-3"},[t._v("Количество оборудования по статусам")]),e(me.A,{scopedSlots:t._u([{key:"default",fn:function(){return[e("thead",[e("tr",[e("th",{staticClass:"text-left"},[t._v("Статус")]),e("th",{staticClass:"text-right"},[t._v("Количество")]),e("th",{staticClass:"text-right"},[t._v("% от общего")])])]),e("tbody",[t._l(t.reportData.byStatus,(function(s,a){return e("tr",{key:a},[e("td",[t._v(t._s(s.status))]),e("td",{staticClass:"text-right"},[t._v(t._s(s.count))]),e("td",{staticClass:"text-right"},[t._v(t._s(t.calculatePercentage(s.count,t.reportData.total))+"%")])])})),e("tr",{staticClass:"font-weight-bold"},[e("td",[t._v("Итого")]),e("td",{staticClass:"text-right"},[t._v(t._s(t.reportData.total))]),e("td",{staticClass:"text-right"},[t._v("100%")])])],2)]},proxy:!0}],null,!1,3763084101)})],1),e(Rt.OQ,{staticClass:"px-4 pt-4 pb-0"},[e("h3",{staticClass:"mb-3"},[t._v("Количество оборудования по возрасту")]),e(me.A,{scopedSlots:t._u([{key:"default",fn:function(){return[e("thead",[e("tr",[e("th",{staticClass:"text-left"},[t._v("Возраст")]),e("th",{staticClass:"text-right"},[t._v("Количество")]),e("th",{staticClass:"text-right"},[t._v("% от общего")])])]),e("tbody",[t._l(t.reportData.byAge,(function(s,a){return e("tr",{key:a},[e("td",[t._v(t._s(s.ageGroup))]),e("td",{staticClass:"text-right"},[t._v(t._s(s.count))]),e("td",{staticClass:"text-right"},[t._v(t._s(t.calculatePercentage(s.count,t.reportData.total))+"%")])])})),e("tr",{staticClass:"font-weight-bold"},[e("td",[t._v("Итого")]),e("td",{staticClass:"text-right"},[t._v(t._s(t.reportData.total))]),e("td",{staticClass:"text-right"},[t._v("100%")])])],2)]},proxy:!0}],null,!1,388855361)})],1)],1),e(It.A,[e(wt.A,{attrs:{cols:"12",md:"6"}},[e(xt.A,{attrs:{outlined:""}},[e(Rt.ri,{staticClass:"py-2 grey lighten-4"},[e(o.A,{attrs:{left:"",color:"primary"}},[t._v("mdi-chart-pie")]),t._v(" Распределение по категориям ")],1),e(Rt.OQ,{staticClass:"pa-4"},[e("canvas",{ref:"categoryChart"})])],1)],1),e(wt.A,{attrs:{cols:"12",md:"6"}},[e(xt.A,{attrs:{outlined:""}},[e(Rt.ri,{staticClass:"py-2 grey lighten-4"},[e(o.A,{attrs:{left:"",color:"primary"}},[t._v("mdi-chart-donut")]),t._v(" Распределение по статусам ")],1),e(Rt.OQ,{staticClass:"pa-4"},[e("canvas",{ref:"statusChart"})])],1)],1)],1)]:t._e(),"requests"===t.selectedReportType?[e(xt.A,{staticClass:"mb-4",attrs:{outlined:"",id:"report-content"}},[e(Rt.ri,{staticClass:"py-2 grey lighten-4"},[e(o.A,{attrs:{left:"",color:"primary"}},[t._v("mdi-clipboard-text")]),t._v(" Отчет по заявкам "),e(dt.A),e("div",{staticClass:"text-subtitle-2"},[t._v(t._s(t.formatReportDate()))])],1),e(Rt.OQ,{staticClass:"px-4 pt-4 pb-0"},[e("h3",{staticClass:"mb-3"},[t._v("Количество заявок по статусам")]),e(me.A,{scopedSlots:t._u([{key:"default",fn:function(){return[e("thead",[e("tr",[e("th",{staticClass:"text-left"},[t._v("Статус")]),e("th",{staticClass:"text-right"},[t._v("Количество")]),e("th",{staticClass:"text-right"},[t._v("% от общего")])])]),e("tbody",[t._l(t.reportData.byStatus,(function(s,a){return e("tr",{key:a},[e("td",[t._v(t._s(s.status))]),e("td",{staticClass:"text-right"},[t._v(t._s(s.count))]),e("td",{staticClass:"text-right"},[t._v(t._s(t.calculatePercentage(s.count,t.reportData.total))+"%")])])})),e("tr",{staticClass:"font-weight-bold"},[e("td",[t._v("Итого")]),e("td",{staticClass:"text-right"},[t._v(t._s(t.reportData.total))]),e("td",{staticClass:"text-right"},[t._v("100%")])])],2)]},proxy:!0}],null,!1,3763084101)})],1),e(Rt.OQ,{staticClass:"px-4 pt-4 pb-0"},[e("h3",{staticClass:"mb-3"},[t._v("Количество заявок по типам")]),e(me.A,{scopedSlots:t._u([{key:"default",fn:function(){return[e("thead",[e("tr",[e("th",{staticClass:"text-left"},[t._v("Тип")]),e("th",{staticClass:"text-right"},[t._v("Количество")]),e("th",{staticClass:"text-right"},[t._v("% от общего")])])]),e("tbody",[t._l(t.reportData.byType,(function(s,a){return e("tr",{key:a},[e("td",[t._v(t._s(s.type))]),e("td",{staticClass:"text-right"},[t._v(t._s(s.count))]),e("td",{staticClass:"text-right"},[t._v(t._s(t.calculatePercentage(s.count,t.reportData.total))+"%")])])})),e("tr",{staticClass:"font-weight-bold"},[e("td",[t._v("Итого")]),e("td",{staticClass:"text-right"},[t._v(t._s(t.reportData.total))]),e("td",{staticClass:"text-right"},[t._v("100%")])])],2)]},proxy:!0}],null,!1,3667124467)})],1),e(Rt.OQ,{staticClass:"px-4 pt-4 pb-0"},[e("h3",{staticClass:"mb-3"},[t._v("Заявки по техникам")]),e(me.A,{scopedSlots:t._u([{key:"default",fn:function(){return[e("thead",[e("tr",[e("th",{staticClass:"text-left"},[t._v("Техник")]),e("th",{staticClass:"text-right"},[t._v("Выполнено")]),e("th",{staticClass:"text-right"},[t._v("В работе")]),e("th",{staticClass:"text-right"},[t._v("Всего")])])]),e("tbody",t._l(t.reportData.byTechnician,(function(s,a){return e("tr",{key:a},[e("td",[t._v(t._s(s.technician))]),e("td",{staticClass:"text-right"},[t._v(t._s(s.completed))]),e("td",{staticClass:"text-right"},[t._v(t._s(s.inProgress))]),e("td",{staticClass:"text-right"},[t._v(t._s(s.total))])])})),0)]},proxy:!0}],null,!1,3708885913)})],1),e(Rt.OQ,{staticClass:"px-4 pt-4 pb-4"},[e("h3",{staticClass:"mb-3"},[t._v("Среднее время выполнения заявок (в часах)")]),e(me.A,{scopedSlots:t._u([{key:"default",fn:function(){return[e("thead",[e("tr",[e("th",{staticClass:"text-left"},[t._v("Тип заявки")]),e("th",{staticClass:"text-right"},[t._v("Среднее время")])])]),e("tbody",[t._l(t.reportData.resolutionTime,(function(s,a){return e("tr",{key:a},[e("td",[t._v(t._s(s.type))]),e("td",{staticClass:"text-right"},[t._v(t._s(t.formatHours(s.hours)))])])})),e("tr",{staticClass:"font-weight-bold"},[e("td",[t._v("Среднее по всем типам")]),e("td",{staticClass:"text-right"},[t._v(t._s(t.formatHours(t.reportData.averageResolutionTime)))])])],2)]},proxy:!0}],null,!1,2846928734)})],1)],1),e(It.A,[e(wt.A,{attrs:{cols:"12",md:"6"}},[e(xt.A,{attrs:{outlined:""}},[e(Rt.ri,{staticClass:"py-2 grey lighten-4"},[e(o.A,{attrs:{left:"",color:"primary"}},[t._v("mdi-chart-pie")]),t._v(" Распределение по типам ")],1),e(Rt.OQ,{staticClass:"pa-4"},[e("canvas",{ref:"requestTypeChart"})])],1)],1),e(wt.A,{attrs:{cols:"12",md:"6"}},[e(xt.A,{attrs:{outlined:""}},[e(Rt.ri,{staticClass:"py-2 grey lighten-4"},[e(o.A,{attrs:{left:"",color:"primary"}},[t._v("mdi-chart-timeline")]),t._v(" Динамика создания заявок ")],1),e(Rt.OQ,{staticClass:"pa-4"},[e("canvas",{ref:"requestTrendChart"})])],1)],1)],1)]:t._e()]:e("div",{staticClass:"text-center pa-5"},[e(o.A,{attrs:{size:"64",color:"grey lighten-1"}},[t._v("mdi-file-chart-outline")]),e("div",{staticClass:"mt-3 grey--text"},[t._v('Выберите тип отчета и параметры, затем нажмите "Сформировать отчет"')])],1)],2)],1)],1)},Ps=[],Ns=(s(7588),s(4603),s(7566),s(8721),{name:"ReportsView",data(){return{loading:!1,selectedReportType:"equipment",reportTypes:[{text:"Отчет по оборудованию",value:"equipment"},{text:"Отчет по заявкам",value:"requests"}],equipmentParams:{categoryIds:[],statusIds:[],dateFrom:null,dateTo:null},requestParams:{statusIds:[],typeIds:[],assignedToIds:[],dateFrom:null,dateTo:null},fromDateMenu:!1,toDateMenu:!1,requestFromDateMenu:!1,requestToDateMenu:!1,reportData:null,charts:{categoryChart:null,statusChart:null,requestTypeChart:null,requestTrendChart:null}}},computed:{...(0,u.L8)("equipment",["allCategories","allStatuses"]),...(0,u.L8)("requests",["allRequestStatuses","allRequestTypes"]),...(0,u.L8)("users",["allTechnicians"]),categories(){return this.allCategories||[]},statuses(){return this.allStatuses||[]},requestStatuses(){return this.allRequestStatuses||[]},requestTypes(){return this.allRequestTypes||[]},technicians(){return this.allTechnicians||[]}},created(){this.loadReferenceData()},methods:{async loadReferenceData(){try{0===this.categories.length&&await this.$store.dispatch("equipment/fetchCategories"),0===this.statuses.length&&await this.$store.dispatch("equipment/fetchStatuses"),0===this.requestStatuses.length&&await this.$store.dispatch("requests/fetchRequestStatuses"),0===this.requestTypes.length&&await this.$store.dispatch("requests/fetchRequestTypes"),0===this.technicians.length&&await this.$store.dispatch("users/fetchTechnicians")}catch(t){this.$store.commit("notification/SHOW_ERROR","Ошибка при загрузке справочных данных")}},resetParams(){"equipment"===this.selectedReportType?this.equipmentParams={categoryIds:[],statusIds:[],dateFrom:null,dateTo:null}:this.requestParams={statusIds:[],typeIds:[],assignedToIds:[],dateFrom:null,dateTo:null},this.reportData=null,this.destroyCharts()},async generateReport(){this.loading=!0,this.reportData=null,this.destroyCharts();try{let t;t="equipment"===this.selectedReportType?await this.$store.dispatch("reports/getEquipmentReport",this.equipmentParams):await this.$store.dispatch("reports/getRequestReport",this.requestParams),this.reportData=t,this.$nextTick((()=>{this.renderCharts()}))}catch(t){this.$store.commit("notification/SHOW_ERROR","Ошибка при формировании отчета")}finally{this.loading=!1}},renderCharts(){this.reportData&&this.$nextTick((()=>{"equipment"===this.selectedReportType?this.renderEquipmentCharts():this.renderRequestCharts()}))},renderEquipmentCharts(){const t=this.$refs.categoryChart?.getContext("2d");if(t&&this.reportData.byCategory){const e=this.reportData.byCategory.map((t=>t.category)),s=this.reportData.byCategory.map((t=>t.count)),a=this.generateColors(s.length);this.charts.categoryChart=new Kt.Ay(t,{type:"pie",data:{labels:e,datasets:[{data:s,backgroundColor:a}]},options:{responsive:!0,plugins:{legend:{position:"right"},title:{display:!1}}}})}const e=this.$refs.statusChart?.getContext("2d");if(e&&this.reportData.byStatus){const t=this.reportData.byStatus.map((t=>t.status)),s=this.reportData.byStatus.map((t=>t.count)),a=this.getStatusColors(t);this.charts.statusChart=new Kt.Ay(e,{type:"doughnut",data:{labels:t,datasets:[{data:s,backgroundColor:a}]},options:{responsive:!0,plugins:{legend:{position:"right"},title:{display:!1}}}})}},renderRequestCharts(){const t=this.$refs.requestTypeChart?.getContext("2d");if(t&&this.reportData.byType){const e=this.reportData.byType.map((t=>t.type)),s=this.reportData.byType.map((t=>t.count)),a=this.generateColors(s.length);this.charts.requestTypeChart=new Kt.Ay(t,{type:"pie",data:{labels:e,datasets:[{data:s,backgroundColor:a}]},options:{responsive:!0,plugins:{legend:{position:"right"},title:{display:!1}}}})}const e=this.$refs.requestTrendChart?.getContext("2d");if(e&&this.reportData.trend){const t=this.reportData.trend.map((t=>t.month)),s=this.reportData.trend.map((t=>t.count));this.charts.requestTrendChart=new Kt.Ay(e,{type:"line",data:{labels:t,datasets:[{label:"Количество заявок",data:s,backgroundColor:"rgba(54, 162, 235, 0.2)",borderColor:"rgba(54, 162, 235, 1)",borderWidth:2,tension:.3,fill:!0}]},options:{responsive:!0,scales:{y:{beginAtZero:!0,ticks:{precision:0}}},plugins:{legend:{display:!1},title:{display:!1}}}})}},destroyCharts(){Object.keys(this.charts).forEach((t=>{this.charts[t]&&(this.charts[t].destroy(),this.charts[t]=null)}))},exportReport(){if(this.reportData)try{let t={};t="equipment"===this.selectedReportType?this.equipmentParams:this.requestParams,this.$store.dispatch("reports/exportReport",{type:this.selectedReportType,params:t}).then((t=>{const e=window.URL.createObjectURL(new Blob([t.data])),s=document.createElement("a");s.href=e,s.setAttribute("download",`${this.selectedReportType}_report_${(new Date).toISOString().split("T")[0]}.xlsx`),document.body.appendChild(s),s.click(),document.body.removeChild(s)})).catch((t=>{console.error("Export error:",t),this.$store.commit("notification/SHOW_ERROR",`Ошибка при экспорте отчета: ${t.message||"Неизвестная ошибка"}`)}))}catch(t){console.error("Export error:",t),this.$store.commit("notification/SHOW_ERROR",`Ошибка при экспорте отчета: ${t.message||"Неизвестная ошибка"}`)}},printReport(){window.print()},formatReportDate(){return(new Date).toLocaleDateString("ru-RU",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"})},calculatePercentage(t,e){return e?Math.round(t/e*100):0},formatHours(t){return"number"!==typeof t?"0 ч":t<1?`${Math.round(60*t)} мин`:Math.round(10*t)/10+" ч"},generateColors(t){const e=["#4CAF50","#2196F3","#FFC107","#FF5722","#9C27B0","#3F51B5","#009688","#795548","#607D8B","#E91E63"];if(t<=e.length)return e.slice(0,t);const s=[...e];for(let a=e.length;a<t;a++){const t=Math.floor(200*Math.random())+20,e=Math.floor(200*Math.random())+20,a=Math.floor(200*Math.random())+20;s.push(`rgb(${t}, ${e}, ${a})`)}return s},getStatusColors(t){const e={"Новый":"#2196F3","Рабочий":"#4CAF50","Дефектный":"#FFC107","Нерабочий":"#F44336","Новая":"#2196F3","В работе":"#FF9800","Ожидает":"#FFC107","Выполнена":"#4CAF50","Отменена":"#F44336"};return t.map((t=>e[t]||"#607D8B"))}}}),Fs=Ns,js=(0,p.A)(Fs,$s,Ps,!1,null,null,null),Ms=js.exports;a.Ay.use(g.Ay);const Gs=[{path:"/login",component:Dt,children:[{path:"",name:"Login",component:Nt,meta:{requiresAuth:!1}}]},{path:"/",component:At,meta:{requiresAuth:!0},children:[{path:"",name:"Dashboard",component:ae},{path:"profile",name:"Profile",component:ce},{path:"settings",name:"Settings",component:Ae,meta:{requiresAdmin:!0}},{path:"users",name:"Users",component:Te,meta:{requiresAdmin:!0}},{path:"equipment",name:"EquipmentList",component:Qe},{path:"equipment/:id",name:"EquipmentDetails",component:Ze,props:!0},{path:"equipment/categories",name:"CategoryList",component:es,meta:{requiresAdmin:!0}},{path:"equipment/statuses",name:"StatusList",component:ls,meta:{requiresAdmin:!0}},{path:"requests",name:"RequestList",component:Us},{path:"reports",name:"Reports",component:Ms}]},{path:"*",component:Dt,children:[{path:"",name:"NotFound",component:Wt}]}],Qs=new g.Ay({mode:"history",base:"/",routes:Gs});Qs.beforeEach((async(t,e,s)=>{const a=t.matched.some((t=>t.meta.requiresAuth)),i=t.matched.some((t=>t.meta.requiresAdmin));if(a){const e=B.getters["auth/isAuthenticated"];if(!e)return s({path:"/login",query:{redirect:t.fullPath}});if(i&&!B.getters["auth/isAdmin"])return s({path:"/"})}if("/login"===t.path&&B.getters["auth/isAuthenticated"])return s({path:"/"});s()}));var Ws=Qs,Vs=s(9828),zs=s(5399);a.Ay.use(Vs.A);var Hs=new Vs.A({theme:{options:{customProperties:!0},themes:{light:{primary:"#1976D2",secondary:"#424242",accent:"#82B1FF",error:"#FF5252",info:"#2196F3",success:"#4CAF50",warning:"#FFC107"}}},icons:{iconfont:"mdi"},lang:{locales:{ru:zs.A},current:"ru"}});s(2271);ws().locale("ru"),a.Ay.config.productionTip=!0,y.A.defaults.baseURL="http://localhost:3000/api",a.Ay.prototype.$axios=y.A,a.Ay.filter("formatDate",(function(t){return t?ws()(t).format("DD.MM.YYYY"):""})),a.Ay.filter("formatDateTime",(function(t){return t?ws()(t).format("DD.MM.YYYY HH:mm"):""})),a.Ay.mixin({methods:{canManageEquipment(){return this.$store.getters["auth/isAdmin"]||this.$store.getters["auth/isTechnician"]},canManageRequests(){return this.$store.getters["auth/isAdmin"]||this.$store.getters["auth/isTechnician"]},isCurrentUser(t){const e=this.$store.getters["auth/currentUser"];return e&&e.id===t}}}),new a.Ay({router:Ws,store:B,vuetify:Hs,render:t=>t(f),async created(){if(B.getters["auth/isAuthenticated"])try{await B.dispatch("auth/checkAuth")}catch(t){console.error("Ошибка проверки авторизации:",t)}}}).$mount("#app")}},e={};function s(a){var i=e[a];if(void 0!==i)return i.exports;var r=e[a]={id:a,loaded:!1,exports:{}};return t[a].call(r.exports,r,r.exports,s),r.loaded=!0,r.exports}s.m=t,function(){var t=[];s.O=function(e,a,i,r){if(!a){var o=1/0;for(u=0;u<t.length;u++){a=t[u][0],i=t[u][1],r=t[u][2];for(var n=!0,l=0;l<a.length;l++)(!1&r||o>=r)&&Object.keys(s.O).every((function(t){return s.O[t](a[l])}))?a.splice(l--,1):(n=!1,r<o&&(o=r));if(n){t.splice(u--,1);var c=i();void 0!==c&&(e=c)}}return e}r=r||0;for(var u=t.length;u>0&&t[u-1][2]>r;u--)t[u]=t[u-1];t[u]=[a,i,r]}}(),function(){s.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return s.d(e,{a:e}),e}}(),function(){s.d=function(t,e){for(var a in e)s.o(e,a)&&!s.o(t,a)&&Object.defineProperty(t,a,{enumerable:!0,get:e[a]})}}(),function(){s.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"===typeof window)return window}}()}(),function(){s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)}}(),function(){s.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}}(),function(){s.nmd=function(t){return t.paths=[],t.children||(t.children=[]),t}}(),function(){s.p="/"}(),function(){var t={524:0};s.O.j=function(e){return 0===t[e]};var e=function(e,a){var i,r,o=a[0],n=a[1],l=a[2],c=0;if(o.some((function(e){return 0!==t[e]}))){for(i in n)s.o(n,i)&&(s.m[i]=n[i]);if(l)var u=l(s)}for(e&&e(a);c<o.length;c++)r=o[c],s.o(t,r)&&t[r]&&t[r][0](),t[r]=0;return s.O(u)},a=self["webpackChunkequipment_management_client"]=self["webpackChunkequipment_management_client"]||[];a.forEach(e.bind(null,0)),a.push=e.bind(null,a.push.bind(a))}();var a=s.O(void 0,[504],(function(){return s(9035)}));a=s.O(a)})();